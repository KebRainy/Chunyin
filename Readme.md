## 启动程序

#### 环境要求
- MySQL 8.0+ (端口 3306)
- JDK 21
- Node.js 22
- Maven 3.6+

### 1. 初始化数据库

**重要**：后端启动前必须先初始化 MySQL 数据库（Navicat 不是必需，只是一个可视化客户端）。

你可以用以下任意一种方式导入 `data/beverage_platform.sql`：

**方式 A：命令行（无需 Navicat）**

1) 先创建数据库：

```bash
mysql -uroot -p -e "CREATE DATABASE IF NOT EXISTS beverage_platform DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

2) 再导入表结构/数据：

```bash
mysql -uroot -p beverage_platform < data/beverage_platform.sql
```

如果你之前已经导入过旧版数据库，且维基编辑/统计报 500（或提示“数据库结构错误”），再执行一次：

```bash
mysql -uroot -p beverage_platform < database/patch_add_wiki_revision.sql
```

如果是 PowerShell，可以改用（有可能出现二进制字符不兼容问题，推荐使用 msys2）：

```powershell
Get-Content data/beverage_platform.sql | mysql -uroot -p beverage_platform
```

**方式 B：Docker（无需本机安装 MySQL）**

项目已提供 `database/docker-compose.yml`，先启动 Docker Desktop，然后执行：

```bash
docker compose -f database/docker-compose.yml up -d
```

### 2. 配置数据库连接

编辑 `backend/src/main/resources/application.properties`：

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/beverage_platform
spring.datasource.username=root
spring.datasource.password=your_password
```

可选：如果要启用“本地 Python 内容审核（文本/图片）”，见 `tools/moderation/README.md`。

### 3. 启动后端

```bash
cd backend
mvn install
mvn spring-boot:run
```

### 4. 启动前端

```bash
cd frontend
npm install
npm run serve
```

如果启动时报 `The project seems to require yarn but it's not installed`，说明目录里存在 `yarn.lock`，删掉它或安装 yarn 即可。

访问：
- 前端：http://localhost:8080
- 后端：http://localhost:8081/api


## 实现情况

**已经实现**:
- SF-1
- SF-2
- SF-3
- SF-4
- SF-5
- SF-10
- SF-11
- SF-13

**仍需优化**:
- SF-6: 缺少私信控制
- SF-8: 缺少编辑控制，编辑器界面仍需优化
- SF-7：缺少认证流程
- SF-9：推荐系统不完善
- SF-12：缺少模型与API接入  

**未实现**:
- SF-16

在有限的时间内**可能无需实现**:
- SF-14
- SF-15

## SRS 的 System Features 部分

### 阶段一：最小可运行框架

**SF-1** 用户注册、登录与个人信息管理
- 功能概述：为普通用户提供账号注册、登录、退出登录以及个人信息（含头像）管理，作为平台所有功能的入口。
- 功能要点：
    - 支持用户名 + 密码登录，登录成功后由后端签发会话 Cookie，用于后续请求的身份验证。
    - 用户可查看和修改基础信息（昵称、个性签名、性别、所在地等），上传和更新头像。
    - 系统需支持头像图片的存储与访问（文件系统或对象存储），数据库中保存图片路径或标识。
    - 登录态超时或注销后，访问受保护资源应被重定向到登录页面。
- 超出当前版本范围（可选/后续版本）：
    - 邮箱注册与找回账号功能，包括邮箱验证、重置密码链接发送等。

**SF-2** 动态（推文）发布与管理
- 功能概述：用户围绕酒精饮料、饮酒体验、酒吧打卡等内容发布动态，形成平台的核心内容流。
- 功能要点：
    - 支持文本内容发布，可附带若干张图片；图片需统一存储管理，数据库记录与动态的关联关系。
    - 动态保存发布时间、发布用户、IP 属地等元信息；IP 属地以省/市等粗粒度形式展示。
    - 用户可查看自己发布的动态列表，支持删除、编辑（可限制时间窗口内编辑）等操作。
    - 动态内容需进行基础合法性校验（字数、图片大小类型等）。

**SF-3** 动态广场与互动功能
- 功能概述：为用户提供浏览他人动态的公共“广场”，并支持基础互动行为。
- 功能要点：
    - 动态广场以时间倒序或简单算法展示平台公开动态，支持分页/滚动加载。
    - 用户可对动态执行点赞、收藏、分享操作；系统需保存用户与动态的互动记录。
    - 用户可对动态进行评论和回复（一级评论为主，可预留二级评论扩展），评论记录与动态关联。
    - 系统记录用户的动态浏览历史，用户可在个人空间中查看自己的浏览记录列表。

**SF-4** 搜索功能（用户与动态）

- 功能概述：提供基础搜索入口，支持按关键字检索动态和用户。
- 功能要点：
    - 支持按关键字搜索动态，搜索范围至少包括动态标题/正文文本。
    - 支持按关键字搜索用户，搜索范围至少包括用户名、昵称。
    - 搜索结果支持分页显示，并可根据时间或相关度进行简单排序。

### 阶段二：社交扩展与内容形态扩展

**SF-5** 用户关注与关注动态流

- 功能概述：构建用户间订阅关系，形成以“关注”为中心的个性化动态流。
- 功能要点：
    - 用户可关注/取消关注其他用户，系统记录关注关系。
    - 用户个人主页显示关注数、粉丝数等基础社交指标。
    - 提供“关注”专属动态页，仅展示用户所关注对象发布的动态，按时间排序。

**SF-6** 用户私信与消息控制
- 功能概述：为用户之间提供一对一私信通道，并支持隐私与骚扰控制策略。
- 功能要点：
    - 支持用户之间互发文本私信（可预留图片/链接扩展），按会话分组展示。
    - 提供屏蔽功能：被屏蔽用户无法继续发送私信。
    - 支持简单的私信频次控制策略，例如：在尚未建立互相关注或互动关系前，限制某用户对另一用户的私信条数（如最多一条）。
    - 用户可配置私信接收策略，如：仅接受关注者私信、不接受任何私信等。

**SF-7** 附近酒吧信息与评价
- 功能概述：提供以“酒吧”为核心的地点信息展示、搜索与用户评价功能。
- 功能要点：
    - 酒吧信息由销售商或酒吧经营者申请注册，包括名称、地址、营业时间、联系方式、主营酒类等。
    - 平台需引入销售商资质认证流程，审核通过后才可在前端展示对应酒吧信息。
    - 支持基于地理位置的“附近酒吧”搜索功能，结合用户当前位置或指定位置进行范围查询。
    - 用户可对酒吧进行评分和文字评价，系统计算显示综合评分（如平均分）并展示用户评价列表。

**SF-8** 维基页面（酒类知识库）
- 功能概述：构建围绕酒精饮料、酒吧文化等内容的“维基”式知识页面，由用户共同维护。
- 功能要点：
    - 每个维基页面对应一个主题（如某款酒、某类鸡尾酒、某个酒吧文化概念），记录结构化与非结构化说明。
    - 授权用户可以编辑页面内容，系统需保存编辑历史、版本号以及每次编辑的贡献者信息。
    - 用户可在维基页面下发表评论，就页面内容展开讨论。
    - 搜索功能扩展支持“维基搜索”，可按标题、正文关键字搜索知识页。
    - 维基页面使用的图片应独立管理，建立单独的图片库并在数据库中与对应维基条目关联。

### 阶段三：用户体验与内容质量提升

**SF-9** 内容推荐与用户偏好建模
- 功能概述：基于协同过滤等算法，为用户推荐可能感兴趣的动态内容，提升内容匹配度。
- 功能要点：
    - 为动态打上类型/标签（如酒类品种、口感、场景、地点等），作为推荐算法输入特征之一。
    - 系统记录用户的浏览、点赞、收藏、分享、评论等行为，构建用户偏好画像。
    - 推荐接口向前端输出个性化动态列表，可用于首页或推荐页展示。

**SF-10** 高质量动态精选与排行榜
- 功能概述：对平台中的优质内容进行聚合展示，提升内容发现效率。
- 功能要点：
    - 定义动态质量评价指标（浏览量、点赞数、收藏数、分享数、评论质量等），定期计算高质量动态列表。
    - 提供排行榜视图，如“本周热门动态”、“高评分酒吧打卡动态”等。
    - 排行榜支持按时间维度（如日/周/月）筛选。

**SF-11** 附近最佳酒吧排序
- 功能概述：在“附近酒吧”基础上，综合评分与距离，为用户提供排序优化的结果列表。
- 功能要点：
    - 在进行附近酒吧搜索时，对候选酒吧按用户评分与距离进行加权排序。
    - 支持根据用户偏好对排序策略做简单调整（如更看重评分或更看重距离）。

**SF-12** 评论内容审核与举报
- 功能概述：对用户评论进行自动审核与违规内容处理，维护平台内容生态。
- 功能要点：
    - 在用户发表评论时，后端基于停用词库、敏感词库以及链接检测规则对评论进行初步过滤。
    - 用户可对他人评论发起举报，系统记录举报内容与原因。
    - 举报的评论可触发自动审核流程，系统通过小体量模型或第三方审核 API 对评论内容进行风险评估，并对结果进行标记（如待人工复核、直接屏蔽等）。
    - 提供基础管理端接口，供管理员查看高风险评论、执行删除或禁言等操作。
- 超出当前版本范围（可选/后续版本）：
    - 完整的“基于人工审核的举报与账户封禁”工作流（如专门的审核界面、审核队列分配策略等）可作为后续扩展。

**SF-13** 每日一题（基于维基内容的互动问答）
- 功能概述：围绕维基知识库提供每日单选问答，提高用户参与度并加强知识传播。
- 功能要点：
    - 系统每天自动或人工配置一道与酒类知识相关的单选题，展示在首页显著位置。
    - 用户点击选项即完成作答，提交后不可修改。
    - 作答后展示当日各选项的选择人数统计，方便用户了解整体答题分布。
    - 在统计信息下方展示正确答案的简要解释，并提供跳转链接至对应的维基页面，供用户进一步阅读。

### 阶段四：平台商业化与多端扩展

**SF-14** 创作激励机制（动态与维基）
- 功能概述：对优质内容创作者给予数据反馈和潜在激励，鼓励持续产出。
- 功能要点：
    - 对动态创作建立统计指标，如浏览量、点赞数、收藏数、分享数等，并在创作者侧可视化展示。
    - 对维基编辑行为统计贡献量，如新增/修改的字数或单词数、被引用次数等。
    - 在用户个人空间提供“创作中心”视图，集中展示其动态与维基的贡献数据，为后续货币化激励预留接口。

**SF-15** 广告与会员制（预留）
- 功能概述：为平台未来商业化预留广告投放位与会员专属功能入口。
- 功能要点：
    - 在页面关键位置预留广告展示区域，并设计后端接口以支持基本广告配置（如链接、图片、展示时间）。
    - 为会员系统预留数据结构（如会员等级、到期时间）和权限控制点，以便未来引入会员专属内容或功能。
    

**SF-16** 向微信小程序等多端扩展的接口支持
- 功能概述：支持平台从 Web 端扩展至微信小程序等其他前端形态。
- 功能要点：
    - 后端服务需提供与前端解耦的 RESTful API，确保业务功能可被多终端复用。
    - 为小程序等前端形式预留必要的鉴权方式（如基于 Token 的接口访问），并保证核心业务接口的稳定性与兼容性。
    - 当前阶段仅在后端接口和数据模型层面进行预留，具体小程序前端实现可在后续迭代中完成。
