"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[301],{2301:function(e,l,s){s.r(l),s.d(l,{default:function(){return fe}});s(4114),s(8111),s(2489);var t=s(641),a=s(953),n=s(33),o=s(3751),i=s(5220),u=s(4353),r=s.n(u),c=s(6400),d=s(4402),k=s(2549),p=s(163),v=s(8548);const m={key:0,class:"profile-page"},y={class:"profile-hero"},f={class:"cover-panel"},g={class:"hero-layout"},L={class:"avatar-column"},h={class:"meta-column"},b={class:"user-title"},C={class:"uid"},w={key:1,class:"signature-text"},F={class:"stats-column"},_={class:"stat"},I={class:"stat"},X={class:"stat"},E={class:"profile-tabs"},R=["onClick"],K={class:"profile-content"},A={key:0,class:"content-card"},W={class:"section-header"},$={key:0,class:"loading"},T={key:1,class:"empty"},V={key:2,class:"post-list"},U={class:"post-thumbnail"},z=["src","alt"],P={key:1},S={class:"post-content"},D={class:"post-text"},x={class:"post-meta"},Y={key:1,class:"content-card"},H={class:"section-header"},O={class:"filter-bar"},M={key:0,class:"loading"},q={key:1,class:"empty"},j={key:2,class:"card-grid"},B=["onClick"],Q={class:"card-meta"},G={key:2,class:"content-card"},N={class:"section-header"},J={class:"filter-bar"},Z={key:0,class:"loading"},ee={key:1,class:"empty"},le={key:2,class:"footprint-list"},se={class:"group-date"},te={class:"group-items"},ae=["onClick"],ne={class:"footprint-cover"},oe=["src","alt"],ie={key:1,class:"cover-placeholder"},ue={class:"footprint-info"},re={class:"footprint-title"},ce={class:"title-text"},de={class:"footprint-summary"},ke={class:"footprint-meta"},pe={class:"visit-time"},ve={key:3,class:"content-card message-entry"};var me={__name:"Profile",setup(e){const l=(0,i.rd)(),s=(0,i.lq)(),u=(0,c.k)(),me=[{key:"posts",label:"动态"},{key:"collections",label:"收藏"},{key:"history",label:"足迹"},{key:"messages",label:"消息"}],ye=(0,a.KR)("posts"),fe=(0,a.KR)(""),ge=(0,a.KR)(null),Le=(0,a.KR)(!1),he=()=>{Le.value=!0,(0,t.dY)(()=>{ge.value?.focus()})},be=(0,a.Kh)({loading:!1,items:[]}),Ce=(0,a.Kh)({loading:!1,items:[]}),we=(0,a.Kh)({loading:!1,items:[]}),Fe=(0,a.Kh)({type:"ALL",keyword:""}),_e=(0,a.Kh)({days:3,type:"ALL"}),Ie=(0,t.EW)(()=>Fe.keyword?Ce.items.filter(e=>e.title?.includes(Fe.keyword)||e.summary?.includes(Fe.keyword)):Ce.items),Xe=(0,t.EW)(()=>{const e={};for(const l of we.items){const s=r()(l.visitedAt).format("YYYY年MM月DD日");e[s]||(e[s]=[]),e[s].push(l)}return e}),Ee=(0,t.EW)(()=>{const e=Math.max(0,me.findIndex(e=>e.key===ye.value)),l=100/me.length;return{width:`${l}%`,transform:`translateX(${100*e}%)`}}),Re=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",Ke=e=>e&&e.imageUrls&&0!==e.imageUrls.length?e.imageUrls[0]:null,Ae=e=>r()(e).format("YYYY.MM.DD HH:mm"),We=e=>{const l=r()(e),s=r()();return l.isSame(s,"day")?`今天 ${l.format("HH:mm")}`:l.isSame(s.subtract(1,"day"),"day")?`昨天 ${l.format("HH:mm")}`:l.format("MM-DD HH:mm")},$e=e=>{"POST"===e.targetType?l.push(`/posts/${e.targetId}`):"WIKI"===e.targetType&&(e.slug?l.push(`/wiki/${e.slug}`):l.push(`/wiki/${e.targetId}`))},Te=async()=>{be.loading=!0;try{const e=await d.x.listUserPosts(u.userInfo.id,1,10);be.items=e.data.items||[]}catch(e){p.nk.error("加载动态失败")}finally{be.loading=!1}},Ve=()=>{Te()},Ue=async()=>{Ce.loading=!0;try{const e={page:1,pageSize:20};"ALL"!==Fe.type&&(e.type=Fe.type);const l=await(0,k.qw)(e);Ce.items=l.data.items||[]}catch(e){p.nk.error("加载收藏失败")}finally{Ce.loading=!1}},ze=async()=>{we.loading=!0;try{const e={days:_e.days};"ALL"!==_e.type&&(e.type=_e.type);const l=await(0,k.hP)(e);we.items=l.data||[]}catch(e){p.nk.error("加载足迹失败")}finally{we.loading=!1}},Pe=e=>{"messages"!==e?(ye.value=e,"posts"===e&&Te(),"collections"===e&&Ue(),"history"===e&&ze()):Se()},Se=()=>{l.push("/messages")},De=e=>{l.push(`/posts/${e}`)},xe=e=>{e&&("POST"!==e.targetType?"WIKI"===e.targetType&&(e.slug?l.push(`/wiki/${e.slug}`):l.push(`/wiki/${e.targetId}`)):l.push(`/posts/${e.targetId}`))},Ye=()=>{l.push("/user/settings")},He=async()=>{try{await(0,k.r7)({bio:fe.value}),await u.fetchUserInfo(),Le.value=!1,p.nk.success("签名已更新")}catch(e){p.nk.error("更新失败")}},Oe=()=>{fe.value=u.userInfo.bio,Le.value=!1};return(0,t.sV)(async()=>{await u.fetchUserInfo().catch(()=>{}),fe.value=u.userInfo?.bio,Te()}),(0,t.wB)(()=>s.query.tab,e=>{e&&me.some(l=>l.key===e)&&(ye.value=e,"posts"===e&&Te(),"collections"===e&&Ue(),"history"===e&&ze())},{immediate:!0}),(e,l)=>{const s=(0,t.g2)("el-avatar"),i=(0,t.g2)("el-tag"),r=(0,t.g2)("el-input"),c=(0,t.g2)("el-button"),d=(0,t.g2)("el-skeleton"),k=(0,t.g2)("el-empty"),p=(0,t.g2)("el-option"),Te=(0,t.g2)("el-select"),Me=(0,t.g2)("el-icon");return(0,a.R1)(u).userInfo?((0,t.uX)(),(0,t.CE)("div",m,[(0,t.Lk)("section",y,[(0,t.Lk)("div",f,[(0,t.Lk)("div",g,[(0,t.Lk)("div",L,[(0,t.Lk)("div",{class:"avatar-wrapper",onClick:Ye},[(0,t.bF)(s,{size:104,src:(0,a.R1)(u).userInfo.avatarUrl,alt:`${(0,a.R1)(u).userInfo.username||"用户"}的头像`},null,8,["src","alt"]),l[6]||(l[6]=(0,t.Lk)("div",{class:"avatar-overlay"},"编辑信息",-1))])]),(0,t.Lk)("div",h,[(0,t.Lk)("div",b,[(0,t.Lk)("h1",null,(0,n.v_)((0,a.R1)(u).userInfo.username),1),(0,t.bF)(i,{size:"small",effect:"dark"},{default:(0,t.k6)(()=>[(0,t.eW)("Lv."+(0,n.v_)((0,a.R1)(u).userInfo.level||1),1)]),_:1})]),(0,t.Lk)("p",C,"UID "+(0,n.v_)((0,a.R1)(u).userInfo.id),1),(0,t.Lk)("div",{class:(0,n.C4)(["signature",{editing:Le.value}]),onClick:l[1]||(l[1]=e=>!Le.value&&he()),style:{backgroundColor:"inherit"}},[Le.value?((0,t.uX)(),(0,t.Wv)(r,{key:0,ref_key:"signatureInputRef",ref:ge,modelValue:fe.value,"onUpdate:modelValue":l[0]||(l[0]=e=>fe.value=e),size:"small",maxlength:"200","show-word-limit":"",onKeyup:(0,o.jR)(He,["enter"]),onKeydown:(0,o.jR)((0,o.D$)(Oe,["prevent"]),["esc"]),onBlur:He},null,8,["modelValue","onKeydown"])):((0,t.uX)(),(0,t.CE)("span",w,(0,n.v_)(fe.value||"这个人很酷，什么都没有写"),1))],2)]),(0,t.Lk)("div",F,[(0,t.Lk)("div",_,[(0,t.Lk)("p",null,(0,n.v_)((0,a.R1)(u).userInfo.followingCount),1),l[7]||(l[7]=(0,t.Lk)("span",null,"关注",-1))]),(0,t.Lk)("div",I,[(0,t.Lk)("p",null,(0,n.v_)((0,a.R1)(u).userInfo.followerCount),1),l[8]||(l[8]=(0,t.Lk)("span",null,"粉丝",-1))]),(0,t.Lk)("div",X,[(0,t.Lk)("p",null,(0,n.v_)((0,a.R1)(u).userInfo.likeReceived),1),l[9]||(l[9]=(0,t.Lk)("span",null,"获赞",-1))])])])])]),(0,t.Lk)("nav",E,[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(me,e=>(0,t.Lk)("button",{key:e.key,class:(0,n.C4)(["tab",{active:ye.value===e.key}]),onClick:l=>Pe(e.key)},(0,n.v_)(e.label),11,R)),64)),(0,t.Lk)("div",{class:"tab-indicator",style:(0,n.Tr)(Ee.value)},null,4)]),(0,t.Lk)("section",K,["posts"===ye.value?((0,t.uX)(),(0,t.CE)("div",A,[(0,t.Lk)("div",W,[l[11]||(l[11]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"eyebrow"},"Recent"),(0,t.Lk)("h3",null,"我的动态")],-1)),(0,t.bF)(c,{text:"",size:"small",onClick:Ve},{default:(0,t.k6)(()=>[...l[10]||(l[10]=[(0,t.eW)("刷新",-1)])]),_:1})]),be.loading?((0,t.uX)(),(0,t.CE)("div",$,[(0,t.bF)(d,{rows:3,animated:""})])):0===be.items.length?((0,t.uX)(),(0,t.CE)("div",T,[(0,t.bF)(k,{description:"还没有发布任何动态"})])):((0,t.uX)(),(0,t.CE)("div",V,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(be.items,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"post-row"},[(0,t.Lk)("div",U,[Ke(e)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:Ke(e),alt:`${e.author?.username||"用户"}的动态配图`},null,8,z)):((0,t.uX)(),(0,t.CE)("span",P,"文字"))]),(0,t.Lk)("div",S,[(0,t.Lk)("p",D,(0,n.v_)(Re(e.content)),1),(0,t.Lk)("div",x,[(0,t.Lk)("span",null,(0,n.v_)(Ae(e.createdAt)),1),(0,t.Lk)("span",null,"浏览 "+(0,n.v_)(e.viewCount||0),1),(0,t.Lk)("span",null,"点赞 "+(0,n.v_)(e.likeCount||0),1)])]),(0,t.bF)(c,{text:"",size:"small",onClick:l=>De(e.id)},{default:(0,t.k6)(()=>[...l[12]||(l[12]=[(0,t.eW)("查看",-1)])]),_:1},8,["onClick"])]))),128))]))])):"collections"===ye.value?((0,t.uX)(),(0,t.CE)("div",Y,[(0,t.Lk)("div",H,[l[14]||(l[14]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"eyebrow"},"Saved"),(0,t.Lk)("h3",null,"收藏夹")],-1)),(0,t.Lk)("div",O,[(0,t.bF)(Te,{modelValue:Fe.type,"onUpdate:modelValue":l[2]||(l[2]=e=>Fe.type=e),size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{label:"全部内容",value:"ALL"}),(0,t.bF)(p,{label:"动态",value:"POST"}),(0,t.bF)(p,{label:"维基",value:"WIKI"})]),_:1},8,["modelValue"]),(0,t.bF)(r,{modelValue:Fe.keyword,"onUpdate:modelValue":l[3]||(l[3]=e=>Fe.keyword=e),placeholder:"搜索收藏内容",size:"small",clearable:""},null,8,["modelValue"]),(0,t.bF)(c,{size:"small",onClick:Ue},{default:(0,t.k6)(()=>[...l[13]||(l[13]=[(0,t.eW)("筛选",-1)])]),_:1})])]),Ce.loading?((0,t.uX)(),(0,t.CE)("div",M,[(0,t.bF)(d,{rows:3,animated:""})])):0===Ce.items.length?((0,t.uX)(),(0,t.CE)("div",q,[(0,t.bF)(k,{description:"暂无收藏"})])):((0,t.uX)(),(0,t.CE)("div",j,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Ie.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"card",onClick:l=>xe(e)},[(0,t.Lk)("h4",null,(0,n.v_)(e.title),1),(0,t.Lk)("p",null,(0,n.v_)(e.summary),1),(0,t.Lk)("div",Q,[(0,t.Lk)("span",null,(0,n.v_)("POST"===e.targetType?"动态":"维基"),1),(0,t.Lk)("span",null,(0,n.v_)(Ae(e.createdAt)),1)]),(0,t.bF)(c,{type:"primary",link:"",size:"small",onClick:(0,o.D$)(l=>xe(e),["stop"])},{default:(0,t.k6)(()=>[...l[15]||(l[15]=[(0,t.eW)(" 查看详情 ",-1)])]),_:1},8,["onClick"])],8,B))),128))]))])):"history"===ye.value?((0,t.uX)(),(0,t.CE)("div",G,[(0,t.Lk)("div",N,[l[16]||(l[16]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"eyebrow"},"Footprint"),(0,t.Lk)("h3",null,"我的足迹")],-1)),(0,t.Lk)("div",J,[(0,t.bF)(Te,{modelValue:_e.days,"onUpdate:modelValue":l[4]||(l[4]=e=>_e.days=e),size:"small",onChange:ze},{default:(0,t.k6)(()=>[(0,t.bF)(p,{label:"3 天以内",value:3}),(0,t.bF)(p,{label:"7 天以内",value:7}),(0,t.bF)(p,{label:"30 天以内",value:30})]),_:1},8,["modelValue"]),(0,t.bF)(Te,{modelValue:_e.type,"onUpdate:modelValue":l[5]||(l[5]=e=>_e.type=e),size:"small",onChange:ze},{default:(0,t.k6)(()=>[(0,t.bF)(p,{label:"全部",value:"ALL"}),(0,t.bF)(p,{label:"动态",value:"POST"}),(0,t.bF)(p,{label:"维基",value:"WIKI"})]),_:1},8,["modelValue"])])]),we.loading?((0,t.uX)(),(0,t.CE)("div",Z,[(0,t.bF)(d,{rows:3,animated:""})])):0===we.items.length?((0,t.uX)(),(0,t.CE)("div",ee,[(0,t.bF)(k,{description:"最近没有足迹记录"})])):((0,t.uX)(),(0,t.CE)("div",le,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(Xe.value,(e,l)=>((0,t.uX)(),(0,t.CE)("div",{key:l,class:"footprint-group"},[(0,t.Lk)("div",se,(0,n.v_)(l),1),(0,t.Lk)("div",te,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(e,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"footprint-item",onClick:l=>$e(e)},[(0,t.Lk)("div",ne,[e.coverUrl?((0,t.uX)(),(0,t.CE)("img",{key:0,src:e.coverUrl,alt:e.title},null,8,oe)):((0,t.uX)(),(0,t.CE)("div",ie,["POST"===e.targetType?((0,t.uX)(),(0,t.Wv)(Me,{key:0},{default:(0,t.k6)(()=>[(0,t.bF)((0,a.R1)(v.Document))]),_:1})):((0,t.uX)(),(0,t.Wv)(Me,{key:1},{default:(0,t.k6)(()=>[(0,t.bF)((0,a.R1)(v.Notebook))]),_:1}))]))]),(0,t.Lk)("div",ue,[(0,t.Lk)("div",re,[(0,t.bF)(i,{type:"POST"===e.targetType?"primary":"success",size:"small",effect:"plain"},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)("POST"===e.targetType?"动态":"维基"),1)]),_:2},1032,["type"]),(0,t.Lk)("span",ce,(0,n.v_)(e.title||"无标题"),1)]),(0,t.Lk)("p",de,(0,n.v_)(e.summary||"暂无描述"),1),(0,t.Lk)("div",ke,[(0,t.Lk)("span",pe,[(0,t.bF)(Me,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,a.R1)(v.Clock))]),_:1}),(0,t.eW)(" "+(0,n.v_)(We(e.visitedAt)),1)])])]),(0,t.bF)(Me,{class:"arrow-icon"},{default:(0,t.k6)(()=>[(0,t.bF)((0,a.R1)(v.ArrowRight))]),_:1})],8,ae))),128))])]))),128))]))])):"messages"===ye.value?((0,t.uX)(),(0,t.CE)("div",ve,[(0,t.bF)(k,{description:"私信已独立为单独页面"}),(0,t.bF)(c,{type:"primary",onClick:Se},{default:(0,t.k6)(()=>[...l[17]||(l[17]=[(0,t.eW)("进入消息中心",-1)])]),_:1})])):(0,t.Q3)("",!0)])])):((0,t.uX)(),(0,t.Wv)(k,{key:1,description:"正在加载..."}))}}};const ye=me;var fe=ye},2549:function(e,l,s){s.d(l,{Qt:function(){return u},ec:function(){return o},fG:function(){return k},hP:function(){return d},hc:function(){return r},l2:function(){return a},pV:function(){return i},qw:function(){return c},r7:function(){return n}});var t=s(7277);const a=e=>(0,t.A)({url:`/users/${e}`,method:"get"}),n=e=>(0,t.A)({url:"/users/profile",method:"put",data:e}),o=e=>(0,t.A)({url:"/users/password",method:"put",data:e}),i=e=>(0,t.A)({url:`/users/${e}/follow`,method:"post"}),u=e=>(0,t.A)({url:`/users/${e}/follow`,method:"delete"}),r=()=>(0,t.A)({url:"/users/followees",method:"get"}),c=e=>(0,t.A)({url:"/collections",method:"get",params:e}),d=e=>(0,t.A)({url:"/footprints",method:"get",params:e}),k=e=>(0,t.A)({url:"/footprints",method:"post",data:e})}}]);
//# sourceMappingURL=301.95254581.js.map