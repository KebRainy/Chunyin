(self["webpackChunkdemo2"]=self["webpackChunkdemo2"]||[]).push([[311],{2311:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return V}});a(4114);var s=a(641),l=a(953),n=a(33),o=a(5220),r=a(5696),u=a(6400),i=a(4402),c=a(7277);const d=()=>(0,c.A)({url:"/daily-question/today",method:"get"}),v=(e,t)=>(0,c.A)({url:`/daily-question/${e}/answer`,method:"post",data:{optionIndex:t}});var p=a(163),k=a(7918),m=a(4353),f=a.n(m),y=(a(6033),a(5394)),_=a(3530);const h={class:"home-container"},g={class:"top-section"},L={class:"share-section"},C={key:1,class:"login-prompt equal-card"},w={class:"daily-question-section"},Y={class:"question-header"},b={class:"question-date"},E={key:0,class:"question-content"},X={key:1,class:"question-content"},M={key:2,class:"question-content"},F={class:"options"},x=["onClick"],W={class:"option-text"},R={key:0,class:"option-stats"},q={class:"option-count"},D={key:0,class:"answer-result"},K={key:0,class:"correct"},$={key:1,class:"wrong"},S={key:1,class:"answer-explanation"},A={class:"posts-container"},T={key:0,class:"loading"},H={key:1,class:"empty"},I={key:2,class:"masonry-grid"},Q={key:3,class:"load-more"},O={key:4,class:"no-more"};var U={__name:"Home",setup(e){f().locale("zh-cn");const t=(0,o.rd)(),a=(0,u.k)(),c=(0,l.KR)(null),m=(0,l.KR)([]),U=(0,l.KR)(!1),z=(0,l.KR)(1),B=(0,l.KR)(12),V=(0,l.KR)(!0),j=(0,l.KR)(null),G=(0,l.KR)(!1),N=(0,l.KR)(!1),P=(0,s.EW)(()=>f()().format("M月D日")),J=(0,s.EW)(()=>j.value?.answered||!1),Z=(0,s.EW)(()=>j.value?.selectedOption??null),ee=async()=>{U.value=!0;try{const e=await i.x.listPosts(z.value,B.value),t=e.data,a=t.items||[];1===z.value?m.value=a:m.value.push(...a),V.value=a.length>=B.value}catch(e){console.error("Failed to load posts:",e),p.nk.error("加载失败")}finally{U.value=!1}},te=()=>{z.value++,ee()},ae=()=>{z.value=1,V.value=!0,ee()},se=()=>{ae()},le=async()=>{G.value=!0;try{const e=await d();j.value=e.data}catch(e){j.value=null}finally{G.value=!1}},ne=e=>{t.push(`/posts/${e}`)},oe=()=>{t.push("/login")},re=async e=>{if(j.value&&!j.value.answered)if(a.isLoggedIn){N.value=!0;try{const t=await v(j.value.id,e);j.value=t.data,p.nk.success("已记录你的选择")}catch(s){p.nk.error(s.response?.data?.message||"提交失败")}finally{N.value=!1}}else t.push("/login")},ue=e=>j.value&&j.value.answered?e===j.value.correctOption?"correct":e===j.value.selectedOption&&e!==j.value.correctOption?"wrong":"other":"clickable",ie=e=>e>1e4?(e/1e4).toFixed(1)+"万":e.toString(),ce=e=>{if(!e)return;if(e.startsWith("http"))return void window.open(e,"_blank");const a=e.startsWith("/")?e:`/wiki/${e}`;t.push(a)},de=()=>!!c.value?.hasUnsaved?.value,ve=e=>{if(!de())return;const t="是否离开网站 你所做的更改可能未保存";return e.preventDefault(),e.returnValue=t,t};return(0,r.JZ)((e,t,a)=>{de()?k.s.confirm("是否离开网站 你所做的更改可能未保存","离开确认",{confirmButtonText:"仍要离开",cancelButtonText:"继续编辑",type:"warning"}).then(()=>a()).catch(()=>a(!1)):a()}),(0,s.sV)(()=>{window.addEventListener("beforeunload",ve),ee(),le()}),(0,s.xo)(()=>{window.removeEventListener("beforeunload",ve)}),(e,t)=>{const o=(0,s.g2)("el-card"),r=(0,s.g2)("el-button"),u=(0,s.g2)("el-skeleton"),i=(0,s.g2)("el-empty");return(0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",g,[(0,s.Lk)("div",L,[(0,l.R1)(a).isLoggedIn?((0,s.uX)(),(0,s.Wv)(o,{key:0,class:"share-editor-card equal-card"},{default:(0,s.k6)(()=>[t[1]||(t[1]=(0,s.Lk)("div",{class:"share-editor-header"},[(0,s.Lk)("div",null,[(0,s.Lk)("p",{class:"eyebrow"},"此刻发布"),(0,s.Lk)("h3",null,"分享你的灵感"),(0,s.Lk)("span",null,"支持图文、标签、地点，一次完成")])],-1)),(0,s.bF)(y.A,{ref_key:"composerRef",ref:c,mode:"inline",onSubmitted:se},null,512)]),_:1})):((0,s.uX)(),(0,s.CE)("div",C,[t[3]||(t[3]=(0,s.Lk)("p",null,"登录后即可分享图文、参加活动",-1)),(0,s.bF)(r,{type:"primary",onClick:oe},{default:(0,s.k6)(()=>[...t[2]||(t[2]=[(0,s.eW)("登录",-1)])]),_:1})]))]),(0,s.Lk)("div",w,[(0,s.bF)(o,{class:"question-card equal-card"},{header:(0,s.k6)(()=>[(0,s.Lk)("div",Y,[t[4]||(t[4]=(0,s.Lk)("span",null,"每日一题",-1)),(0,s.Lk)("span",b,(0,n.v_)(P.value),1)])]),default:(0,s.k6)(()=>[G.value?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.bF)(u,{rows:4,animated:""})])):j.value?((0,s.uX)(),(0,s.CE)("div",M,[(0,s.Lk)("h4",null,(0,n.v_)(j.value.question),1),(0,s.Lk)("div",F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(j.value.options,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.index,class:(0,n.C4)(["option",ue(e.index),{disabled:N.value}]),onClick:t=>re(e.index)},[(0,s.Lk)("span",W,(0,n.v_)(e.label)+". "+(0,n.v_)(e.text),1),J.value?((0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:e.percentage+"%"})},null,4),(0,s.Lk)("span",q,(0,n.v_)(ie(e.count)),1)])):(0,s.Q3)("",!0)],10,x))),128))]),J.value?((0,s.uX)(),(0,s.CE)("div",D,[Z.value===j.value.correctOption?((0,s.uX)(),(0,s.CE)("span",K," ✓ 回答正确！ ")):((0,s.uX)(),(0,s.CE)("span",$," ✗ 回答错误，正确答案是："+(0,n.v_)(j.value.options[j.value.correctOption].text),1))])):(0,s.Q3)("",!0),J.value&&j.value.explanation?((0,s.uX)(),(0,s.CE)("div",S,[(0,s.Lk)("p",null,(0,n.v_)(j.value.explanation),1),j.value.wikiLink?((0,s.uX)(),(0,s.Wv)(r,{key:0,size:"small",type:"primary",link:"",onClick:t[0]||(t[0]=e=>ce(j.value.wikiLink))},{default:(0,s.k6)(()=>[...t[5]||(t[5]=[(0,s.eW)(" 查看相关词条 ",-1)])]),_:1})):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",X,[(0,s.bF)(i,{description:"暂未发布今日题目"})]))]),_:1})])]),(0,s.Lk)("div",A,[U.value?((0,s.uX)(),(0,s.CE)("div",T,"加载中...")):0===m.value.length?((0,s.uX)(),(0,s.CE)("div",H,[(0,s.bF)(i,{description:"暂无动态"})])):((0,s.uX)(),(0,s.CE)("div",I,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.value,e=>((0,s.uX)(),(0,s.Wv)(_.A,{key:e.id,post:e,onSelect:t=>ne(e.id)},null,8,["post","onSelect"]))),128))])),!U.value&&V.value?((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.bF)(r,{onClick:te},{default:(0,s.k6)(()=>[...t[6]||(t[6]=[(0,s.eW)("加载更多",-1)])]),_:1})])):(0,s.Q3)("",!0),!V.value&&m.value.length>0?((0,s.uX)(),(0,s.CE)("div",O," 已加载全部内容 ")):(0,s.Q3)("",!0)])])}}},z=a(6262);const B=(0,z.A)(U,[["__scopeId","data-v-26864a62"]]);var V=B},3530:function(e,t,a){"use strict";a.d(t,{A:function(){return R}});var s=a(641),l=a(33),n=a(953),o=a(4353),r=a.n(o),u=a(8660),i=a.n(u),c=a(8548);const d={key:0,class:"card-media"},v=["src","alt"],p={class:"image-overlay"},k={class:"overlay-item"},m={class:"overlay-item"},f={key:0,class:"count"},y={key:1,class:"card-media no-image"},_={class:"no-image-text"},h={class:"image-overlay"},g={class:"overlay-item"},L={class:"overlay-item"},C={class:"card-body"},w={class:"content"},Y={key:0,class:"tags"},b={class:"card-meta"},E={class:"author"},X={class:"name"},M={class:"time"};var F={__name:"PostCard",props:{post:{type:Object,required:!0},layout:{type:String,default:"masonry"}},emits:["select"],setup(e){r().extend(i());const t=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",a=e=>e?e.length>60?`${e.slice(0,60)}...`:e:"分享此刻的灵感",o=e=>{if(!e)return"";const t=r()(e),a=r()(),s=a.diff(t,"minute");if(s<60)return`${s||1}分钟前`;const l=a.diff(t,"hour");return l<24?`${l}小时前`:t.isSame(a,"year")?t.format("M月D日"):t.format("YYYY年M月D日")};return(r,u)=>{const i=(0,s.g2)("el-icon"),F=(0,s.g2)("el-tag"),x=(0,s.g2)("el-avatar");return(0,s.uX)(),(0,s.CE)("div",{class:(0,l.C4)(["post-card",e.layout]),onClick:u[0]||(u[0]=t=>r.$emit("select",e.post))},[e.post.imageUrls?.length?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("img",{src:e.post.imageUrls[0],alt:e.post.content||`${e.post.author?.username||"用户"}的分享图片`},null,8,v),(0,s.Lk)("div",p,[(0,s.Lk)("span",k,[(0,s.bF)(i,null,{default:(0,s.k6)(()=>[(0,s.bF)((0,n.R1)(c.View))]),_:1}),(0,s.eW)((0,l.v_)(e.post.viewCount||0),1)]),(0,s.Lk)("span",m,[(0,s.bF)(i,null,{default:(0,s.k6)(()=>[(0,s.bF)((0,n.R1)(c.GobletFull))]),_:1}),(0,s.eW)((0,l.v_)(e.post.likeCount||0),1)])]),e.post.imageUrls.length>1?((0,s.uX)(),(0,s.CE)("span",f,"+"+(0,l.v_)(e.post.imageUrls.length-1),1)):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("p",_,(0,l.v_)(a(e.post.content)),1),(0,s.Lk)("div",h,[(0,s.Lk)("span",g,[(0,s.bF)(i,null,{default:(0,s.k6)(()=>[(0,s.bF)((0,n.R1)(c.View))]),_:1}),(0,s.eW)((0,l.v_)(e.post.viewCount||0),1)]),(0,s.Lk)("span",L,[(0,s.bF)(i,null,{default:(0,s.k6)(()=>[(0,s.bF)((0,n.R1)(c.GobletFull))]),_:1}),(0,s.eW)((0,l.v_)(e.post.likeCount||0),1)])])])),(0,s.Lk)("div",C,[(0,s.Lk)("p",w,(0,l.v_)(t(e.post.content)),1),e.post.tags?.length?((0,s.uX)(),(0,s.CE)("div",Y,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.post.tags.slice(0,2),e=>((0,s.uX)(),(0,s.Wv)(F,{key:e,size:"small",effect:"light"},{default:(0,s.k6)(()=>[(0,s.eW)(" # "+(0,l.v_)(e),1)]),_:2},1024))),128))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",b,[(0,s.Lk)("div",E,[(0,s.bF)(x,{src:e.post.author?.avatarUrl,size:28,alt:`${e.post.author?.username||"用户"}的头像`},null,8,["src","alt"]),(0,s.Lk)("p",X,(0,l.v_)(e.post.author?.username),1)]),(0,s.Lk)("span",M,(0,l.v_)(o(e.post.createdAt)),1)])],2)}}},x=a(6262);const W=(0,x.A)(F,[["__scopeId","data-v-099876c4"]]);var R=W},6033:function(e,t,a){!function(t,s){e.exports=s(a(4353))}(0,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=t(e),s={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var a=100*e+t;return a<600?"凌晨":a<900?"早上":a<1100?"上午":a<1300?"中午":a<1800?"下午":"晚上"}};return a.default.locale(s,null,!0),s})},8660:function(e){!function(t,a){e.exports=a()}(0,function(){"use strict";return function(e,t,a){e=e||{};var s=t.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function n(e,t,a,l){return s.fromToBase(e,t,a,l)}a.en.relativeTime=l,s.fromToBase=function(t,s,n,o,r){for(var u,i,c,d=n.$locale().relativeTime||l,v=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],p=v.length,k=0;k<p;k+=1){var m=v[k];m.d&&(u=o?a(t).diff(n,m.d,!0):n.diff(t,m.d,!0));var f=(e.rounding||Math.round)(Math.abs(u));if(c=u>0,f<=m.r||!m.r){f<=1&&k>0&&(m=v[k-1]);var y=d[m.l];r&&(f=r(""+f)),i="string"==typeof y?y.replace("%d",f):y(f,s,m.l,c);break}}if(s)return i;var _=c?d.future:d.past;return"function"==typeof _?_(i):_.replace("%s",i)},s.to=function(e,t){return n(e,t,this,!0)},s.from=function(e,t){return n(e,t,this)};var o=function(e){return e.$u?a.utc():a()};s.toNow=function(e){return this.to(o(this),e)},s.fromNow=function(e){return this.from(o(this),e)}}})}}]);
//# sourceMappingURL=311.15d7e7ea.js.map