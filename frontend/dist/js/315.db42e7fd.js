"use strict";(self["webpackChunkdemo2"]=self["webpackChunkdemo2"]||[]).push([[315],{7315:function(e,l,a){a.r(l),a.d(l,{default:function(){return V}});a(4114),a(8111),a(2489);var t=a(641),n=a(33),s=a(953),u=a(5220),r=a(8930),i=a(163),d=a(3263),o=a(9418);const c={class:"editor-page"},k={class:"header"},p={class:"eyebrow"},m={class:"header-actions"},v={class:"editor-grid"},b={class:"editor-panel"},f={class:"toolbar"},g={key:0,class:"uploaded-images"},h={class:"images-list"},w=["src","alt"],y={class:"preview-panel"},_=["innerHTML"];var L={__name:"WikiEditor",setup(e){const l=(0,u.lq)(),a=(0,u.rd)(),L=(0,s.KR)(!1),F=(0,s.KR)(!1),C=(0,s.KR)([]),V=(0,s.Kh)({title:"",summary:"",content:""}),E=new d.A({html:!0,linkify:!0,breaks:!0}),W=(0,t.EW)(()=>V.content?o.A.sanitize(E.render(V.content)):'<p class="empty">开始输入内容，实时预览会显示在这里</p>'),x=(0,t.EW)(()=>!!l.params.id),$=e=>{const l=e.type.startsWith("image/"),a=e.size/1024/1024<5;return l||i.nk.error("只能上传图片"),a||i.nk.error("图片需小于 5MB"),l&&a&&(F.value=!0),l&&a},K=e=>{if(F.value=!1,200===e.code&&e.data?.url){const l=e.data.url,a=e.data.id||`${Date.now()}`;C.value.push({uid:a,url:l});const t=`![图片说明](${l})\n`;V.content=`${V.content}\n${t}`.trim(),i.nk.success("图片已插入")}else i.nk.error("上传失败")},M=()=>{F.value=!1,i.nk.error("上传失败，请稍后再试")},I=e=>{C.value=C.value.filter(l=>l.uid!==e.uid);const l=new RegExp(`!\\[[^\\]]*\\]\\(${e.url.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\$&")}\\)`,"g");V.content=V.content.replace(l,"")},R=async()=>{if(!x.value)return;const e=await(0,r.ET)(l.params.id);Object.assign(V,{title:e.data.title,summary:e.data.summary,content:e.data.content})},X=async()=>{if(V.title.trim()&&V.content.trim()){L.value=!0;try{x.value?(await(0,r.xl)(l.params.id,V),i.nk.success("已提交修改，等待审核")):(await(0,r.MC)(V),i.nk.success("已提交，等待审核")),a.push("/wiki")}finally{L.value=!1}}else i.nk.warning("标题和正文不能为空")},z=()=>{a.push("/wiki")};return(0,t.sV)(()=>{R()}),(e,l)=>{const a=(0,t.g2)("el-button"),s=(0,t.g2)("el-input"),u=(0,t.g2)("el-form-item"),r=(0,t.g2)("el-upload"),i=(0,t.g2)("el-form"),d=(0,t.g2)("el-card");return(0,t.uX)(),(0,t.CE)("div",c,[(0,t.bF)(d,null,{header:(0,t.k6)(()=>[(0,t.Lk)("div",k,[(0,t.Lk)("div",null,[(0,t.Lk)("p",p,(0,n.v_)(x.value?"编辑条目":"新建条目"),1),(0,t.Lk)("h2",null,(0,n.v_)(V.title||"未命名词条"),1)]),(0,t.Lk)("div",m,[(0,t.bF)(a,{onClick:z},{default:(0,t.k6)(()=>[...l[3]||(l[3]=[(0,t.eW)("返回列表",-1)])]),_:1}),(0,t.bF)(a,{type:"primary",loading:L.value,onClick:X},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(x.value?"提交更新":"发布词条"),1)]),_:1},8,["loading"])])])]),default:(0,t.k6)(()=>[(0,t.bF)(i,{model:V,"label-width":"80px",class:"editor-form"},{default:(0,t.k6)(()=>[(0,t.bF)(u,{label:"标题"},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:V.title,"onUpdate:modelValue":l[0]||(l[0]=e=>V.title=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),(0,t.bF)(u,{label:"摘要"},{default:(0,t.k6)(()=>[(0,t.bF)(s,{modelValue:V.summary,"onUpdate:modelValue":l[1]||(l[1]=e=>V.summary=e),type:"textarea",rows:2,maxlength:"200","show-word-limit":"",placeholder:"简要概述条目"},null,8,["modelValue"])]),_:1}),(0,t.bF)(u,{label:"正文"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",v,[(0,t.Lk)("div",b,[(0,t.Lk)("div",f,[(0,t.bF)(r,{class:"upload-btn",action:"/api/files/upload?category=WIKI","show-file-list":!1,"before-upload":$,"on-success":K,"on-error":M},{default:(0,t.k6)(()=>[(0,t.bF)(a,{text:"",loading:F.value},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(F.value?"上传中...":"插入图片"),1)]),_:1},8,["loading"])]),_:1})]),(0,t.bF)(s,{modelValue:V.content,"onUpdate:modelValue":l[2]||(l[2]=e=>V.content=e),type:"textarea",rows:18,class:"markdown-input",placeholder:"支持 Markdown 语法，使用 # ## ### 定义标题，使用 ![](url) 插入图片"},null,8,["modelValue"]),C.value.length?((0,t.uX)(),(0,t.CE)("div",g,[l[5]||(l[5]=(0,t.Lk)("p",null,"已上传图片",-1)),(0,t.Lk)("div",h,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(C.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.uid,class:"image-thumb"},[(0,t.Lk)("img",{src:e.url,alt:e.url},null,8,w),(0,t.bF)(a,{text:"",type:"danger",size:"small",onClick:l=>I(e)},{default:(0,t.k6)(()=>[...l[4]||(l[4]=[(0,t.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])]))),128))])])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",y,[l[6]||(l[6]=(0,t.Lk)("div",{class:"preview-header"},[(0,t.Lk)("span",null,"实时预览")],-1)),(0,t.Lk)("div",{class:"preview-content",innerHTML:W.value},null,8,_)])])]),_:1})]),_:1},8,["model"])]),_:1})])}}},F=a(6262);const C=(0,F.A)(L,[["__scopeId","data-v-67eee9cd"]]);var V=C}}]);
//# sourceMappingURL=315.db42e7fd.js.map