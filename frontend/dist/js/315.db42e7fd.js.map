{"version":3,"file":"js/315.db42e7fd.js","mappings":"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","sources":["webpack://demo2/./src/views/wiki/WikiEditor.vue","webpack://demo2/./src/views/wiki/WikiEditor.vue?afe7"],"sourcesContent":["<template>\n  <div class=\"editor-page\">\n    <el-card>\n      <template #header>\n        <div class=\"header\">\n          <div>\n            <p class=\"eyebrow\">{{ isEdit ? '编辑条目' : '新建条目' }}</p>\n            <h2>{{ form.title || '未命名词条' }}</h2>\n          </div>\n          <div class=\"header-actions\">\n            <el-button @click=\"goBack\">返回列表</el-button>\n            <el-button type=\"primary\" :loading=\"loading\" @click=\"handleSubmit\">\n              {{ isEdit ? '提交更新' : '发布词条' }}\n            </el-button>\n          </div>\n        </div>\n      </template>\n      <el-form :model=\"form\" label-width=\"80px\" class=\"editor-form\">\n        <el-form-item label=\"标题\">\n          <el-input v-model=\"form.title\" placeholder=\"请输入标题\" />\n        </el-form-item>\n        <el-form-item label=\"摘要\">\n          <el-input\n            v-model=\"form.summary\"\n            type=\"textarea\"\n            :rows=\"2\"\n            maxlength=\"200\"\n            show-word-limit\n            placeholder=\"简要概述条目\"\n          />\n        </el-form-item>\n        <el-form-item label=\"正文\">\n          <div class=\"editor-grid\">\n            <div class=\"editor-panel\">\n              <div class=\"toolbar\">\n                <el-upload\n                  class=\"upload-btn\"\n                  action=\"/api/files/upload?category=WIKI\"\n                  :show-file-list=\"false\"\n                  :before-upload=\"beforeUpload\"\n                  :on-success=\"handleUploadSuccess\"\n                  :on-error=\"handleUploadError\"\n                >\n                  <el-button text :loading=\"uploadingImage\">\n                    {{ uploadingImage ? '上传中...' : '插入图片' }}\n                  </el-button>\n                </el-upload>\n              </div>\n              <el-input\n                v-model=\"form.content\"\n                type=\"textarea\"\n                :rows=\"18\"\n                class=\"markdown-input\"\n                placeholder=\"支持 Markdown 语法，使用 # ## ### 定义标题，使用 ![](url) 插入图片\"\n              />\n              <div class=\"uploaded-images\" v-if=\"uploadedImages.length\">\n                <p>已上传图片</p>\n                <div class=\"images-list\">\n                  <div\n                    v-for=\"item in uploadedImages\"\n                    :key=\"item.uid\"\n                    class=\"image-thumb\"\n                  >\n                    <img :src=\"item.url\" :alt=\"item.url\">\n                    <el-button text type=\"danger\" size=\"small\" @click=\"removeImage(item)\">\n                      删除\n                    </el-button>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"preview-panel\">\n              <div class=\"preview-header\">\n                <span>实时预览</span>\n              </div>\n              <div class=\"preview-content\" v-html=\"previewHtml\"></div>\n            </div>\n          </div>\n        </el-form-item>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { onMounted, reactive, computed, ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { createWikiPage, fetchWikiPage, updateWikiPage } from '@/api/wiki'\nimport { ElMessage } from 'element-plus'\nimport MarkdownIt from 'markdown-it'\nimport DOMPurify from 'dompurify'\n\nconst route = useRoute()\nconst router = useRouter()\nconst loading = ref(false)\nconst uploadingImage = ref(false)\nconst uploadedImages = ref([])\nconst form = reactive({\n  title: '',\n  summary: '',\n  content: ''\n})\n\nconst md = new MarkdownIt({\n  html: true,\n  linkify: true,\n  breaks: true\n})\n\nconst previewHtml = computed(() => {\n  if (!form.content) {\n    return '<p class=\"empty\">开始输入内容，实时预览会显示在这里</p>'\n  }\n  return DOMPurify.sanitize(md.render(form.content))\n})\n\nconst isEdit = computed(() => !!route.params.id)\n\nconst beforeUpload = (file) => {\n  const isImage = file.type.startsWith('image/')\n  const sizeOk = file.size / 1024 / 1024 < 5\n  if (!isImage) ElMessage.error('只能上传图片')\n  if (!sizeOk) ElMessage.error('图片需小于 5MB')\n  if (isImage && sizeOk) {\n    uploadingImage.value = true\n  }\n  return isImage && sizeOk\n}\n\nconst handleUploadSuccess = (response) => {\n  uploadingImage.value = false\n  if (response.code === 200 && response.data?.url) {\n    const url = response.data.url\n    const uid = response.data.id || `${Date.now()}`\n    uploadedImages.value.push({ uid, url })\n    const snippet = `![图片说明](${url})\\n`\n    form.content = `${form.content}\\n${snippet}`.trim()\n    ElMessage.success('图片已插入')\n  } else {\n    ElMessage.error('上传失败')\n  }\n}\n\nconst handleUploadError = () => {\n  uploadingImage.value = false\n  ElMessage.error('上传失败，请稍后再试')\n}\n\nconst removeImage = (item) => {\n  uploadedImages.value = uploadedImages.value.filter(img => img.uid !== item.uid)\n  const regex = new RegExp(`!\\\\[[^\\\\]]*\\\\]\\\\(${item.url.replace(/[.*+?^${}()|[\\\\]\\\\\\\\]/g, '\\\\$&')}\\\\)`, 'g')\n  form.content = form.content.replace(regex, '')\n}\n\nconst loadPage = async () => {\n  if (!isEdit.value) return\n  const res = await fetchWikiPage(route.params.id)\n  Object.assign(form, {\n    title: res.data.title,\n    summary: res.data.summary,\n    content: res.data.content\n  })\n}\n\nconst handleSubmit = async () => {\n  if (!form.title.trim() || !form.content.trim()) {\n    ElMessage.warning('标题和正文不能为空')\n    return\n  }\n  loading.value = true\n  try {\n    if (isEdit.value) {\n      await updateWikiPage(route.params.id, form)\n      ElMessage.success('已提交修改，等待审核')\n    } else {\n      await createWikiPage(form)\n      ElMessage.success('已提交，等待审核')\n    }\n    router.push('/wiki')\n  } finally {\n    loading.value = false\n  }\n}\n\nconst goBack = () => {\n  router.push('/wiki')\n}\n\nonMounted(() => {\n  loadPage()\n})\n</script>\n\n<style scoped>\n.editor-page {\n  max-width: 1100px;\n  margin: 0 auto;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 16px;\n}\n\n.header-actions {\n  display: flex;\n  gap: 12px;\n}\n\n.eyebrow {\n  font-size: 12px;\n  color: #909399;\n  margin: 0 0 4px;\n  letter-spacing: 1px;\n}\n\n.editor-form {\n  margin-top: 12px;\n}\n\n.editor-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n\n.editor-panel,\n.preview-panel {\n  border: 1px solid #ebeef5;\n  border-radius: 16px;\n  padding: 16px;\n  background: #fafafa;\n  display: flex;\n  flex-direction: column;\n}\n\n.toolbar {\n  display: flex;\n  justify-content: flex-end;\n  margin-bottom: 8px;\n}\n\n.markdown-input :deep(textarea) {\n  font-family: 'Fira Code', 'JetBrains Mono', Consolas, monospace;\n}\n\n.uploaded-images {\n  margin-top: 16px;\n}\n\n.images-list {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n}\n\n.image-thumb {\n  width: 120px;\n  border: 1px solid #dcdfe6;\n  border-radius: 8px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  background: #fff;\n}\n\n.image-thumb img {\n  width: 100%;\n  height: 80px;\n  object-fit: cover;\n}\n\n.preview-header {\n  font-weight: 600;\n  margin-bottom: 8px;\n  color: #606266;\n}\n\n.preview-content {\n  flex: 1;\n  background: #fff;\n  border-radius: 12px;\n  padding: 16px;\n  overflow: auto;\n  max-height: 520px;\n}\n\n.preview-content :deep(h1),\n.preview-content :deep(h2),\n.preview-content :deep(h3) {\n  margin: 16px 0 8px;\n}\n\n.preview-content :deep(img) {\n  max-width: 100%;\n  border-radius: 12px;\n}\n\n@media (max-width: 900px) {\n  .editor-grid {\n    grid-template-columns: 1fr;\n  }\n}\n</style>\n","import script from \"./WikiEditor.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./WikiEditor.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./WikiEditor.vue?vue&type=style&index=0&id=67eee9cd&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-67eee9cd\"]])\n\nexport default __exports__"],"names":["route","useRoute","router","useRouter","loading","ref","uploadingImage","uploadedImages","form","reactive","title","summary","content","md","MarkdownIt","html","linkify","breaks","previewHtml","computed","DOMPurify","sanitize","render","isEdit","params","id","beforeUpload","file","isImage","type","startsWith","sizeOk","size","ElMessage","error","value","handleUploadSuccess","response","code","data","url","uid","Date","now","push","snippet","trim","success","handleUploadError","removeImage","item","filter","img","regex","RegExp","replace","loadPage","async","res","fetchWikiPage","Object","assign","handleSubmit","updateWikiPage","createWikiPage","warning","goBack","onMounted","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","_component_el_button","onClick","_cache","_component_el_form","model","class","_component_el_form_item","label","_component_el_input","$event","placeholder","rows","maxlength","_hoisted_5","_hoisted_6","_hoisted_7","_component_el_upload","action","text","length","_hoisted_8","_hoisted_9","_Fragment","_renderList","key","src","alt","_hoisted_11","innerHTML","__exports__"],"ignoreList":[],"sourceRoot":""}