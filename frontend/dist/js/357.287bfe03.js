"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[357],{2357:function(e,a,s){s.r(a),s.d(a,{default:function(){return ue}});s(4114),s(8111),s(2489),s(1701);var t=s(641),l=s(33),i=s(953),u=s(5220),n=s(4353),r=s.n(n),o=s(8930),c=s(2549),d=s(6400),v=s(163),k=s(7918),m=s(3263),p=s(9418);const y={class:"wiki-detail-page"},g={key:0,class:"loading"},h={key:1,class:"not-found"},f={key:2,class:"wiki-layout"},w={class:"wiki-sidebar"},L={class:"toc"},C={class:"sidebar-actions"},b={class:"wiki-main"},E={class:"wiki-header"},_={class:"meta"},A={key:0,class:"wiki-summary"},X=["innerHTML"],F={class:"wiki-discussion"},W={class:"section-header"},I={key:0,class:"discussion-loading"},R={key:1},K={key:0,class:"discussion-form"},$={class:"discussion-actions"},z={key:1,class:"discussion-login"},V={key:2,class:"discussion-empty"},x={key:3,class:"discussion-list"},Q={class:"discussion-body"},T={class:"discussion-meta"},H={class:"author"},M={class:"time"},D={class:"discussion-text"},U={class:"wiki-history"},B={key:0,class:"history-empty"},Y={key:1,class:"history-list"},N={class:"history-editor"},j={class:"history-summary"},q={class:"history-meta"},G={class:"history-time"},P={class:"history-actions"},S={key:0,class:"revision-loading"},J={key:1,class:"revision-wrapper"},O={class:"revision-meta"},Z={key:0},ee=["innerHTML"],ae={key:0,class:"revision-actions"},se={key:2,class:"revision-empty"};var te={__name:"WikiDetail",setup(e){const a=(0,u.lq)(),s=(0,u.rd)(),n=(0,d.k)(),te=(0,i.KR)(null),le=(0,i.KR)([]),ie=(0,i.KR)(!0),ue=(0,i.KR)([]),ne=(0,i.KR)(!0),re=(0,i.KR)(""),oe=(0,i.KR)(!1),ce=(0,i.KR)(null),de=(0,i.KR)("overview"),ve=(0,i.KR)(!1),ke=(0,i.KR)(!1),me=(0,i.KR)(null),pe=(0,i.KR)(!1),ye=(0,i.KR)(null),ge=new m.A({html:!0,linkify:!0,breaks:!0}),he=(0,t.EW)(()=>te.value?.content?p.A.sanitize(ge.render(te.value.content)):'<p class="empty">这个条目暂无内容</p>'),fe=(0,t.EW)(()=>te.value?.content?te.value.content.split("\n").filter(e=>/^#{1,6}\s+/.test(e)).map(e=>{const a=e.match(/^#+/)[0].length;return{level:a,text:e.replace(/^#+/,"").trim()}}):[]),we=(0,t.EW)(()=>n.isLoggedIn),Le=(0,t.EW)(()=>me.value?.content?p.A.sanitize(ge.render(me.value.content)):'<p class="empty">该版本暂无正文内容</p>'),Ce=async()=>{ie.value=!0;try{const e=await(0,o.ET)(a.params.slug);te.value=e.data,await be(),await Ee(),_e()}catch(e){v.nk.error("加载词条失败")}finally{ie.value=!1}},be=async()=>{try{const e=await(0,o.Dz)(a.params.slug);le.value=e.data||[]}catch(e){le.value=[]}},Ee=async()=>{ne.value=!0;try{const e=await(0,o.Q5)(a.params.slug);ue.value=e.data||[]}catch(e){ue.value=[]}finally{ne.value=!1}},_e=async()=>{if(n.isLoggedIn&&te.value)try{await(0,c.fG)({targetType:"WIKI",targetId:te.value.id,title:te.value.title,summary:te.value.summary})}catch(e){}},Ae=e=>e?r()(e).format("YYYY年M月D日 HH:mm"):"",Xe=()=>{te.value&&s.push(`/wiki/edit/${te.value.id}`)},Fe=async()=>{if(n.isLoggedIn)try{const e=await(0,o.ko)(te.value.id);te.value.favorited=e.data,v.nk.success(te.value.favorited?"已收藏":"已取消收藏")}catch(e){v.nk.error("操作失败")}else s.push("/login")},We=()=>{n.isLoggedIn?ce.value?.focus():Re()},Ie=async()=>{if(n.isLoggedIn)if(re.value.trim()){oe.value=!0;try{const e=await(0,o.zj)(a.params.slug,{content:re.value.trim()});ue.value.unshift(e.data),re.value="",v.nk.success("讨论已发布")}catch(e){v.nk.error(e.response?.data?.message||"发布失败")}finally{oe.value=!1}}else v.nk.warning("请输入讨论内容");else Re()},Re=()=>{s.push("/login")},Ke=async e=>{ve.value=!0,ke.value=!0,me.value={...e};try{const s=await(0,o.dV)(a.params.slug,e.id);me.value=s.data}catch(s){ve.value=!1,v.nk.error(s.response?.data?.message||"加载历史版本失败")}finally{ke.value=!1}},$e=async e=>{if(n.isLoggedIn){try{await k.s.confirm("确认将当前词条内容恢复到该历史版本吗？该操作会覆盖当前内容。","确认恢复",{type:"warning",confirmButtonText:"确认恢复",cancelButtonText:"取消"})}catch{return}pe.value=!0,ye.value=e.id;try{await(0,o.m6)(a.params.slug,e.id),v.nk.success("词条已恢复到所选版本"),ve.value=!1,await Ce()}catch(s){v.nk.error(s.response?.data?.message||"恢复失败")}finally{pe.value=!1,ye.value=null}}else Re()};return(0,t.sV)(()=>{Ce()}),(0,t.wB)(()=>a.params.slug,(e,a)=>{e&&e!==a&&Ce()}),(e,a)=>{const s=(0,t.g2)("el-skeleton"),u=(0,t.g2)("el-empty"),r=(0,t.g2)("el-button"),o=(0,t.g2)("el-tag"),c=(0,t.g2)("el-tab-pane"),d=(0,t.g2)("el-input"),v=(0,t.g2)("el-avatar"),k=(0,t.g2)("el-tabs"),m=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",y,[ie.value?((0,t.uX)(),(0,t.CE)("div",g,[(0,t.bF)(s,{rows:6,animated:""})])):te.value?((0,t.uX)(),(0,t.CE)("div",f,[(0,t.Lk)("aside",w,[a[6]||(a[6]=(0,t.Lk)("div",{class:"cover"},[(0,t.Lk)("img",{src:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600",alt:"concept"})],-1)),(0,t.Lk)("div",L,[a[4]||(a[4]=(0,t.Lk)("h4",null,"目录",-1)),(0,t.Lk)("ul",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(fe.value,(e,a)=>((0,t.uX)(),(0,t.CE)("li",{key:a},[(0,t.Lk)("span",null,(0,l.v_)(e.text),1)]))),128))])]),(0,t.Lk)("div",C,[(0,t.bF)(r,{type:"primary",plain:"",size:"small",onClick:Fe},{default:(0,t.k6)(()=>[(0,t.eW)((0,l.v_)(te.value.favorited?"已收藏":"收藏词条"),1)]),_:1}),(0,i.R1)(n).isLoggedIn&&we.value?((0,t.uX)(),(0,t.Wv)(r,{key:0,size:"small",onClick:Xe},{default:(0,t.k6)(()=>[...a[5]||(a[5]=[(0,t.eW)("编辑条目",-1)])]),_:1})):(0,t.Q3)("",!0)])]),(0,t.Lk)("main",b,[(0,t.Lk)("header",E,[(0,t.Lk)("div",null,[a[7]||(a[7]=(0,t.Lk)("p",{class:"eyebrow"},"词条",-1)),(0,t.Lk)("h1",null,(0,l.v_)(te.value.title),1),(0,t.Lk)("p",_," 最后更新 "+(0,l.v_)(Ae(te.value.updatedAt))+" · "+(0,l.v_)(te.value.lastEditorName||"系统"),1)]),"PUBLISHED"===te.value.status?((0,t.uX)(),(0,t.Wv)(o,{key:0,type:"success"},{default:(0,t.k6)(()=>[...a[8]||(a[8]=[(0,t.eW)("已发布",-1)])]),_:1})):(0,t.Q3)("",!0)]),(0,t.bF)(k,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),class:"wiki-tabs"},{default:(0,t.k6)(()=>[(0,t.bF)(c,{label:"条目信息",name:"overview"},{default:(0,t.k6)(()=>[te.value.summary?((0,t.uX)(),(0,t.CE)("section",A,[a[9]||(a[9]=(0,t.Lk)("h4",null,"概要",-1)),(0,t.Lk)("p",null,(0,l.v_)(te.value.summary),1)])):(0,t.Q3)("",!0),(0,t.Lk)("article",{class:"wiki-article",innerHTML:he.value},null,8,X)]),_:1}),(0,t.bF)(c,{label:"用户讨论",name:"discussion"},{default:(0,t.k6)(()=>[(0,t.Lk)("section",F,[(0,t.Lk)("div",W,[a[11]||(a[11]=(0,t.Lk)("h3",null,"讨论",-1)),(0,t.bF)(r,{text:"",size:"small",onClick:We},{default:(0,t.k6)(()=>[...a[10]||(a[10]=[(0,t.eW)("发起讨论",-1)])]),_:1})]),ne.value?((0,t.uX)(),(0,t.CE)("div",I,[(0,t.bF)(s,{rows:3,animated:""})])):((0,t.uX)(),(0,t.CE)("div",R,[(0,i.R1)(n).isLoggedIn?((0,t.uX)(),(0,t.CE)("div",K,[(0,t.bF)(d,{ref_key:"discussionInputRef",ref:ce,modelValue:re.value,"onUpdate:modelValue":a[0]||(a[0]=e=>re.value=e),type:"textarea",placeholder:"写下你的问题或观点...",rows:3,maxlength:"1000","show-word-limit":""},null,8,["modelValue"]),(0,t.Lk)("div",$,[(0,t.bF)(r,{type:"primary",size:"small",loading:oe.value,onClick:Ie},{default:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.eW)(" 发布讨论 ",-1)])]),_:1},8,["loading"])])])):((0,t.uX)(),(0,t.CE)("div",z,[(0,t.bF)(r,{type:"text",onClick:Re},{default:(0,t.k6)(()=>[...a[13]||(a[13]=[(0,t.eW)("登录后参与讨论",-1)])]),_:1})])),0===ue.value.length?((0,t.uX)(),(0,t.CE)("div",V,[(0,t.bF)(u,{description:"暂时还没有讨论，快来参与吧"})])):((0,t.uX)(),(0,t.CE)("div",x,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(ue.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"discussion-item"},[(0,t.bF)(v,{src:e.author?.avatarUrl,size:36},null,8,["src"]),(0,t.Lk)("div",Q,[(0,t.Lk)("div",T,[(0,t.Lk)("span",H,(0,l.v_)(e.author?.username||"匿名用户"),1),(0,t.Lk)("span",M,(0,l.v_)(Ae(e.createdAt)),1)]),(0,t.Lk)("p",D,(0,l.v_)(e.content),1)])]))),128))]))]))])]),_:1}),(0,t.bF)(c,{label:"历史版本",name:"history"},{default:(0,t.k6)(()=>[(0,t.Lk)("section",U,[a[16]||(a[16]=(0,t.Lk)("div",{class:"section-header"},[(0,t.Lk)("h3",null,"历史版本")],-1)),0===le.value.length?((0,t.uX)(),(0,t.CE)("div",B,[(0,t.bF)(u,{description:"暂无历史记录"})])):((0,t.uX)(),(0,t.CE)("div",Y,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(le.value,e=>((0,t.uX)(),(0,t.CE)("div",{key:e.id,class:"history-item"},[(0,t.Lk)("div",null,[(0,t.Lk)("p",N,(0,l.v_)(e.editorName),1),(0,t.Lk)("p",j,(0,l.v_)(e.summary||"更新了词条内容"),1)]),(0,t.Lk)("div",q,[(0,t.Lk)("span",G,(0,l.v_)(Ae(e.createdAt)),1),(0,t.Lk)("div",P,[(0,t.bF)(r,{size:"small",text:"",onClick:a=>Ke(e)},{default:(0,t.k6)(()=>[...a[14]||(a[14]=[(0,t.eW)("查看内容",-1)])]),_:1},8,["onClick"]),(0,i.R1)(n).isLoggedIn?((0,t.uX)(),(0,t.Wv)(r,{key:0,size:"small",type:"primary",plain:"",loading:pe.value&&ye.value===e.id,onClick:a=>$e(e)},{default:(0,t.k6)(()=>[...a[15]||(a[15]=[(0,t.eW)(" 恢复 ",-1)])]),_:1},8,["loading","onClick"])):(0,t.Q3)("",!0)])])]))),128))]))])]),_:1})]),_:1},8,["modelValue"])])])):((0,t.uX)(),(0,t.CE)("div",h,[(0,t.bF)(u,{description:"词条不存在或已被删除"})])),(0,t.bF)(m,{modelValue:ve.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.value=e),class:"revision-dialog",width:"820px",title:me.value?`版本详情 · ${me.value.editorName}`:"版本详情"},{default:(0,t.k6)(()=>[ke.value?((0,t.uX)(),(0,t.CE)("div",S,[(0,t.bF)(s,{rows:6,animated:""})])):me.value?((0,t.uX)(),(0,t.CE)("div",J,[(0,t.Lk)("p",O,[(0,t.eW)(" 更新于 "+(0,l.v_)(Ae(me.value.createdAt))+" ",1),me.value.summary?((0,t.uX)(),(0,t.CE)("span",Z,"· "+(0,l.v_)(me.value.summary),1)):(0,t.Q3)("",!0)]),(0,t.Lk)("div",{class:"revision-preview",innerHTML:Le.value},null,8,ee),(0,i.R1)(n).isLoggedIn?((0,t.uX)(),(0,t.CE)("div",ae,[(0,t.bF)(r,{type:"primary",plain:"",loading:pe.value,onClick:a[2]||(a[2]=e=>$e(me.value))},{default:(0,t.k6)(()=>[...a[17]||(a[17]=[(0,t.eW)(" 恢复为当前版本 ",-1)])]),_:1},8,["loading"])])):(0,t.Q3)("",!0)])):((0,t.uX)(),(0,t.CE)("div",se,[(0,t.bF)(u,{description:"无法加载该版本内容"})]))]),_:1},8,["modelValue","title"])])}}},le=s(6262);const ie=(0,le.A)(te,[["__scopeId","data-v-7bc35e72"]]);var ue=ie},2549:function(e,a,s){s.d(a,{Eo:function(){return k},Qt:function(){return r},ec:function(){return u},fG:function(){return v},hP:function(){return d},hc:function(){return o},l2:function(){return l},pV:function(){return n},qw:function(){return c},r7:function(){return i}});var t=s(7277);const l=e=>(0,t.A)({url:`/users/${e}`,method:"get"}),i=e=>(0,t.A)({url:"/users/profile",method:"put",data:e}),u=e=>(0,t.A)({url:"/users/password",method:"put",data:e}),n=e=>(0,t.A)({url:`/users/${e}/follow`,method:"post"}),r=e=>(0,t.A)({url:`/users/${e}/follow`,method:"delete"}),o=()=>(0,t.A)({url:"/users/followees",method:"get"}),c=e=>(0,t.A)({url:"/collections",method:"get",params:e}),d=e=>(0,t.A)({url:"/footprints",method:"get",params:e}),v=e=>(0,t.A)({url:"/footprints",method:"post",data:e}),k=e=>(0,t.A)({url:`/users/${e}/block-recommend`,method:"post"})},8930:function(e,a,s){s.d(a,{Dz:function(){return u},ET:function(){return i},FW:function(){return l},MC:function(){return v},Q5:function(){return o},Wb:function(){return d},dV:function(){return n},ko:function(){return m},m6:function(){return r},xl:function(){return k},zj:function(){return c}});var t=s(7277);const l=e=>(0,t.A)({url:"/wiki/pages",method:"get",params:e}),i=e=>(0,t.A)({url:`/wiki/pages/${e}`,method:"get"}),u=e=>(0,t.A)({url:`/wiki/pages/${e}/history`,method:"get"}),n=(e,a)=>(0,t.A)({url:`/wiki/pages/${e}/history/${a}`,method:"get"}),r=(e,a)=>(0,t.A)({url:`/wiki/pages/${e}/history/${a}/restore`,method:"post"}),o=e=>(0,t.A)({url:`/wiki/pages/${e}/discussions`,method:"get"}),c=(e,a)=>(0,t.A)({url:`/wiki/pages/${e}/discussions`,method:"post",data:a}),d=()=>(0,t.A)({url:"/wiki/pages/stats",method:"get"}),v=e=>(0,t.A)({url:"/wiki/pages",method:"post",data:e}),k=(e,a)=>(0,t.A)({url:`/wiki/pages/${e}`,method:"put",data:a}),m=e=>(0,t.A)({url:`/wiki/pages/${e}/favorite`,method:"post"})}}]);
//# sourceMappingURL=357.287bfe03.js.map