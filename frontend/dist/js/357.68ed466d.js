"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[357],{2357:function(e,a,l){l.r(a),l.d(a,{default:function(){return ue}});l(4114),l(8111),l(2489),l(1701);var s=l(641),t=l(33),i=l(953),u=l(5220),n=l(4353),o=l.n(n),r=l(8930),c=l(2549),d=l(6400),v=l(163),k=l(7918),m=l(3263),p=l(9418);const y={class:"wiki-detail-page"},g={key:0,class:"loading"},f={key:1,class:"not-found"},h={key:2,class:"wiki-layout"},L={class:"wiki-sidebar"},w={class:"toc"},C={class:"sidebar-actions"},b={class:"wiki-main"},_={class:"wiki-header"},E={class:"meta"},X={key:0,class:"wiki-summary"},F=["innerHTML"],I={class:"wiki-discussion"},R={class:"section-header"},W={key:0,class:"discussion-loading"},K={key:1},A={key:0,class:"discussion-form"},V={class:"discussion-actions"},x={key:1,class:"discussion-login"},z={key:2,class:"discussion-empty"},Q={key:3,class:"discussion-list"},T={class:"discussion-body"},H={class:"discussion-meta"},M={class:"author"},U={class:"time"},$={class:"discussion-text"},B={class:"wiki-history"},D={key:0,class:"history-empty"},Y={key:1,class:"history-list"},N={class:"history-editor"},q={class:"history-summary"},G={class:"history-meta"},P={class:"history-time"},j={class:"history-actions"},S={key:0,class:"revision-loading"},J={key:1,class:"revision-wrapper"},O={class:"revision-meta"},Z={key:0},ee=["innerHTML"],ae={key:0,class:"revision-actions"},le={key:2,class:"revision-empty"};var se={__name:"WikiDetail",setup(e){const a=(0,u.lq)(),l=(0,u.rd)(),n=(0,d.k)(),se=(0,i.KR)(null),te=(0,i.KR)([]),ie=(0,i.KR)(!0),ue=(0,i.KR)([]),ne=(0,i.KR)(!0),oe=(0,i.KR)(""),re=(0,i.KR)(!1),ce=(0,i.KR)(null),de=(0,i.KR)("overview"),ve=(0,i.KR)(!1),ke=(0,i.KR)(!1),me=(0,i.KR)(null),pe=(0,i.KR)(!1),ye=(0,i.KR)(null),ge=new m.A({html:!0,linkify:!0,breaks:!0}),fe=(0,s.EW)(()=>se.value?.content?p.A.sanitize(ge.render(se.value.content)):'<p class="empty">这个条目暂无内容</p>'),he=(0,s.EW)(()=>se.value?.content?se.value.content.split("\n").filter(e=>/^#{1,6}\s+/.test(e)).map(e=>{const a=e.match(/^#+/)[0].length;return{level:a,text:e.replace(/^#+/,"").trim()}}):[]),Le=(0,s.EW)(()=>n.isLoggedIn),we=(0,s.EW)(()=>me.value?.content?p.A.sanitize(ge.render(me.value.content)):'<p class="empty">该版本暂无正文内容</p>'),Ce=async()=>{ie.value=!0;try{const e=await(0,r.ET)(a.params.slug);se.value=e.data,await be(),await _e(),Ee()}catch(e){v.nk.error("加载词条失败")}finally{ie.value=!1}},be=async()=>{try{const e=await(0,r.Dz)(a.params.slug);te.value=e.data||[]}catch(e){te.value=[]}},_e=async()=>{ne.value=!0;try{const e=await(0,r.Q5)(a.params.slug);ue.value=e.data||[]}catch(e){ue.value=[]}finally{ne.value=!1}},Ee=async()=>{if(n.isLoggedIn&&se.value)try{await(0,c.fG)({targetType:"WIKI",targetId:se.value.id,title:se.value.title,summary:se.value.summary})}catch(e){}},Xe=e=>e?o()(e).format("YYYY年M月D日 HH:mm"):"",Fe=()=>{se.value&&l.push(`/wiki/edit/${se.value.id}`)},Ie=async()=>{if(n.isLoggedIn)try{const e=await(0,r.ko)(se.value.id);se.value.favorited=e.data,v.nk.success(se.value.favorited?"已收藏":"已取消收藏")}catch(e){v.nk.error("操作失败")}else l.push("/login")},Re=()=>{n.isLoggedIn?ce.value?.focus():Ke()},We=async()=>{if(n.isLoggedIn)if(oe.value.trim()){re.value=!0;try{const e=await(0,r.zj)(a.params.slug,{content:oe.value.trim()});ue.value.unshift(e.data),oe.value="",v.nk.success("讨论已发布")}catch(e){v.nk.error(e.response?.data?.message||"发布失败")}finally{re.value=!1}}else v.nk.warning("请输入讨论内容");else Ke()},Ke=()=>{l.push("/login")},Ae=async e=>{ve.value=!0,ke.value=!0,me.value={...e};try{const l=await(0,r.dV)(a.params.slug,e.id);me.value=l.data}catch(l){ve.value=!1,v.nk.error(l.response?.data?.message||"加载历史版本失败")}finally{ke.value=!1}},Ve=async e=>{if(n.isLoggedIn){try{await k.s.confirm("确认将当前词条内容恢复到该历史版本吗？该操作会覆盖当前内容。","确认恢复",{type:"warning",confirmButtonText:"确认恢复",cancelButtonText:"取消"})}catch{return}pe.value=!0,ye.value=e.id;try{await(0,r.m6)(a.params.slug,e.id),v.nk.success("词条已恢复到所选版本"),ve.value=!1,await Ce()}catch(l){v.nk.error(l.response?.data?.message||"恢复失败")}finally{pe.value=!1,ye.value=null}}else Ke()};return(0,s.sV)(()=>{Ce()}),(0,s.wB)(()=>a.params.slug,(e,a)=>{e&&e!==a&&Ce()}),(e,a)=>{const l=(0,s.g2)("el-skeleton"),u=(0,s.g2)("el-empty"),o=(0,s.g2)("el-button"),r=(0,s.g2)("el-tag"),c=(0,s.g2)("el-tab-pane"),d=(0,s.g2)("el-input"),v=(0,s.g2)("el-avatar"),k=(0,s.g2)("el-tabs"),m=(0,s.g2)("el-dialog");return(0,s.uX)(),(0,s.CE)("div",y,[ie.value?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.bF)(l,{rows:6,animated:""})])):se.value?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("aside",L,[a[6]||(a[6]=(0,s.Lk)("div",{class:"cover"},[(0,s.Lk)("img",{src:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600",alt:"concept"})],-1)),(0,s.Lk)("div",w,[a[4]||(a[4]=(0,s.Lk)("h4",null,"目录",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(he.value,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},[(0,s.Lk)("span",null,(0,t.v_)(e.text),1)]))),128))])]),(0,s.Lk)("div",C,[(0,s.bF)(o,{type:"primary",plain:"",size:"small",onClick:Ie},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(se.value.favorited?"已收藏":"收藏词条"),1)]),_:1}),(0,i.R1)(n).isLoggedIn&&Le.value?((0,s.uX)(),(0,s.Wv)(o,{key:0,size:"small",onClick:Fe},{default:(0,s.k6)(()=>[...a[5]||(a[5]=[(0,s.eW)("编辑条目",-1)])]),_:1})):(0,s.Q3)("",!0)])]),(0,s.Lk)("main",b,[(0,s.Lk)("header",_,[(0,s.Lk)("div",null,[a[7]||(a[7]=(0,s.Lk)("p",{class:"eyebrow"},"词条",-1)),(0,s.Lk)("h1",null,(0,t.v_)(se.value.title),1),(0,s.Lk)("p",E," 最后更新 "+(0,t.v_)(Xe(se.value.updatedAt))+" · "+(0,t.v_)(se.value.lastEditorName||"系统"),1)]),"PUBLISHED"===se.value.status?((0,s.uX)(),(0,s.Wv)(r,{key:0,type:"success"},{default:(0,s.k6)(()=>[...a[8]||(a[8]=[(0,s.eW)("已发布",-1)])]),_:1})):(0,s.Q3)("",!0)]),(0,s.bF)(k,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),class:"wiki-tabs"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{label:"条目信息",name:"overview"},{default:(0,s.k6)(()=>[se.value.summary?((0,s.uX)(),(0,s.CE)("section",X,[a[9]||(a[9]=(0,s.Lk)("h4",null,"概要",-1)),(0,s.Lk)("p",null,(0,t.v_)(se.value.summary),1)])):(0,s.Q3)("",!0),(0,s.Lk)("article",{class:"wiki-article",innerHTML:fe.value},null,8,F)]),_:1}),(0,s.bF)(c,{label:"用户讨论",name:"discussion"},{default:(0,s.k6)(()=>[(0,s.Lk)("section",I,[(0,s.Lk)("div",R,[a[11]||(a[11]=(0,s.Lk)("h3",null,"讨论",-1)),(0,s.bF)(o,{text:"",size:"small",onClick:Re},{default:(0,s.k6)(()=>[...a[10]||(a[10]=[(0,s.eW)("发起讨论",-1)])]),_:1})]),ne.value?((0,s.uX)(),(0,s.CE)("div",W,[(0,s.bF)(l,{rows:3,animated:""})])):((0,s.uX)(),(0,s.CE)("div",K,[(0,i.R1)(n).isLoggedIn?((0,s.uX)(),(0,s.CE)("div",A,[(0,s.bF)(d,{ref_key:"discussionInputRef",ref:ce,modelValue:oe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.value=e),type:"textarea",placeholder:"写下你的问题或观点...",rows:3,maxlength:"1000","show-word-limit":""},null,8,["modelValue"]),(0,s.Lk)("div",V,[(0,s.bF)(o,{type:"primary",size:"small",loading:re.value,onClick:We},{default:(0,s.k6)(()=>[...a[12]||(a[12]=[(0,s.eW)(" 发布讨论 ",-1)])]),_:1},8,["loading"])])])):((0,s.uX)(),(0,s.CE)("div",x,[(0,s.bF)(o,{type:"text",onClick:Ke},{default:(0,s.k6)(()=>[...a[13]||(a[13]=[(0,s.eW)("登录后参与讨论",-1)])]),_:1})])),0===ue.value.length?((0,s.uX)(),(0,s.CE)("div",z,[(0,s.bF)(u,{description:"暂时还没有讨论，快来参与吧"})])):((0,s.uX)(),(0,s.CE)("div",Q,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ue.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"discussion-item"},[(0,s.bF)(v,{src:e.author?.avatarUrl,size:36},null,8,["src"]),(0,s.Lk)("div",T,[(0,s.Lk)("div",H,[(0,s.Lk)("span",M,(0,t.v_)(e.author?.username||"匿名用户"),1),(0,s.Lk)("span",U,(0,t.v_)(Xe(e.createdAt)),1)]),(0,s.Lk)("p",$,(0,t.v_)(e.content),1)])]))),128))]))]))])]),_:1}),(0,s.bF)(c,{label:"历史版本",name:"history"},{default:(0,s.k6)(()=>[(0,s.Lk)("section",B,[a[16]||(a[16]=(0,s.Lk)("div",{class:"section-header"},[(0,s.Lk)("h3",null,"历史版本")],-1)),0===te.value.length?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.bF)(u,{description:"暂无历史记录"})])):((0,s.uX)(),(0,s.CE)("div",Y,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"history-item"},[(0,s.Lk)("div",null,[(0,s.Lk)("p",N,(0,t.v_)(e.editorName),1),(0,s.Lk)("p",q,(0,t.v_)(e.summary||"更新了词条内容"),1)]),(0,s.Lk)("div",G,[(0,s.Lk)("span",P,(0,t.v_)(Xe(e.createdAt)),1),(0,s.Lk)("div",j,[(0,s.bF)(o,{size:"small",text:"",onClick:a=>Ae(e)},{default:(0,s.k6)(()=>[...a[14]||(a[14]=[(0,s.eW)("查看内容",-1)])]),_:1},8,["onClick"]),(0,i.R1)(n).isLoggedIn?((0,s.uX)(),(0,s.Wv)(o,{key:0,size:"small",type:"primary",plain:"",loading:pe.value&&ye.value===e.id,onClick:a=>Ve(e)},{default:(0,s.k6)(()=>[...a[15]||(a[15]=[(0,s.eW)(" 恢复 ",-1)])]),_:1},8,["loading","onClick"])):(0,s.Q3)("",!0)])])]))),128))]))])]),_:1})]),_:1},8,["modelValue"])])])):((0,s.uX)(),(0,s.CE)("div",f,[(0,s.bF)(u,{description:"词条不存在或已被删除"})])),(0,s.bF)(m,{modelValue:ve.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ve.value=e),class:"revision-dialog",width:"820px",title:me.value?`版本详情 · ${me.value.editorName}`:"版本详情"},{default:(0,s.k6)(()=>[ke.value?((0,s.uX)(),(0,s.CE)("div",S,[(0,s.bF)(l,{rows:6,animated:""})])):me.value?((0,s.uX)(),(0,s.CE)("div",J,[(0,s.Lk)("p",O,[(0,s.eW)(" 更新于 "+(0,t.v_)(Xe(me.value.createdAt))+" ",1),me.value.summary?((0,s.uX)(),(0,s.CE)("span",Z,"· "+(0,t.v_)(me.value.summary),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:"revision-preview",innerHTML:we.value},null,8,ee),(0,i.R1)(n).isLoggedIn?((0,s.uX)(),(0,s.CE)("div",ae,[(0,s.bF)(o,{type:"primary",plain:"",loading:pe.value,onClick:a[2]||(a[2]=e=>Ve(me.value))},{default:(0,s.k6)(()=>[...a[17]||(a[17]=[(0,s.eW)(" 恢复为当前版本 ",-1)])]),_:1},8,["loading"])])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",le,[(0,s.bF)(u,{description:"无法加载该版本内容"})]))]),_:1},8,["modelValue","title"])])}}},te=l(6262);const ie=(0,te.A)(se,[["__scopeId","data-v-7bc35e72"]]);var ue=ie},2549:function(e,a,l){l.d(a,{Qt:function(){return o},ec:function(){return u},fG:function(){return v},hP:function(){return d},hc:function(){return r},l2:function(){return t},pV:function(){return n},qw:function(){return c},r7:function(){return i}});var s=l(7277);const t=e=>(0,s.A)({url:`/users/${e}`,method:"get"}),i=e=>(0,s.A)({url:"/users/profile",method:"put",data:e}),u=e=>(0,s.A)({url:"/users/password",method:"put",data:e}),n=e=>(0,s.A)({url:`/users/${e}/follow`,method:"post"}),o=e=>(0,s.A)({url:`/users/${e}/follow`,method:"delete"}),r=()=>(0,s.A)({url:"/users/followees",method:"get"}),c=e=>(0,s.A)({url:"/collections",method:"get",params:e}),d=e=>(0,s.A)({url:"/footprints",method:"get",params:e}),v=e=>(0,s.A)({url:"/footprints",method:"post",data:e})}}]);
//# sourceMappingURL=357.68ed466d.js.map