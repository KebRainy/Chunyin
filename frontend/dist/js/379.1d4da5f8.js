"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[379],{379:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});t(4114);var l=t(641),r=t(33),i=t(953),n=t(5220),u=t(163),s=t(7918),o=t(8548),c=t(8027),d=t(6379),v=t(6901);const p={class:"activity-list"},m={class:"page-header"},g={class:"activity-title"},k={class:"activity-time"},y={key:0,class:"activity-bar"},b={class:"activity-grid"},f={class:"activity-info"},h={class:"activity-header"},_={class:"activity-title"},w={class:"activity-meta"},C={class:"activity-time"},E={key:0,class:"activity-bar"},F={class:"activity-participants"},R={key:1,class:"activity-organizer"},N={key:0,class:"activity-remark"},A={class:"activity-grid"},W={class:"activity-info"},I={class:"activity-header"},X={class:"activity-title"},z={class:"activity-meta"},K={class:"activity-time"},P={key:0,class:"activity-bar"},L={class:"activity-participants"},D={key:1,class:"activity-organizer"},V={key:0,class:"activity-remark"};var x={__name:"ActivityList",setup(e){const a=(0,n.rd)(),t=(0,n.lq)(),x=(0,l.EW)(()=>"/admin/activities/review"===t.path),U=(0,i.KR)("recommended"),Q=(0,i.KR)(!1),G=(0,i.KR)([]),T=(0,i.KR)(1),j=(0,i.KR)(0),S=(0,i.KR)([]),$=(0,i.KR)(1),O=(0,i.KR)(0),J=(0,i.KR)([]),B=(0,i.KR)(1),q=(0,i.KR)(0),H=(0,i.KR)(!1),M=(0,i.KR)(null),Y=(0,i.KR)({rejectReason:""}),Z=(0,i.KR)(10),ee=(0,i.KR)({barId:null,beverageId:null}),ae=(0,i.KR)([]),te=(0,i.KR)([]),le=async()=>{Q.value=!0;try{const e=await(0,c.dR)(ee.value.barId,ee.value.beverageId,T.value,Z.value);200===e.code&&(G.value=e.data?.items||[],j.value=e.data?.total||0)}catch(e){console.error("加载推荐活动失败:",e),401===e.response?.status?u.nk.warning("请先登录"):u.nk.error(e.response?.data?.message||"加载推荐活动失败")}finally{Q.value=!1}},re=async()=>{Q.value=!0;try{const e=await(0,c.AJ)($.value,Z.value);200===e.code&&(S.value=e.data?.items||[],O.value=e.data?.total||0)}catch(e){console.error("加载我参与的活动失败:",e),401===e.response?.status?u.nk.warning("请先登录"):u.nk.error(e.response?.data?.message||"加载我参与的活动失败")}finally{Q.value=!1}},ie=async()=>{try{const e=await(0,v.pM)({limit:100});200===e.code&&(ae.value=e.data||[])}catch(e){console.error("加载酒吧列表失败",e),400===e.response?.status&&console.warn("参数错误，但不影响登录状态:",e.response?.data?.message)}},ne=async()=>{try{const e=await(0,d.Um)({limit:100});200===e.code&&(te.value=e.data?.items||e.data||[])}catch(e){console.error("加载酒类列表失败",e)}},ue=e=>{"recommended"===e?le():"participated"===e&&re()},se=async()=>{Q.value=!0;try{const e=await(0,c.h3)(B.value,Z.value);200===e.code&&(J.value=e.data?.items||[],q.value=e.data?.total||0)}catch(e){console.error("加载待审核活动失败:",e),401===e.response?.status?u.nk.warning("请先登录"):403===e.response?.status?u.nk.warning("需要管理员权限"):u.nk.error(e.response?.data?.message||"加载待审核活动失败")}finally{Q.value=!1}},oe=async e=>{try{await s.s.confirm("确定要通过此活动吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),Q.value=!0;try{const a=await(0,c.kz)(e.id,{status:"APPROVED"});200===a.code&&(u.nk.success("审核通过"),await se())}catch(a){u.nk.error(a.response?.data?.message||"审核失败")}finally{Q.value=!1}}catch{}},ce=e=>{M.value=e,Y.value.rejectReason="",H.value=!0},de=async()=>{if(Y.value.rejectReason&&Y.value.rejectReason.trim()){Q.value=!0;try{const e=await(0,c.kz)(M.value.id,{status:"REJECTED",rejectReason:Y.value.rejectReason});200===e.code&&(u.nk.success("已拒绝"),H.value=!1,await se())}catch(e){u.nk.error(e.response?.data?.message||"操作失败")}finally{Q.value=!1}}else u.nk.warning("请输入拒绝原因")},ve=()=>{ee.value={barId:null,beverageId:null},le()},pe=e=>{a.push(`/activities/${e}`)},me=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},ge=e=>{const a={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已拒绝",ONGOING:"进行中",FINISHED:"已结束",CANCELLED:"已取消"};return a[e]||e},ke=e=>{const a={PENDING:"warning",APPROVED:"success",REJECTED:"danger",ONGOING:"primary",FINISHED:"info",CANCELLED:"info"};return a[e]||""},ye=e=>{const a={PENDING:"待审核",APPROVED:"已通过",REJECTED:"已拒绝"};return a[e]||e},be=e=>{const a={PENDING:"warning",APPROVED:"success",REJECTED:"danger"};return a[e]||""};return(0,l.sV)(()=>{x.value?se():(le(),ie(),ne())}),(e,a)=>{const t=(0,l.g2)("el-table-column"),n=(0,l.g2)("el-tag"),u=(0,l.g2)("el-button"),s=(0,l.g2)("el-table"),c=(0,l.g2)("el-pagination"),d=(0,l.g2)("el-card"),v=(0,l.g2)("el-input"),M=(0,l.g2)("el-form-item"),ie=(0,l.g2)("el-form"),ne=(0,l.g2)("el-dialog"),fe=(0,l.g2)("el-option"),he=(0,l.g2)("el-select"),_e=(0,l.g2)("el-empty"),we=(0,l.g2)("el-icon"),Ce=(0,l.g2)("el-tab-pane"),Ee=(0,l.g2)("el-tabs"),Fe=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",p,[(0,l.Lk)("div",m,[(0,l.Lk)("h2",null,(0,r.v_)(x.value?"活动审核":"活动中心"),1)]),x.value?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(s,{data:J.value,stripe:""},{default:(0,l.k6)(()=>[(0,l.bF)(t,{prop:"id",label:"ID",width:"80"}),(0,l.bF)(t,{label:"活动信息","min-width":"200"},{default:(0,l.k6)(({row:e})=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",g,(0,r.v_)(e.beverageName)+" 组局",1),(0,l.Lk)("div",k,(0,r.v_)(me(e.activityTime)),1),e.barName?((0,l.uX)(),(0,l.CE)("div",y,"酒吧："+(0,r.v_)(e.barName),1)):(0,l.Q3)("",!0)])]),_:1}),(0,l.bF)(t,{label:"发起者",width:"120"},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,r.v_)(e.organizerName),1)]),_:1}),(0,l.bF)(t,{label:"参与人数",width:"120"},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,r.v_)(e.currentParticipants)+" / "+(0,r.v_)(e.maxParticipants),1)]),_:1}),(0,l.bF)(t,{label:"状态",width:"100"},{default:(0,l.k6)(({row:e})=>[(0,l.bF)(n,{type:be(e.reviewStatus)},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(ye(e.reviewStatus)),1)]),_:2},1032,["type"])]),_:1}),(0,l.bF)(t,{prop:"createdAt",label:"创建时间",width:"180"},{default:(0,l.k6)(({row:e})=>[(0,l.eW)((0,r.v_)(me(e.createdAt)),1)]),_:1}),(0,l.bF)(t,{label:"操作",width:"200",fixed:"right"},{default:(0,l.k6)(({row:e})=>["PENDING"===e.reviewStatus?((0,l.uX)(),(0,l.Wv)(u,{key:0,type:"success",size:"small",onClick:a=>oe(e)},{default:(0,l.k6)(()=>[...a[12]||(a[12]=[(0,l.eW)("通过",-1)])]),_:1},8,["onClick"])):(0,l.Q3)("",!0),"PENDING"===e.reviewStatus?((0,l.uX)(),(0,l.Wv)(u,{key:1,type:"danger",size:"small",onClick:a=>ce(e)},{default:(0,l.k6)(()=>[...a[13]||(a[13]=[(0,l.eW)("拒绝",-1)])]),_:1},8,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(u,{type:"primary",size:"small",onClick:a=>pe(e.id)},{default:(0,l.k6)(()=>[...a[14]||(a[14]=[(0,l.eW)("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Fe,Q.value]]),q.value>0?((0,l.uX)(),(0,l.Wv)(c,{key:0,"current-page":B.value,"onUpdate:currentPage":a[0]||(a[0]=e=>B.value=e),"page-size":Z.value,"onUpdate:pageSize":a[1]||(a[1]=e=>Z.value=e),total:q.value,layout:"total, prev, pager, next",onCurrentChange:se,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(ne,{modelValue:H.value,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value=e),title:"拒绝活动",width:"500px"},{footer:(0,l.k6)(()=>[(0,l.bF)(u,{onClick:a[3]||(a[3]=e=>H.value=!1)},{default:(0,l.k6)(()=>[...a[15]||(a[15]=[(0,l.eW)("取消",-1)])]),_:1}),(0,l.bF)(u,{type:"danger",onClick:de},{default:(0,l.k6)(()=>[...a[16]||(a[16]=[(0,l.eW)("确认拒绝",-1)])]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(ie,{model:Y.value,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)(M,{label:"拒绝原因",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(v,{modelValue:Y.value.rejectReason,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.value.rejectReason=e),type:"textarea",rows:4,placeholder:"请输入拒绝原因",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)):((0,l.uX)(),(0,l.Wv)(Ee,{key:1,modelValue:U.value,"onUpdate:modelValue":a[11]||(a[11]=e=>U.value=e),onTabChange:ue},{default:(0,l.k6)(()=>[(0,l.bF)(Ce,{label:"推荐活动",name:"recommended"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{class:"filter-card"},{default:(0,l.k6)(()=>[(0,l.bF)(ie,{inline:!0},{default:(0,l.k6)(()=>[(0,l.bF)(M,{label:"筛选"},{default:(0,l.k6)(()=>[(0,l.bF)(he,{modelValue:ee.value.barId,"onUpdate:modelValue":a[5]||(a[5]=e=>ee.value.barId=e),placeholder:"选择酒吧",clearable:"",style:{width:"200px"}},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(ae.value,e=>((0,l.uX)(),(0,l.Wv)(fe,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,l.bF)(he,{modelValue:ee.value.beverageId,"onUpdate:modelValue":a[6]||(a[6]=e=>ee.value.beverageId=e),placeholder:"选择酒类",clearable:"",style:{width:"200px","margin-left":"10px"}},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(te.value,e=>((0,l.uX)(),(0,l.Wv)(fe,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,l.bF)(u,{type:"primary",onClick:le,style:{"margin-left":"10px"}},{default:(0,l.k6)(()=>[...a[17]||(a[17]=[(0,l.eW)(" 筛选 ",-1)])]),_:1}),(0,l.bF)(u,{onClick:ve},{default:(0,l.k6)(()=>[...a[18]||(a[18]=[(0,l.eW)("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",b,[0!==G.value.length||Q.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(_e,{key:0,description:"暂无推荐活动"})),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(G.value,e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.id,class:"activity-card",shadow:"hover",onClick:a=>pe(e.id)},{default:(0,l.k6)(()=>[(0,l.Lk)("div",f,[(0,l.Lk)("div",h,[(0,l.Lk)("h3",_,(0,r.v_)(e.beverageName)+" 组局",1),(0,l.bF)(n,{type:ke(e.status)},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(ge(e.status)),1)]),_:2},1032,["type"])]),(0,l.Lk)("div",w,[(0,l.Lk)("p",C,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.Clock))]),_:1}),(0,l.eW)(" "+(0,r.v_)(me(e.activityTime)),1)]),e.barName?((0,l.uX)(),(0,l.CE)("p",E,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.LocationFilled))]),_:1}),(0,l.eW)(" "+(0,r.v_)(e.barName),1)])):(0,l.Q3)("",!0),(0,l.Lk)("p",F,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.User))]),_:1}),(0,l.eW)(" "+(0,r.v_)(e.currentParticipants)+" / "+(0,r.v_)(e.maxParticipants)+" 人 ",1)]),e.organizerName?((0,l.uX)(),(0,l.CE)("p",R," 发起者："+(0,r.v_)(e.organizerName),1)):(0,l.Q3)("",!0)]),e.remark?((0,l.uX)(),(0,l.CE)("p",N,(0,r.v_)(e.remark),1)):(0,l.Q3)("",!0)])]),_:2},1032,["onClick"]))),128))])),[[Fe,Q.value]]),j.value>0?((0,l.uX)(),(0,l.Wv)(c,{key:0,"current-page":T.value,"onUpdate:currentPage":a[7]||(a[7]=e=>T.value=e),"page-size":Z.value,"onUpdate:pageSize":a[8]||(a[8]=e=>Z.value=e),total:j.value,layout:"total, prev, pager, next",onCurrentChange:le},null,8,["current-page","page-size","total"])):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(Ce,{label:"我参与的",name:"participated"},{default:(0,l.k6)(()=>[(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",A,[0!==S.value.length||Q.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(_e,{key:0,description:"您还没有参与过活动"})),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(S.value,e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.id,class:"activity-card",shadow:"hover",onClick:a=>pe(e.id)},{default:(0,l.k6)(()=>[(0,l.Lk)("div",W,[(0,l.Lk)("div",I,[(0,l.Lk)("h3",X,(0,r.v_)(e.beverageName)+" 组局",1),(0,l.bF)(n,{type:ke(e.status)},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(ge(e.status)),1)]),_:2},1032,["type"])]),(0,l.Lk)("div",z,[(0,l.Lk)("p",K,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.Clock))]),_:1}),(0,l.eW)(" "+(0,r.v_)(me(e.activityTime)),1)]),e.barName?((0,l.uX)(),(0,l.CE)("p",P,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.LocationFilled))]),_:1}),(0,l.eW)(" "+(0,r.v_)(e.barName),1)])):(0,l.Q3)("",!0),(0,l.Lk)("p",L,[(0,l.bF)(we,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,i.R1)(o.User))]),_:1}),(0,l.eW)(" "+(0,r.v_)(e.currentParticipants)+" / "+(0,r.v_)(e.maxParticipants)+" 人 ",1)]),e.organizerName?((0,l.uX)(),(0,l.CE)("p",D," 发起者："+(0,r.v_)(e.organizerName),1)):(0,l.Q3)("",!0)]),e.remark?((0,l.uX)(),(0,l.CE)("p",V,(0,r.v_)(e.remark),1)):(0,l.Q3)("",!0)])]),_:2},1032,["onClick"]))),128))])),[[Fe,Q.value]]),O.value>0?((0,l.uX)(),(0,l.Wv)(c,{key:0,"current-page":$.value,"onUpdate:currentPage":a[9]||(a[9]=e=>$.value=e),"page-size":Z.value,"onUpdate:pageSize":a[10]||(a[10]=e=>Z.value=e),total:O.value,layout:"total, prev, pager, next",onCurrentChange:re},null,8,["current-page","page-size","total"])):(0,l.Q3)("",!0)]),_:1})]),_:1},8,["modelValue"]))])}}},U=t(6262);const Q=(0,U.A)(x,[["__scopeId","data-v-05ff70e4"]]);var G=Q},6379:function(e,a,t){t.d(a,{Um:function(){return r}});var l=t(7277);const r=e=>(0,l.A)({url:"/beverages",method:"get",params:e})},6901:function(e,a,t){t.d(a,{BG:function(){return i},Bk:function(){return u},FC:function(){return d},HK:function(){return v},K6:function(){return p},KJ:function(){return o},N$:function(){return m},lU:function(){return r},pM:function(){return s},v7:function(){return c},w9:function(){return n}});var l=t(7277);const r=e=>(0,l.A)({url:"/bars/register",method:"post",data:e}),i=e=>(0,l.A)({url:`/bars/${e}`,method:"get"}),n=e=>(0,l.A)({url:"/bars/nearby",method:"get",params:e}),u=e=>(0,l.A)({url:`/bars/city/${e}`,method:"get"}),s=e=>(0,l.A)({url:"/bars/search",method:"get",params:e}),o=()=>(0,l.A)({url:"/bars/applications/my",method:"get"}),c=e=>(0,l.A)({url:"/bars/reviews",method:"post",data:e}),d=e=>(0,l.A)({url:`/bars/${e}/reviews`,method:"get"}),v=e=>(0,l.A)({url:`/bars/reviews/${e}`,method:"delete"}),p=e=>(0,l.A)({url:"/bars/recommend",method:"get",params:e}),m=e=>{const a={};return e&&Array.isArray(e)&&e.length>0&&(a.alcoholIds=e),(0,l.A)({url:"/bars/my",method:"get",params:a})}},8027:function(e,a,t){t.d(a,{AJ:function(){return u},E1:function(){return r},IE:function(){return c},Kg:function(){return o},Qs:function(){return i},dR:function(){return n},h3:function(){return v},kz:function(){return d},qP:function(){return s}});t(8111),t(2489);var l=t(7277);const r=e=>(0,l.A)({url:"/activities",method:"post",data:e}),i=(e=1,a=10)=>(0,l.A)({url:"/activities/my-created",method:"get",params:{page:e,size:a}}),n=(e,a,t=1,r=10)=>(0,l.A)({url:"/activities/recommended",method:"get",params:{barId:e,beverageId:a,page:t,size:r}}),u=(e=1,a=10)=>(0,l.A)({url:"/activities/my-participated",method:"get",params:{page:e,size:a}}),s=e=>(0,l.A)({url:`/activities/${e}`,method:"get"}),o=e=>(0,l.A)({url:`/activities/${e}/join`,method:"post"}),c=e=>(0,l.A)({url:`/activities/${e}/cancel`,method:"post"}),d=(e,a)=>(0,l.A)({url:`/activities/${e}/review`,method:"post",data:a}),v=(e=1,a=10)=>(0,l.A)({url:"/activities/pending",method:"get",params:{page:e,size:a}})}}]);
//# sourceMappingURL=379.1d4da5f8.js.map