"use strict";(self["webpackChunkdemo2"]=self["webpackChunkdemo2"]||[]).push([[444],{1444:function(e,l,s){s.r(l),s.d(l,{default:function(){return te}});s(4114),s(8111),s(2489);var a=s(641),t=s(953),n=s(33),i=s(3751),o=s(5220),u=s(4353),r=s.n(u),d=s(6400),c=s(4402),k=s(2549),v=s(163);const p={key:0,class:"profile-page"},m={class:"profile-hero"},y={class:"cover-panel"},f={class:"hero-layout"},L={class:"avatar-column"},g={class:"meta-column"},h={class:"user-title"},b={class:"uid"},C={key:1,class:"signature-text"},w={class:"stats-column"},F={class:"stat"},_={class:"stat"},I={class:"stat"},X={class:"profile-tabs"},E=["onClick"],K={class:"profile-content"},A={key:0,class:"content-card"},R={class:"section-header"},V={key:0,class:"loading"},W={key:1,class:"empty"},$={key:2,class:"post-list"},z={class:"post-thumbnail"},U=["src","alt"],x={key:1},P={class:"post-content"},T={class:"post-text"},S={class:"post-meta"},D={key:1,class:"content-card"},Y={class:"section-header"},q={class:"filter-bar"},O={key:0,class:"loading"},M={key:1,class:"empty"},j={key:2,class:"card-grid"},B=["onClick"],H={class:"card-meta"},Q={key:2,class:"content-card"},G={class:"section-header"},J={class:"filter-bar"},N={key:0,class:"loading"},Z={key:1,class:"empty"},ee={key:2,class:"timeline"},le={key:3,class:"content-card message-entry"};var se={__name:"Profile",setup(e){const l=(0,o.rd)(),s=(0,o.lq)(),u=(0,d.k)(),se=[{key:"posts",label:"动态"},{key:"collections",label:"收藏"},{key:"history",label:"足迹"},{key:"messages",label:"消息"}],ae=(0,t.KR)("posts"),te=(0,t.KR)(""),ne=(0,t.KR)(null),ie=(0,t.KR)(!1),oe=()=>{ie.value=!0,(0,a.dY)(()=>{ne.value?.focus()})},ue=(0,t.Kh)({loading:!1,items:[]}),re=(0,t.Kh)({loading:!1,items:[]}),de=(0,t.Kh)({loading:!1,items:[]}),ce=(0,t.Kh)({type:"ALL",keyword:""}),ke=(0,t.Kh)({days:3,type:"ALL"}),ve=(0,a.EW)(()=>ce.keyword?re.items.filter(e=>e.title?.includes(ce.keyword)||e.summary?.includes(ce.keyword)):re.items),pe=(0,a.EW)(()=>{const e=Math.max(0,se.findIndex(e=>e.key===ae.value)),l=100/se.length;return{width:`${l}%`,transform:`translateX(${100*e}%)`}}),me=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",ye=e=>e&&e.imageUrls&&0!==e.imageUrls.length?e.imageUrls[0]:null,fe=e=>r()(e).format("YYYY.MM.DD HH:mm"),Le=async()=>{ue.loading=!0;try{const e=await c.x.listUserPosts(u.userInfo.id,1,10);ue.items=e.data.items||[]}catch(e){v.nk.error("加载动态失败")}finally{ue.loading=!1}},ge=()=>{Le()},he=async()=>{re.loading=!0;try{const e={page:1,pageSize:20};"ALL"!==ce.type&&(e.type=ce.type);const l=await(0,k.qw)(e);re.items=l.data.items||[]}catch(e){v.nk.error("加载收藏失败")}finally{re.loading=!1}},be=async()=>{de.loading=!0;try{const e={days:ke.days};"ALL"!==ke.type&&(e.type=ke.type);const l=await(0,k.hP)(e);de.items=l.data||[]}catch(e){v.nk.error("加载足迹失败")}finally{de.loading=!1}},Ce=e=>{"messages"!==e?(ae.value=e,"posts"===e&&Le(),"collections"===e&&he(),"history"===e&&be()):we()},we=()=>{l.push("/messages")},Fe=e=>{l.push(`/posts/${e}`)},_e=e=>{e&&("POST"!==e.targetType?"WIKI"===e.targetType&&(e.slug?l.push(`/wiki/${e.slug}`):l.push(`/wiki/${e.targetId}`)):l.push(`/posts/${e.targetId}`))},Ie=()=>{l.push("/user/settings")},Xe=async()=>{try{await(0,k.r7)({bio:te.value}),await u.fetchUserInfo(),ie.value=!1,v.nk.success("签名已更新")}catch(e){v.nk.error("更新失败")}},Ee=()=>{te.value=u.userInfo.bio,ie.value=!1};return(0,a.sV)(async()=>{await u.fetchUserInfo().catch(()=>{}),te.value=u.userInfo?.bio,Le()}),(0,a.wB)(()=>s.query.tab,e=>{e&&se.some(l=>l.key===e)&&(ae.value=e,"posts"===e&&Le(),"collections"===e&&he(),"history"===e&&be())},{immediate:!0}),(e,l)=>{const s=(0,a.g2)("el-avatar"),o=(0,a.g2)("el-tag"),r=(0,a.g2)("el-input"),d=(0,a.g2)("el-button"),c=(0,a.g2)("el-skeleton"),k=(0,a.g2)("el-empty"),v=(0,a.g2)("el-option"),Le=(0,a.g2)("el-select");return(0,t.R1)(u).userInfo?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("section",m,[(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[(0,a.Lk)("div",L,[(0,a.Lk)("div",{class:"avatar-wrapper",onClick:Ie},[(0,a.bF)(s,{size:104,src:(0,t.R1)(u).userInfo.avatarUrl,alt:`${(0,t.R1)(u).userInfo.username||"用户"}的头像`},null,8,["src","alt"]),l[6]||(l[6]=(0,a.Lk)("div",{class:"avatar-overlay"},"编辑信息",-1))])]),(0,a.Lk)("div",g,[(0,a.Lk)("div",h,[(0,a.Lk)("h1",null,(0,n.v_)((0,t.R1)(u).userInfo.username),1),(0,a.bF)(o,{size:"small",effect:"dark"},{default:(0,a.k6)(()=>[(0,a.eW)("Lv."+(0,n.v_)((0,t.R1)(u).userInfo.level||1),1)]),_:1})]),(0,a.Lk)("p",b,"UID "+(0,n.v_)((0,t.R1)(u).userInfo.id),1),(0,a.Lk)("div",{class:(0,n.C4)(["signature",{editing:ie.value}]),onClick:l[1]||(l[1]=e=>!ie.value&&oe()),style:{backgroundColor:"inherit"}},[ie.value?((0,a.uX)(),(0,a.Wv)(r,{key:0,ref_key:"signatureInputRef",ref:ne,modelValue:te.value,"onUpdate:modelValue":l[0]||(l[0]=e=>te.value=e),size:"small",maxlength:"200","show-word-limit":"",onKeyup:(0,i.jR)(Xe,["enter"]),onKeydown:(0,i.jR)((0,i.D$)(Ee,["prevent"]),["esc"]),onBlur:Xe},null,8,["modelValue","onKeydown"])):((0,a.uX)(),(0,a.CE)("span",C,(0,n.v_)(te.value||"这个人很酷，什么都没有写"),1))],2)]),(0,a.Lk)("div",w,[(0,a.Lk)("div",F,[(0,a.Lk)("p",null,(0,n.v_)((0,t.R1)(u).userInfo.followingCount),1),l[7]||(l[7]=(0,a.Lk)("span",null,"关注",-1))]),(0,a.Lk)("div",_,[(0,a.Lk)("p",null,(0,n.v_)((0,t.R1)(u).userInfo.followerCount),1),l[8]||(l[8]=(0,a.Lk)("span",null,"粉丝",-1))]),(0,a.Lk)("div",I,[(0,a.Lk)("p",null,(0,n.v_)((0,t.R1)(u).userInfo.likeReceived),1),l[9]||(l[9]=(0,a.Lk)("span",null,"获赞",-1))])])])])]),(0,a.Lk)("nav",X,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(se,e=>(0,a.Lk)("button",{key:e.key,class:(0,n.C4)(["tab",{active:ae.value===e.key}]),onClick:l=>Ce(e.key)},(0,n.v_)(e.label),11,E)),64)),(0,a.Lk)("div",{class:"tab-indicator",style:(0,n.Tr)(pe.value)},null,4)]),(0,a.Lk)("section",K,["posts"===ae.value?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",R,[l[11]||(l[11]=(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"eyebrow"},"Recent"),(0,a.Lk)("h3",null,"我的动态")],-1)),(0,a.bF)(d,{text:"",size:"small",onClick:ge},{default:(0,a.k6)(()=>[...l[10]||(l[10]=[(0,a.eW)("刷新",-1)])]),_:1})]),ue.loading?((0,a.uX)(),(0,a.CE)("div",V,[(0,a.bF)(c,{rows:3,animated:""})])):0===ue.items.length?((0,a.uX)(),(0,a.CE)("div",W,[(0,a.bF)(k,{description:"还没有发布任何动态"})])):((0,a.uX)(),(0,a.CE)("div",$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ue.items,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"post-row"},[(0,a.Lk)("div",z,[ye(e)?((0,a.uX)(),(0,a.CE)("img",{key:0,src:ye(e),alt:`${e.author?.username||"用户"}的动态配图`},null,8,U)):((0,a.uX)(),(0,a.CE)("span",x,"文字"))]),(0,a.Lk)("div",P,[(0,a.Lk)("p",T,(0,n.v_)(me(e.content)),1),(0,a.Lk)("div",S,[(0,a.Lk)("span",null,(0,n.v_)(fe(e.createdAt)),1),(0,a.Lk)("span",null,"浏览 "+(0,n.v_)(e.viewCount||0),1),(0,a.Lk)("span",null,"点赞 "+(0,n.v_)(e.likeCount||0),1)])]),(0,a.bF)(d,{text:"",size:"small",onClick:l=>Fe(e.id)},{default:(0,a.k6)(()=>[...l[12]||(l[12]=[(0,a.eW)("查看",-1)])]),_:1},8,["onClick"])]))),128))]))])):"collections"===ae.value?((0,a.uX)(),(0,a.CE)("div",D,[(0,a.Lk)("div",Y,[l[14]||(l[14]=(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"eyebrow"},"Saved"),(0,a.Lk)("h3",null,"收藏夹")],-1)),(0,a.Lk)("div",q,[(0,a.bF)(Le,{modelValue:ce.type,"onUpdate:modelValue":l[2]||(l[2]=e=>ce.type=e),size:"small"},{default:(0,a.k6)(()=>[(0,a.bF)(v,{label:"全部内容",value:"ALL"}),(0,a.bF)(v,{label:"动态",value:"POST"}),(0,a.bF)(v,{label:"维基",value:"WIKI"})]),_:1},8,["modelValue"]),(0,a.bF)(r,{modelValue:ce.keyword,"onUpdate:modelValue":l[3]||(l[3]=e=>ce.keyword=e),placeholder:"搜索收藏内容",size:"small",clearable:""},null,8,["modelValue"]),(0,a.bF)(d,{size:"small",onClick:he},{default:(0,a.k6)(()=>[...l[13]||(l[13]=[(0,a.eW)("筛选",-1)])]),_:1})])]),re.loading?((0,a.uX)(),(0,a.CE)("div",O,[(0,a.bF)(c,{rows:3,animated:""})])):0===re.items.length?((0,a.uX)(),(0,a.CE)("div",M,[(0,a.bF)(k,{description:"暂无收藏"})])):((0,a.uX)(),(0,a.CE)("div",j,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ve.value,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"card",onClick:l=>_e(e)},[(0,a.Lk)("h4",null,(0,n.v_)(e.title),1),(0,a.Lk)("p",null,(0,n.v_)(e.summary),1),(0,a.Lk)("div",H,[(0,a.Lk)("span",null,(0,n.v_)("POST"===e.targetType?"动态":"维基"),1),(0,a.Lk)("span",null,(0,n.v_)(fe(e.createdAt)),1)]),(0,a.bF)(d,{type:"primary",link:"",size:"small",onClick:(0,i.D$)(l=>_e(e),["stop"])},{default:(0,a.k6)(()=>[...l[15]||(l[15]=[(0,a.eW)(" 查看详情 ",-1)])]),_:1},8,["onClick"])],8,B))),128))]))])):"history"===ae.value?((0,a.uX)(),(0,a.CE)("div",Q,[(0,a.Lk)("div",G,[l[17]||(l[17]=(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"eyebrow"},"Footprint"),(0,a.Lk)("h3",null,"我的足迹")],-1)),(0,a.Lk)("div",J,[(0,a.bF)(Le,{modelValue:ke.days,"onUpdate:modelValue":l[4]||(l[4]=e=>ke.days=e),size:"small"},{default:(0,a.k6)(()=>[(0,a.bF)(v,{label:"3 天以内",value:3}),(0,a.bF)(v,{label:"7 天以内",value:7})]),_:1},8,["modelValue"]),(0,a.bF)(Le,{modelValue:ke.type,"onUpdate:modelValue":l[5]||(l[5]=e=>ke.type=e),size:"small"},{default:(0,a.k6)(()=>[(0,a.bF)(v,{label:"全部",value:"ALL"}),(0,a.bF)(v,{label:"动态",value:"POST"}),(0,a.bF)(v,{label:"维基",value:"WIKI"})]),_:1},8,["modelValue"]),(0,a.bF)(d,{size:"small",onClick:be},{default:(0,a.k6)(()=>[...l[16]||(l[16]=[(0,a.eW)("应用",-1)])]),_:1})])]),de.loading?((0,a.uX)(),(0,a.CE)("div",N,[(0,a.bF)(c,{rows:3,animated:""})])):0===de.items.length?((0,a.uX)(),(0,a.CE)("div",Z,[(0,a.bF)(k,{description:"最近没有足迹记录"})])):((0,a.uX)(),(0,a.CE)("div",ee,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(de.items,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"timeline-item"},[l[18]||(l[18]=(0,a.Lk)("div",{class:"dot"},null,-1)),(0,a.Lk)("div",null,[(0,a.Lk)("h4",null,(0,n.v_)(e.title),1),(0,a.Lk)("p",null,(0,n.v_)(e.summary),1),(0,a.Lk)("small",null,(0,n.v_)(fe(e.visitedAt)),1)])]))),128))]))])):"messages"===ae.value?((0,a.uX)(),(0,a.CE)("div",le,[(0,a.bF)(k,{description:"私信已独立为单独页面"}),(0,a.bF)(d,{type:"primary",onClick:we},{default:(0,a.k6)(()=>[...l[19]||(l[19]=[(0,a.eW)("进入消息中心",-1)])]),_:1})])):(0,a.Q3)("",!0)])])):((0,a.uX)(),(0,a.Wv)(k,{key:1,description:"正在加载..."}))}}};const ae=se;var te=ae},2549:function(e,l,s){s.d(l,{Qt:function(){return u},ec:function(){return i},fG:function(){return k},hP:function(){return c},hc:function(){return r},l2:function(){return t},pV:function(){return o},qw:function(){return d},r7:function(){return n}});var a=s(7277);const t=e=>(0,a.A)({url:`/users/${e}`,method:"get"}),n=e=>(0,a.A)({url:"/users/profile",method:"put",data:e}),i=e=>(0,a.A)({url:"/users/password",method:"put",data:e}),o=e=>(0,a.A)({url:`/users/${e}/follow`,method:"post"}),u=e=>(0,a.A)({url:`/users/${e}/follow`,method:"delete"}),r=()=>(0,a.A)({url:"/users/followees",method:"get"}),d=e=>(0,a.A)({url:"/collections",method:"get",params:e}),c=e=>(0,a.A)({url:"/footprints",method:"get",params:e}),k=e=>(0,a.A)({url:"/footprints",method:"post",data:e})}}]);
//# sourceMappingURL=444.53483388.js.map