{"version":3,"file":"js/529.687fb907.js","mappings":"mLAEO,MAAMA,EAAqBA,KACzBC,EAAAA,EAAAA,GAAQ,CACbC,IAAK,YACLC,OAAQ,QAICC,EAAyBC,IAC7BJ,EAAAA,EAAAA,GAAQ,CACbC,IAAK,kBAAkBG,IACvBF,OAAQ,QAICG,EAAcA,CAACD,EAAQE,KAC3BN,EAAAA,EAAAA,GAAQ,CACbC,IAAK,kBAAkBG,IACvBF,OAAQ,OACRI,SAISC,EAAa,CACxBR,qBACAI,wBACAE,c,8tBC2EF,MAAMG,GAAgBC,EAAAA,EAAAA,IAAI,IACpBC,GAAqBD,EAAAA,EAAAA,IAAI,MACzBE,GAAeF,EAAAA,EAAAA,IAAI,IACnBG,GAAgBH,EAAAA,EAAAA,IAAI,IACpBI,GAAWJ,EAAAA,EAAAA,IAAI,IACfK,GAAcL,EAAAA,EAAAA,IAAI,MAClBM,GAAYC,EAAAA,EAAAA,KAEZC,GAAwBC,EAAAA,EAAAA,IAAS,IAChCV,EAAcW,MACZP,EAAcO,MAAMC,OAAOC,GAChCA,EAAKC,MAAMC,UAAUC,SAAShB,EAAcW,QAFbP,EAAcO,OAM3CM,GAAcP,EAAAA,EAAAA,IAAS,IACpBN,EAAcO,MAAMO,KAAKC,GAAKA,EAAEL,MAAMM,KAAOlB,EAAmBS,QAAQG,MAG3EO,EAAqBC,GACpBA,EAEEC,IAAMD,GAAME,OAAO,eAFR,GAKdC,EAAiBA,MACrBC,EAAAA,EAAAA,IAAS,KACP,MAAMC,EAAKrB,EAAYK,MACnBgB,IACFA,EAAGC,UAAYD,EAAGE,iBAKlBC,EAAoBC,UACxB,IACE,MAAMC,QAAYjC,EAAAA,GAAWR,qBAC7Ba,EAAcO,MAAQqB,EAAIlC,MAAQ,IAC7BI,EAAmBS,OAASP,EAAcO,MAAMsB,OAAS,GAC5DC,EAAmB9B,EAAcO,MAAM,GAAGG,KAAKM,GAEnD,CAAE,MAAOe,GACPC,EAAAA,GAAUD,MAAM,SAClB,GAGID,EAAqBH,UACzB7B,EAAmBS,MAAQf,EAC3B,IACE,MAAMoC,QAAYjC,EAAAA,GAAWJ,sBAAsBC,GACnDS,EAASM,MAAQqB,EAAIlC,MAAQ,GAC7B2B,GACF,CAAE,MAAOU,GACPC,EAAAA,GAAUD,MAAM,SAClB,GAGItC,EAAckC,UAClB,GAAK5B,EAAaQ,MAAM0B,QAAWnC,EAAmBS,MACtD,UACQZ,EAAAA,GAAWF,YAAYK,EAAmBS,MAAO,CAAE2B,QAASnC,EAAaQ,QAC/ER,EAAaQ,MAAQ,SACfuB,EAAmBhC,EAAmBS,aACtCmB,GACR,CAAE,MAAOK,GACPC,EAAAA,GAAUD,MAAM,aAClB,G,OAGFI,EAAAA,EAAAA,IAAU,KACRT,M,8HA3KAU,EAAAA,EAAAA,IA2FM,MA3FNC,EA2FM,EA1FJC,EAAAA,EAAAA,IAyFM,MAzFNC,EAyFM,EAvFJD,EAAAA,EAAAA,IA2BM,MA3BNE,EA2BM,C,aA1BJF,EAAAA,EAAAA,IAAW,UAAP,MAAE,KACNG,EAAAA,EAAAA,IAKEC,EAAA,C,WAJS9C,EAAAW,M,qCAAAX,EAAaW,MAAAoC,GACtBC,YAAY,OACZC,UAAA,GACAC,MAAA,0B,wBAEFR,EAAAA,EAAAA,IAkBM,MAlBNS,EAkBM,G,aAjBJX,EAAAA,EAAAA,IAgBMY,EAAAA,GAAA,MAAAC,EAAAA,EAAAA,IAfW5C,EAAAE,MAARE,K,WADT2B,EAAAA,EAAAA,IAgBM,OAdHc,IAAKzC,EAAKC,KAAKM,GACfmC,OAAKC,EAAAA,EAAAA,IAAA,sBAAAC,OAAkCvD,EAAAS,QAAuBE,EAAKC,KAAKM,MACxEsC,QAAKX,GAAEb,EAAmBrB,EAAKC,KAAKM,K,EAErCyB,EAAAA,EAAAA,IAIEc,EAAA,CAHCC,IAAK/C,EAAKC,KAAK+C,UACfC,KAAM,GACNC,IAAG,GAAKlD,EAAKC,KAAKC,UAAY,W,uBAEjC2B,EAAAA,EAAAA,IAGM,MAHNsB,EAGM,EAFJtB,EAAAA,EAAAA,IAAqD,MAArDuB,GAAqDC,EAAAA,EAAAA,IAA3BrD,EAAKC,KAAKC,UAAQ,IAC5C2B,EAAAA,EAAAA,IAAsD,MAAtDyB,GAAsDD,EAAAA,EAAAA,IAAzBrD,EAAKuD,aAAW,KAEpCvD,EAAKwD,YAAc,I,WAA9B7B,EAAAA,EAAAA,IAAkF,MAAlF8B,GAAkFJ,EAAAA,EAAAA,IAAzBrD,EAAKwD,aAAW,K,mCAM/E3B,EAAAA,EAAAA,IAwDM,MAxDN6B,EAwDM,EAvDJ7B,EAAAA,EAAAA,IAyCM,MAzCN8B,EAyCM,CAxCQtE,EAAAS,Q,WAGZ6B,EAAAA,EAAAA,IAoCM,MApCNiC,EAoCM,EAlCJ/B,EAAAA,EAAAA,IAEM,MAFNgC,EAEM,EADJhC,EAAAA,EAAAA,IAAoC,WAAAwB,EAAAA,EAAAA,IAA7BjD,EAAAN,OAAaI,UAAQ,MAI9B2B,EAAAA,EAAAA,IA4BM,OA5BDa,MAAM,gB,QAAoB,cAAJtD,IAAIK,G,gBAC7BkC,EAAAA,EAAAA,IA0BMY,EAAAA,GAAA,MAAAC,EAAAA,EAAAA,IAzBUhD,EAAAM,MAAPgE,K,WADTnC,EAAAA,EAAAA,IA0BM,OAxBHc,IAAKqB,EAAIvD,GACTmC,OAAKC,EAAAA,EAAAA,IAAA,gBAAmBmB,EAAIC,KAAO,OAAS,W,CAEjCD,EAAIC,M,4BAAhBpC,EAAAA,EAAAA,IAMM,MANNqC,EAMM,EALJhC,EAAAA,EAAAA,IAIEc,EAAA,CAHCC,IAAK3C,EAAAN,OAAakD,UAClBC,KAAM,GACNC,IAAG,GAAK9C,EAAAN,OAAaI,UAAY,W,0BAGtC2B,EAAAA,EAAAA,IAKM,MALNoC,EAKM,EAJJpC,EAAAA,EAAAA,IAEM,MAFNqC,EAEM,EADJrC,EAAAA,EAAAA,IAAwB,UAAAwB,EAAAA,EAAAA,IAAlBS,EAAIrC,SAAO,MAEnBI,EAAAA,EAAAA,IAAwE,OAAxEsC,GAAwEd,EAAAA,EAAAA,IAA1C7C,EAAkBsD,EAAIM,YAAS,KAGpDN,EAAIC,O,WAAfpC,EAAAA,EAAAA,IAMM,MANN0C,EAMM,EALJrC,EAAAA,EAAAA,IAIEc,EAAA,CAHCC,KAAKuB,EAAAA,EAAAA,IAAA5E,GAAU6E,UAAUvB,UACzBC,KAAM,GACNC,IAAG,IAAKoB,EAAAA,EAAAA,IAAA5E,GAAU6E,UAAUrE,UAAY,W,2EAlCnDyB,EAAAA,EAAAA,IAEM,MAFN6C,EAEM,EADJxC,EAAAA,EAAAA,IAAqCyC,EAAA,CAA3BC,YAAY,qBA0C1B7C,EAAAA,EAAAA,IAUM,OAVDa,OAAKC,EAAAA,EAAAA,IAAA,CAAC,cAAa,CAAAgC,UAAsBtF,EAAAS,U,EAC5CkC,EAAAA,EAAAA,IAOEC,EAAA,C,WANS3C,EAAAQ,M,qCAAAR,EAAYQ,MAAAoC,GACrB0C,KAAK,WACJC,SAAU,CAAAC,QAAA,EAAAC,QAAA,GACV5C,YAAa9C,EAAAS,MAAqB,UAAY,cAC9C6E,UAAWtF,EAAAS,MACXkF,WAAOC,EAAAA,EAAAA,KAAAC,EAAAA,EAAAA,IAAsBlG,EAAW,iC,6DAE3CgD,EAAAA,EAAAA,IAA6FmD,EAAA,CAAlFP,KAAK,UAAWD,UAAWtF,EAAAS,MAAqB+C,QAAO7D,G,kBAAa,IAAE,IAAAoG,EAAA,KAAAA,EAAA,K,QAAF,MAAE,O,4CClF3F,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://Chunyin/./src/api/message.js","webpack://Chunyin/./src/views/message/Messages.vue","webpack://Chunyin/./src/views/message/Messages.vue?1723"],"sourcesContent":["import request from './request'\n\nexport const fetchConversations = () => {\n  return request({\n    url: '/messages',\n    method: 'get'\n  })\n}\n\nexport const fetchConversationWith = (userId) => {\n  return request({\n    url: `/messages/with/${userId}`,\n    method: 'get'\n  })\n}\n\nexport const sendMessage = (userId, data) => {\n  return request({\n    url: `/messages/with/${userId}`,\n    method: 'post',\n    data\n  })\n}\n\nexport const messageApi = {\n  fetchConversations,\n  fetchConversationWith,\n  sendMessage\n}\n","<template>\n  <div class=\"messages-container\">\n    <div class=\"messages-layout\">\n      <!-- 左侧会话列表 -->\n      <div class=\"conversations-panel\">\n        <h3>消息</h3>\n        <el-input\n          v-model=\"searchKeyword\"\n          placeholder=\"搜索会话\"\n          clearable\n          style=\"margin-bottom: 16px\"\n        />\n        <div class=\"conversations-list\">\n          <div\n            v-for=\"conv in filteredConversations\"\n            :key=\"conv.peer.id\"\n            :class=\"['conversation-item', { active: activeConversation === conv.peer.id }]\"\n            @click=\"selectConversation(conv.peer.id)\"\n          >\n            <el-avatar\n              :src=\"conv.peer.avatarUrl\"\n              :size=\"40\"\n              :alt=\"`${conv.peer.username || '用户'}的头像`\"\n            />\n            <div class=\"conv-info\">\n              <div class=\"conv-user\">{{ conv.peer.username }}</div>\n              <div class=\"conv-preview\">{{ conv.lastMessage }}</div>\n            </div>\n            <div v-if=\"conv.unreadCount > 0\" class=\"unread-badge\">{{ conv.unreadCount }}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 右侧聊天窗口 -->\n      <div class=\"chat-section\">\n        <div class=\"chat-panel\">\n          <div v-if=\"!activeConversation\" class=\"no-conversation\">\n            <el-empty description=\"选择一个会话开始聊天\" />\n          </div>\n          <div v-else class=\"chat-body\">\n            <!-- 聊天头部 -->\n            <div class=\"chat-header\">\n              <h3>{{ currentUser?.username }}</h3>\n            </div>\n\n            <!-- 消息列表 -->\n            <div class=\"messages-list\" ref=\"chatBodyRef\">\n              <div\n                v-for=\"msg in messages\"\n                :key=\"msg.id\"\n                :class=\"['message-item', msg.mine ? 'self' : 'other']\"\n              >\n                <div v-if=\"!msg.mine\" class=\"message-avatar\">\n                  <el-avatar\n                    :src=\"currentUser?.avatarUrl\"\n                    :size=\"32\"\n                    :alt=\"`${currentUser?.username || '用户'}的头像`\"\n                  />\n                </div>\n                <div class=\"message-content\">\n                  <div class=\"message-bubble\">\n                    <p>{{ msg.content }}</p>\n                  </div>\n                  <span class=\"message-time\">{{ formatMessageTime(msg.createdAt) }}</span>\n                </div>\n\n                <div v-if=\"msg.mine\" class=\"message-avatar\">\n                  <el-avatar\n                    :src=\"userStore.userInfo?.avatarUrl\"\n                    :size=\"32\"\n                    :alt=\"`${userStore.userInfo?.username || '我的'}的头像`\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- 输入框 -->\n        <div class=\"chat-footer\" :class=\"{ disabled: !activeConversation }\">\n          <el-input\n            v-model=\"messageInput\"\n            type=\"textarea\"\n            :autosize=\"{ minRows: 3, maxRows: 5 }\"\n            :placeholder=\"activeConversation ? '输入消息...' : '选择一个会话以发送消息'\"\n            :disabled=\"!activeConversation\"\n            @keydown.enter.exact.prevent=\"sendMessage\"\n          />\n          <el-button type=\"primary\" :disabled=\"!activeConversation\" @click=\"sendMessage\">发送</el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, nextTick } from 'vue'\nimport { messageApi } from '@/api/message'\nimport { ElMessage } from 'element-plus'\nimport dayjs from 'dayjs'\nimport { useUserStore } from '@/store/modules/user'\n\nconst searchKeyword = ref('')\nconst activeConversation = ref(null)\nconst messageInput = ref('')\nconst conversations = ref([])\nconst messages = ref([])\nconst chatBodyRef = ref(null)\nconst userStore = useUserStore()\n\nconst filteredConversations = computed(() => {\n  if (!searchKeyword.value) return conversations.value\n  return conversations.value.filter(conv =>\n    conv.peer?.username?.includes(searchKeyword.value)\n  )\n})\n\nconst currentUser = computed(() => {\n  return conversations.value.find(c => c.peer?.id === activeConversation.value)?.peer\n})\n\nconst formatMessageTime = (time) => {\n  if (!time) return ''\n  // return dayjs(time).format('YYYY.MM.DD HH:mm')\n  return dayjs(time).format('MM-DD HH:mm')\n}\n\nconst scrollToBottom = () => {\n  nextTick(() => {\n    const el = chatBodyRef.value\n    if (el) {\n      el.scrollTop = el.scrollHeight\n    }\n  })\n}\n\nconst loadConversations = async () => {\n  try {\n    const res = await messageApi.fetchConversations()\n    conversations.value = res.data || []\n    if (!activeConversation.value && conversations.value.length > 0) {\n      selectConversation(conversations.value[0].peer.id)\n    }\n  } catch (error) {\n    ElMessage.error('加载私信失败')\n  }\n}\n\nconst selectConversation = async (userId) => {\n  activeConversation.value = userId\n  try {\n    const res = await messageApi.fetchConversationWith(userId)\n    messages.value = res.data || []\n    scrollToBottom()\n  } catch (error) {\n    ElMessage.error('加载对话失败')\n  }\n}\n\nconst sendMessage = async () => {\n  if (!messageInput.value.trim() || !activeConversation.value) return\n  try {\n    await messageApi.sendMessage(activeConversation.value, { content: messageInput.value })\n    messageInput.value = ''\n    await selectConversation(activeConversation.value)\n    await loadConversations()\n  } catch (error) {\n    ElMessage.error('发送失败，请稍后再试')\n  }\n}\n\nonMounted(() => {\n  loadConversations()\n})\n</script>\n\n<style scoped>\n.messages-container {\n  height: calc(100vh - 68px);\n  padding: 24px;\n  background: #fff;\n  box-sizing: border-box;\n  display: flex;\n}\n\n.messages-layout {\n  display: flex;\n  width: 100%;\n  height: 100%;\n  border: 1px solid #eceff5;\n  border-radius: 32px;\n  overflow: hidden;\n  box-shadow: 0 20px 40px rgba(15, 23, 42, 0.07);\n}\n\n.conversations-panel {\n  width: 300px;\n  border-right: 1px solid #f0f0f0;\n  padding: 24px 20px;\n  background: #f9fafc;\n  display: flex;\n  flex-direction: column;\n}\n\n.conversations-panel h3 {\n  margin: 0 0 16px 0;\n}\n\n.chat-section {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: #fff;\n}\n\n.conversations-list {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  overflow-y: auto;\n  padding-right: 6px;\n}\n\n.conversation-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px;\n  border-radius: 14px;\n  cursor: pointer;\n  transition: background-color 0.3s;\n  position: relative;\n}\n\n.conversation-item:hover {\n  background-color: #eef2ff;\n}\n\n.conversation-item.active {\n  background-color: #e5edff;\n}\n\n.conv-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.conv-user {\n  font-weight: 500;\n  color: #1f2d3d;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.conv-preview {\n  font-size: 12px;\n  color: #909399;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.unread-badge {\n  background-color: #f56c6c;\n  color: #fff;\n  border-radius: 50%;\n  width: 22px;\n  height: 22px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 11px;\n  font-weight: bold;\n}\n\n.chat-panel {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background: #fff;\n  min-height: 0;\n}\n\n.chat-body {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n\n.no-conversation {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.chat-header {\n  padding: 24px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.chat-header h3 {\n  margin: 0;\n}\n\n.messages-list {\n  flex: 1;\n  padding: 24px;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  background: #fafafa;\n  min-height: 0;\n}\n\n.message-item {\n  display: flex;\n  gap: 8px;\n  align-items: flex-end;\n  width: 100%;\n}\n\n.message-item.self {\n  justify-content: flex-end;\n  margin-left: auto;\n}\n\n.message-avatar {\n  flex-shrink: 0;\n  display: flex;\n  align-items: flex-end;\n}\n\n.message-content {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  max-width: 70%;\n  min-width: 0;\n}\n\n.message-item.self .message-content {\n  align-items: flex-end;\n}\n\n.message-bubble {\n  background-color: #fff;\n  padding: 12px 16px;\n  border-radius: 16px 16px 16px 4px;\n  min-width: 60px;\n  max-width: 100%;\n  word-break: break-word;\n  white-space: pre-wrap;\n  line-height: 1.5;\n  box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);\n}\n\n.message-bubble p {\n  margin: 0;\n}\n\n.message-item.self .message-bubble {\n  background-color: #2f54eb;\n  color: #fff;\n  border-radius: 16px 16px 4px 16px;\n  box-shadow: none;\n  min-width: 60px;\n  max-width: 100%;\n}\n\n.message-time {\n  font-size: 11px;\n  color: #a0a3ad;\n}\n\n.message-item.self .message-time {\n  text-align: right;\n  color: #a0a3ad;\n}\n\n.chat-footer {\n  background: #fff;\n  padding: 20px 24px;\n  border-top: 1px solid #f0f0f0;\n  display: flex;\n  gap: 12px;\n  flex-shrink: 0;\n}\n\n.chat-footer.disabled {\n  opacity: 0.6;\n}\n\n:deep(.chat-footer .el-textarea) {\n  flex: 1;\n}\n</style>\n","import script from \"./Messages.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Messages.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Messages.vue?vue&type=style&index=0&id=1ff9ff18&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1ff9ff18\"]])\n\nexport default __exports__"],"names":["fetchConversations","request","url","method","fetchConversationWith","userId","sendMessage","data","messageApi","searchKeyword","ref","activeConversation","messageInput","conversations","messages","chatBodyRef","userStore","useUserStore","filteredConversations","computed","value","filter","conv","peer","username","includes","currentUser","find","c","id","formatMessageTime","time","dayjs","format","scrollToBottom","nextTick","el","scrollTop","scrollHeight","loadConversations","async","res","length","selectConversation","error","ElMessage","trim","content","onMounted","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_input","$event","placeholder","clearable","style","_hoisted_4","_Fragment","_renderList","key","class","_normalizeClass","active","onClick","_component_el_avatar","src","avatarUrl","size","alt","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","lastMessage","unreadCount","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_13","_hoisted_14","msg","mine","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","createdAt","_hoisted_19","_unref","userInfo","_hoisted_12","_component_el_empty","description","disabled","type","autosize","minRows","maxRows","onKeydown","_withKeys","_withModifiers","_component_el_button","_cache","__exports__"],"ignoreList":[],"sourceRoot":""}