"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[545],{545:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var r=a(641),i=a(33);const l={class:"bar-detail"},n={key:0,class:"detail-container"},s={class:"bar-header"},o={class:"rating-section"},u={class:"review-count"},d={class:"card-header"},c={key:0,class:"empty-reviews"},m={key:1,class:"reviews-list"},v={class:"review-header"},g={class:"user-info"},b={class:"user-details"},h={class:"username"},k={class:"review-meta"},w={class:"review-time"},f={key:0,class:"review-content"};function p(e,t,a,p,F,y){const _=(0,r.g2)("el-tag"),A=(0,r.g2)("el-rate"),C=(0,r.g2)("LocationFilled"),R=(0,r.g2)("el-icon"),W=(0,r.g2)("el-descriptions-item"),D=(0,r.g2)("Clock"),L=(0,r.g2)("Phone"),B=(0,r.g2)("el-descriptions"),V=(0,r.g2)("el-card"),X=(0,r.g2)("el-button"),E=(0,r.g2)("el-empty"),I=(0,r.g2)("el-avatar"),U=(0,r.g2)("el-form-item"),T=(0,r.g2)("el-input"),P=(0,r.g2)("el-form"),Q=(0,r.g2)("el-dialog"),$=(0,r.gN)("loading");return(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",l,[F.bar?((0,r.uX)(),(0,r.CE)("div",n,[(0,r.bF)(V,{class:"info-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",s,[(0,r.Lk)("h1",null,(0,i.v_)(F.bar.name),1),"PENDING"===F.bar.status?((0,r.uX)(),(0,r.Wv)(_,{key:0,type:"warning"},{default:(0,r.k6)(()=>[...t[6]||(t[6]=[(0,r.eW)("待审核",-1)])]),_:1})):"APPROVED"===F.bar.status?((0,r.uX)(),(0,r.Wv)(_,{key:1,type:"success"},{default:(0,r.k6)(()=>[...t[7]||(t[7]=[(0,r.eW)("已通过",-1)])]),_:1})):"REJECTED"===F.bar.status?((0,r.uX)(),(0,r.Wv)(_,{key:2,type:"danger"},{default:(0,r.k6)(()=>[...t[8]||(t[8]=[(0,r.eW)("已拒绝",-1)])]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",o,[(0,r.bF)(A,{modelValue:F.bar.avgRating,"onUpdate:modelValue":t[0]||(t[0]=e=>F.bar.avgRating=e),disabled:"","show-score":"",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"]),(0,r.Lk)("span",u,(0,i.v_)(F.bar.reviewCount)+"条评价",1)]),(0,r.bF)(B,{column:1,border:"",class:"bar-descriptions"},{default:(0,r.k6)(()=>[(0,r.bF)(W,{label:"地址"},{default:(0,r.k6)(()=>[(0,r.bF)(R,null,{default:(0,r.k6)(()=>[(0,r.bF)(C)]),_:1}),(0,r.eW)(" "+(0,i.v_)(F.bar.address),1)]),_:1}),(0,r.bF)(W,{label:"所在地区"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(F.bar.province)+" "+(0,i.v_)(F.bar.city)+" "+(0,i.v_)(F.bar.district||""),1)]),_:1}),F.bar.openingTime&&F.bar.closingTime?((0,r.uX)(),(0,r.Wv)(W,{key:0,label:"营业时间"},{default:(0,r.k6)(()=>[(0,r.bF)(R,null,{default:(0,r.k6)(()=>[(0,r.bF)(D)]),_:1}),(0,r.eW)(" "+(0,i.v_)(y.formatTime(F.bar.openingTime))+" - "+(0,i.v_)(y.formatTime(F.bar.closingTime)),1)]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(W,{label:"联系电话"},{default:(0,r.k6)(()=>[(0,r.bF)(R,null,{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1}),(0,r.eW)(" "+(0,i.v_)(F.bar.contactPhone),1)]),_:1}),F.bar.mainBeverages?((0,r.uX)(),(0,r.Wv)(W,{key:1,label:"主营酒类"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(F.bar.mainBeverages),1)]),_:1})):(0,r.Q3)("",!0),F.bar.description?((0,r.uX)(),(0,r.Wv)(W,{key:2,label:"简介"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(F.bar.description),1)]),_:1})):(0,r.Q3)("",!0)]),_:1})]),_:1}),(0,r.bF)(V,{class:"review-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",d,[t[10]||(t[10]=(0,r.Lk)("h3",null,"用户评价",-1)),y.isLoggedIn?((0,r.uX)(),(0,r.Wv)(X,{key:0,type:"primary",onClick:t[1]||(t[1]=e=>F.showReviewDialog=!0)},{default:(0,r.k6)(()=>[...t[9]||(t[9]=[(0,r.eW)(" 写评价 ",-1)])]),_:1})):(0,r.Q3)("",!0)])]),default:(0,r.k6)(()=>[0===F.reviews.length?((0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(E,{description:"暂无评价"})])):((0,r.uX)(),(0,r.CE)("div",m,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(F.reviews,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"review-item"},[(0,r.Lk)("div",v,[(0,r.Lk)("div",g,[(0,r.bF)(I,{src:e.user?.avatarUrl,size:40},null,8,["src"]),(0,r.Lk)("div",b,[(0,r.Lk)("span",h,(0,i.v_)(e.user?.username),1),(0,r.bF)(A,{modelValue:e.rating,"onUpdate:modelValue":t=>e.rating=t,disabled:"",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue","onUpdate:modelValue"])])]),(0,r.Lk)("div",k,[(0,r.Lk)("span",w,(0,i.v_)(y.formatDate(e.createdAt)),1),y.currentUserId===e.userId?((0,r.uX)(),(0,r.Wv)(X,{key:0,type:"danger",size:"small",text:"",onClick:t=>y.handleDeleteReview(e.id)},{default:(0,r.k6)(()=>[...t[11]||(t[11]=[(0,r.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)])]),e.content?((0,r.uX)(),(0,r.CE)("p",f,(0,i.v_)(e.content),1)):(0,r.Q3)("",!0)]))),128))]))]),_:1})])):(0,r.Q3)("",!0),(0,r.bF)(Q,{modelValue:F.showReviewDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>F.showReviewDialog=e),title:"写评价",width:"500px"},{footer:(0,r.k6)(()=>[(0,r.bF)(X,{onClick:t[4]||(t[4]=e=>F.showReviewDialog=!1)},{default:(0,r.k6)(()=>[...t[12]||(t[12]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(X,{type:"primary",onClick:y.submitReview,loading:F.submitting},{default:(0,r.k6)(()=>[...t[13]||(t[13]=[(0,r.eW)(" 提交 ",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[(0,r.bF)(P,{model:F.reviewForm,rules:F.reviewRules,ref:"reviewFormRef"},{default:(0,r.k6)(()=>[(0,r.bF)(U,{label:"评分",prop:"rating"},{default:(0,r.k6)(()=>[(0,r.bF)(A,{modelValue:F.reviewForm.rating,"onUpdate:modelValue":t[2]||(t[2]=e=>F.reviewForm.rating=e),colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"])]),_:1}),(0,r.bF)(U,{label:"评价内容",prop:"content"},{default:(0,r.k6)(()=>[(0,r.bF)(T,{modelValue:F.reviewForm.content,"onUpdate:modelValue":t[3]||(t[3]=e=>F.reviewForm.content=e),type:"textarea",rows:5,placeholder:"分享您的体验...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])),[[$,F.loading]])}var F=a(6901),y=a(8548),_=a(163),A=a(7918),C=a(6400),R={name:"BarDetail",components:{LocationFilled:y.LocationFilled,Clock:y.Clock,Phone:y.Phone},setup(){const e=(0,C.k)();return{userStore:e}},data(){return{bar:null,reviews:[],loading:!1,submitting:!1,showReviewDialog:!1,reviewForm:{rating:0,content:""},reviewRules:{rating:[{required:!0,message:"请选择评分",trigger:"change"}]}}},computed:{isLoggedIn(){return this.userStore.isLoggedIn},currentUser(){return this.userStore.userInfo},currentUserId(){return this.currentUser?.id}},mounted(){this.loadBarDetail(),this.loadReviews()},methods:{async loadBarDetail(){this.loading=!0;try{const{data:e}=await(0,F.BG)(this.$route.params.id);this.bar=e}catch(e){console.error("加载酒吧详情失败:",e),_.nk.error(e.message||"加载失败")}finally{this.loading=!1}},async loadReviews(){try{const{data:e}=await(0,F.FC)(this.$route.params.id);this.reviews=e||[]}catch(e){console.error("加载评价失败:",e)}},async submitReview(){const e=await this.$refs.reviewFormRef.validate().catch(()=>!1);if(e){this.submitting=!0;try{await(0,F.v7)({barId:this.bar.id,rating:this.reviewForm.rating,content:this.reviewForm.content}),_.nk.success("评价成功"),this.showReviewDialog=!1,this.reviewForm={rating:0,content:""},await Promise.all([this.loadBarDetail(),this.loadReviews()])}catch(t){console.error("提交评价失败:",t),_.nk.error(t.message||"提交失败")}finally{this.submitting=!1}}},async handleDeleteReview(e){try{await A.s.confirm("确定要删除这条评价吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(0,F.HK)(e),_.nk.success("删除成功"),await Promise.all([this.loadBarDetail(),this.loadReviews()])}catch(t){"cancel"!==t&&(console.error("删除评价失败:",t),_.nk.error(t.message||"删除失败"))}},formatTime(e){return e?e.substring(0,5):""},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}}},W=a(6262);const D=(0,W.A)(R,[["render",p],["__scopeId","data-v-5cdf41a7"]]);var L=D},6901:function(e,t,a){a.d(t,{BG:function(){return l},Bk:function(){return s},FC:function(){return c},HK:function(){return m},K6:function(){return v},KJ:function(){return u},N$:function(){return g},lU:function(){return i},pM:function(){return o},v7:function(){return d},w9:function(){return n}});var r=a(7277);const i=e=>(0,r.A)({url:"/bars/register",method:"post",data:e}),l=e=>(0,r.A)({url:`/bars/${e}`,method:"get"}),n=e=>(0,r.A)({url:"/bars/nearby",method:"get",params:e}),s=e=>(0,r.A)({url:`/bars/city/${e}`,method:"get"}),o=e=>(0,r.A)({url:"/bars/search",method:"get",params:e}),u=()=>(0,r.A)({url:"/bars/applications/my",method:"get"}),d=e=>(0,r.A)({url:"/bars/reviews",method:"post",data:e}),c=e=>(0,r.A)({url:`/bars/${e}/reviews`,method:"get"}),m=e=>(0,r.A)({url:`/bars/reviews/${e}`,method:"delete"}),v=e=>(0,r.A)({url:"/bars/recommend",method:"get",params:e}),g=e=>{const t={};return e&&Array.isArray(e)&&e.length>0&&(t.alcoholIds=e),(0,r.A)({url:"/bars/my",method:"get",params:t})}}}]);
//# sourceMappingURL=545.615a8ab5.js.map