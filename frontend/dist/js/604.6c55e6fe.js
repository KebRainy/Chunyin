(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[604],{2604:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});a(4114);var l=a(641),s=a(953),n=a(33),u=a(5220),o=a(163),r=a(4402),i=a(6617),c=a(3945),d=a(5467);const v={class:"nearby-container"},p={class:"city-selector"},m={key:0,class:"loading"},y={key:1,class:"empty"},f={key:2,class:"masonry-grid"},k={key:3,class:"load-more"},g={key:4,class:"no-more"};var h={__name:"Nearby",setup(e){const t=(0,u.rd)(),a=(0,s.KR)(""),h=(0,s.KR)([]),b=(0,s.KR)(!1),C=(0,s.KR)(1),_=(0,s.KR)(12),F=(0,s.KR)(!0),{provinces:X,loading:L,ensureLoaded:R,findCityByName:w,getDefaultCity:E}=(0,c.m)(),{detecting:$,detectCity:K}=(0,d.K)(),M=async()=>{if(a.value){b.value=!0;try{const e=await r.x.listPostsByCity(a.value,C.value,_.value),t=e.data;1===C.value?h.value=t.items||[]:h.value.push(...t.items||[]),F.value=(t.items||[]).length>=_.value}catch(e){console.error("Failed to load nearby posts:",e)}finally{b.value=!1}}},W=()=>{a.value&&(C.value=1,h.value=[],F.value=!0,M())},I=()=>{C.value++,M()},U=e=>{t.push(`/posts/${e}`)},V=async()=>{await R();const e=await K(),t=e?w(e):null;a.value=t?.city||E()||"北京市",W()},x=async()=>{await R();const e=await K();if(!e)return void o.nk.warning("无法定位，请手动选择城市");const t=w(e);t?.city?(a.value=t.city,o.nk.success(`已定位到 ${t.city}`),W()):o.nk.warning("未找到匹配的城市，请手动选择")};return(0,l.sV)(()=>{V()}),(e,t)=>{const u=(0,l.g2)("el-option"),o=(0,l.g2)("el-option-group"),r=(0,l.g2)("el-select"),c=(0,l.g2)("el-button"),d=(0,l.g2)("el-empty");return(0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("div",p,[t[1]||(t[1]=(0,l.Lk)("label",null,"选择城市:",-1)),(0,l.bF)(r,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),filterable:"",clearable:"",loading:(0,s.R1)(L),placeholder:"选择城市",onChange:W},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)((0,s.R1)(X),e=>((0,l.uX)(),(0,l.Wv)(o,{key:e.value,label:e.label},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.cities,e=>((0,l.uX)(),(0,l.Wv)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","loading"]),(0,l.bF)(c,{text:"",size:"small",class:"locate-btn",loading:(0,s.R1)($),onClick:x},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)((0,s.R1)($)?"定位中…":"自动定位"),1)]),_:1},8,["loading"])]),b.value&&0===h.value.length?((0,l.uX)(),(0,l.CE)("div",m,"加载中...")):0===h.value.length?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.bF)(d,{description:`${a.value}还没有动态`},null,8,["description"])])):((0,l.uX)(),(0,l.CE)("div",f,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(h.value,e=>((0,l.uX)(),(0,l.Wv)(i.A,{key:e.id,post:e,onSelect:t=>U(e.id)},null,8,["post","onSelect"]))),128))])),!b.value&&F.value?((0,l.uX)(),(0,l.CE)("div",k,[(0,l.bF)(c,{onClick:I},{default:(0,l.k6)(()=>[...t[2]||(t[2]=[(0,l.eW)("加载更多",-1)])]),_:1})])):(0,l.Q3)("",!0),!F.value&&h.value.length>0?((0,l.uX)(),(0,l.CE)("div",g," 已加载全部内容 ")):(0,l.Q3)("",!0)])}}},b=a(6262);const C=(0,b.A)(h,[["__scopeId","data-v-2164ee5d"]]);var _=C},6617:function(e,t,a){"use strict";a.d(t,{A:function(){return I}});var l=a(641),s=a(33),n=a(953),u=a(4353),o=a.n(u),r=a(8660),i=a.n(r),c=a(8548);const d={key:0,class:"recommend-badge"},v={key:1,class:"card-media"},p=["src","alt"],m={class:"image-overlay"},y={class:"overlay-item"},f={class:"overlay-item"},k={key:0,class:"count"},g={key:2,class:"card-media no-image"},h={class:"no-image-text"},b={class:"image-overlay"},C={class:"overlay-item"},_={class:"overlay-item"},F={class:"card-body"},X={class:"content"},L={key:0,class:"tags"},R={class:"card-meta"},w={class:"author"},E={class:"name"},$={class:"time"};var K={__name:"PostCard",props:{post:{type:Object,required:!0},layout:{type:String,default:"masonry"}},emits:["select"],setup(e){o().extend(i());const t=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",a=e=>e?e.length>60?`${e.slice(0,60)}...`:e:"分享此刻的灵感",u=e=>{if(!e)return"";const t=o()(e),a=o()(),l=a.diff(t,"minute");if(l<60)return`${l||1}分钟前`;const s=a.diff(t,"hour");return s<24?`${s}小时前`:t.isSame(a,"year")?t.format("M月D日"):t.format("YYYY年M月D日")};return(o,r)=>{const i=(0,l.g2)("el-icon"),K=(0,l.g2)("el-tag"),M=(0,l.g2)("el-avatar");return(0,l.uX)(),(0,l.CE)("div",{class:(0,s.C4)(["post-card",e.layout,{"is-recommended":e.post.isRecommended}]),onClick:r[0]||(r[0]=t=>o.$emit("select",e.post))},[e.post.isRecommended?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.MagicStick))]),_:1}),r[1]||(r[1]=(0,l.Lk)("span",null,"猜你喜欢",-1))])):(0,l.Q3)("",!0),e.post.imageUrls?.length?((0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("img",{src:e.post.imageUrls[0],alt:e.post.content||`${e.post.author?.username||"用户"}的分享图片`},null,8,p),(0,l.Lk)("div",m,[(0,l.Lk)("span",y,[(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.View))]),_:1}),(0,l.eW)((0,s.v_)(e.post.viewCount||0),1)]),(0,l.Lk)("span",f,[(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.GobletFull))]),_:1}),(0,l.eW)((0,s.v_)(e.post.likeCount||0),1)])]),e.post.imageUrls.length>1?((0,l.uX)(),(0,l.CE)("span",k,"+"+(0,s.v_)(e.post.imageUrls.length-1),1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("p",h,(0,s.v_)(a(e.post.content)),1),(0,l.Lk)("div",b,[(0,l.Lk)("span",C,[(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.View))]),_:1}),(0,l.eW)((0,s.v_)(e.post.viewCount||0),1)]),(0,l.Lk)("span",_,[(0,l.bF)(i,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,n.R1)(c.GobletFull))]),_:1}),(0,l.eW)((0,s.v_)(e.post.likeCount||0),1)])])])),(0,l.Lk)("div",F,[(0,l.Lk)("p",X,(0,s.v_)(t(e.post.content)),1),e.post.tags?.length?((0,l.uX)(),(0,l.CE)("div",L,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.post.tags.slice(0,2),e=>((0,l.uX)(),(0,l.Wv)(K,{key:e,size:"small",effect:"light"},{default:(0,l.k6)(()=>[(0,l.eW)(" # "+(0,s.v_)(e),1)]),_:2},1024))),128))])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",R,[(0,l.Lk)("div",w,[(0,l.bF)(M,{src:e.post.author?.avatarUrl,size:28,alt:`${e.post.author?.username||"用户"}的头像`},null,8,["src","alt"]),(0,l.Lk)("p",E,(0,s.v_)(e.post.author?.username),1)]),(0,l.Lk)("span",$,(0,s.v_)(u(e.post.createdAt)),1)])],2)}}},M=a(6262);const W=(0,M.A)(K,[["__scopeId","data-v-2be613fd"]]);var I=W},8660:function(e){!function(t,a){e.exports=a()}(0,function(){"use strict";return function(e,t,a){e=e||{};var l=t.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function n(e,t,a,s){return l.fromToBase(e,t,a,s)}a.en.relativeTime=s,l.fromToBase=function(t,l,n,u,o){for(var r,i,c,d=n.$locale().relativeTime||s,v=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],p=v.length,m=0;m<p;m+=1){var y=v[m];y.d&&(r=u?a(t).diff(n,y.d,!0):n.diff(t,y.d,!0));var f=(e.rounding||Math.round)(Math.abs(r));if(c=r>0,f<=y.r||!y.r){f<=1&&m>0&&(y=v[m-1]);var k=d[y.l];o&&(f=o(""+f)),i="string"==typeof k?k.replace("%d",f):k(f,l,y.l,c);break}}if(l)return i;var g=c?d.future:d.past;return"function"==typeof g?g(i):g.replace("%s",i)},l.to=function(e,t){return n(e,t,this,!0)},l.from=function(e,t){return n(e,t,this)};var u=function(e){return e.$u?a.utc():a()};l.toNow=function(e){return this.to(u(this),e)},l.fromNow=function(e){return this.from(u(this),e)}}})}}]);
//# sourceMappingURL=604.6c55e6fe.js.map