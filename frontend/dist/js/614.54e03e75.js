"use strict";(self["webpackChunkdemo2"]=self["webpackChunkdemo2"]||[]).push([[614],{2549:function(e,a,l){l.d(a,{Qt:function(){return o},ec:function(){return i},fG:function(){return v},hP:function(){return c},hc:function(){return r},l2:function(){return t},pV:function(){return n},qw:function(){return d},r7:function(){return u}});var s=l(7277);const t=e=>(0,s.A)({url:`/users/${e}`,method:"get"}),u=e=>(0,s.A)({url:"/users/profile",method:"put",data:e}),i=e=>(0,s.A)({url:"/users/password",method:"put",data:e}),n=e=>(0,s.A)({url:`/users/${e}/follow`,method:"post"}),o=e=>(0,s.A)({url:`/users/${e}/follow`,method:"delete"}),r=()=>(0,s.A)({url:"/users/followees",method:"get"}),d=e=>(0,s.A)({url:"/collections",method:"get",params:e}),c=e=>(0,s.A)({url:"/footprints",method:"get",params:e}),v=e=>(0,s.A)({url:"/footprints",method:"post",data:e})},5614:function(e,a,l){l.r(a),l.d(a,{default:function(){return J}});l(4114),l(8111),l(2489),l(1701);var s=l(641),t=l(33),u=l(953),i=l(5220),n=l(4353),o=l.n(n),r=l(8930),d=l(2549),c=l(6400),v=l(163),k=l(3263),m=l(9418);const p={class:"wiki-detail-page"},y={key:0,class:"loading"},f={key:1,class:"not-found"},h={key:2,class:"wiki-layout"},g={class:"wiki-sidebar"},L={class:"toc"},w={class:"sidebar-actions"},b={class:"wiki-main"},_={class:"wiki-header"},C={class:"meta"},F={key:0,class:"wiki-summary"},E=["innerHTML"],X={class:"wiki-discussion"},I={class:"section-header"},A={key:0,class:"discussion-loading"},W={key:1},K={key:0,class:"discussion-form"},R={class:"discussion-actions"},V={key:1,class:"discussion-login"},x={key:2,class:"discussion-empty"},z={key:3,class:"discussion-list"},Q={class:"discussion-body"},U={class:"discussion-meta"},$={class:"author"},q={class:"time"},D={class:"discussion-text"},H={class:"wiki-history"},M={key:0,class:"history-empty"},T={key:1,class:"history-list"},Y={class:"history-editor"},N={class:"history-summary"},j={class:"history-time"},G={class:"edit-request"};var P={__name:"WikiDetail",setup(e){const a=(0,i.lq)(),l=(0,i.rd)(),n=(0,c.k)(),P=(0,u.KR)(null),B=(0,u.KR)([]),S=(0,u.KR)(!0),J=(0,u.KR)([]),O=(0,u.KR)(!0),Z=(0,u.KR)(""),ee=(0,u.KR)(!1),ae=(0,u.KR)(null),le=(0,u.KR)("overview"),se=(0,u.KR)({reason:"",detail:""}),te=(0,u.KR)(!1),ue=new k.A({html:!0,linkify:!0,breaks:!0}),ie=(0,s.EW)(()=>P.value?.content?m.A.sanitize(ue.render(P.value.content)):'<p class="empty">这个条目暂无内容</p>'),ne=(0,s.EW)(()=>P.value?.content?P.value.content.split("\n").filter(e=>/^#{1,6}\s+/.test(e)).map(e=>{const a=e.match(/^#+/)[0].length;return{level:a,text:e.replace(/^#+/,"").trim()}}):[]),oe=(0,s.EW)(()=>!(!n.userInfo||!P.value)&&("ADMIN"===n.userInfo.role||P.value.author?.id===n.userInfo.id)),re=async()=>{S.value=!0;try{const e=await(0,r.ET)(a.params.slug);P.value=e.data,await de(),await ce(),ve()}catch(e){v.nk.error("加载词条失败")}finally{S.value=!1}},de=async()=>{try{const e=await(0,r.Dz)(a.params.slug);B.value=e.data||[]}catch(e){B.value=[]}},ce=async()=>{O.value=!0;try{const e=await(0,r.Q5)(a.params.slug);J.value=e.data||[]}catch(e){J.value=[]}finally{O.value=!1}},ve=async()=>{if(n.isLoggedIn&&P.value)try{await(0,d.fG)({targetType:"WIKI",targetId:P.value.id,title:P.value.title,summary:P.value.summary})}catch(e){}},ke=e=>e?o()(e).format("YYYY年M月D日 HH:mm"):"",me=()=>{P.value&&l.push(`/wiki/edit/${P.value.id}`)},pe=async()=>{if(n.isLoggedIn)try{const e=await(0,r.ko)(P.value.id);P.value.favorited=e.data,v.nk.success(P.value.favorited?"已收藏":"已取消收藏")}catch(e){v.nk.error("操作失败")}else l.push("/login")},ye=()=>{n.isLoggedIn?ae.value?.focus():ge()},fe=async()=>{if(n.isLoggedIn)if(Z.value.trim()){ee.value=!0;try{const e=await(0,r.zj)(a.params.slug,{content:Z.value.trim()});J.value.unshift(e.data),Z.value="",v.nk.success("讨论已发布")}catch(e){v.nk.error(e.response?.data?.message||"发布失败")}finally{ee.value=!1}}else v.nk.warning("请输入讨论内容");else ge()},he=async()=>{if(n.isLoggedIn)if(se.value.reason.trim()&&se.value.detail.trim()){te.value=!0;try{await(0,r.zj)(a.params.slug,{content:`【编辑申请】${se.value.reason}：${se.value.detail}`}),se.value.reason="",se.value.detail="",v.nk.success("申请已提交"),"discussion"!==le.value&&(le.value="discussion"),await ce()}catch(e){v.nk.error(e.response?.data?.message||"提交失败")}finally{te.value=!1}}else v.nk.warning("请填写完整的申请信息");else ge()},ge=()=>{l.push("/login")};return(0,s.sV)(()=>{re()}),(e,a)=>{const l=(0,s.g2)("el-skeleton"),i=(0,s.g2)("el-empty"),o=(0,s.g2)("el-button"),r=(0,s.g2)("el-tag"),d=(0,s.g2)("el-tab-pane"),c=(0,s.g2)("el-input"),v=(0,s.g2)("el-avatar"),k=(0,s.g2)("el-form-item"),m=(0,s.g2)("el-form"),ue=(0,s.g2)("el-tabs");return(0,s.uX)(),(0,s.CE)("div",p,[S.value?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(l,{rows:6,animated:""})])):P.value?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("aside",g,[a[6]||(a[6]=(0,s.Lk)("div",{class:"cover"},[(0,s.Lk)("img",{src:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600",alt:"concept"})],-1)),(0,s.Lk)("div",L,[a[4]||(a[4]=(0,s.Lk)("h4",null,"目录",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ne.value,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},[(0,s.Lk)("span",null,(0,t.v_)(e.text),1)]))),128))])]),(0,s.Lk)("div",w,[(0,s.bF)(o,{type:"primary",plain:"",size:"small",onClick:pe},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(P.value.favorited?"已收藏":"收藏词条"),1)]),_:1}),(0,u.R1)(n).isLoggedIn&&oe.value?((0,s.uX)(),(0,s.Wv)(o,{key:0,size:"small",onClick:me},{default:(0,s.k6)(()=>[...a[5]||(a[5]=[(0,s.eW)("编辑条目",-1)])]),_:1})):(0,s.Q3)("",!0)])]),(0,s.Lk)("main",b,[(0,s.Lk)("header",_,[(0,s.Lk)("div",null,[a[7]||(a[7]=(0,s.Lk)("p",{class:"eyebrow"},"词条",-1)),(0,s.Lk)("h1",null,(0,t.v_)(P.value.title),1),(0,s.Lk)("p",C," 最后更新 "+(0,t.v_)(ke(P.value.updatedAt))+" · "+(0,t.v_)(P.value.lastEditorName||"系统"),1)]),"PUBLISHED"===P.value.status?((0,s.uX)(),(0,s.Wv)(r,{key:0,type:"success"},{default:(0,s.k6)(()=>[...a[8]||(a[8]=[(0,s.eW)("已发布",-1)])]),_:1})):(0,s.Q3)("",!0)]),(0,s.bF)(ue,{modelValue:le.value,"onUpdate:modelValue":a[3]||(a[3]=e=>le.value=e),class:"wiki-tabs"},{default:(0,s.k6)(()=>[(0,s.bF)(d,{label:"条目信息",name:"overview"},{default:(0,s.k6)(()=>[P.value.summary?((0,s.uX)(),(0,s.CE)("section",F,[a[9]||(a[9]=(0,s.Lk)("h4",null,"概要",-1)),(0,s.Lk)("p",null,(0,t.v_)(P.value.summary),1)])):(0,s.Q3)("",!0),(0,s.Lk)("article",{class:"wiki-article",innerHTML:ie.value},null,8,E)]),_:1}),(0,s.bF)(d,{label:"用户讨论",name:"discussion"},{default:(0,s.k6)(()=>[(0,s.Lk)("section",X,[(0,s.Lk)("div",I,[a[11]||(a[11]=(0,s.Lk)("h3",null,"讨论",-1)),(0,s.bF)(o,{text:"",size:"small",onClick:ye},{default:(0,s.k6)(()=>[...a[10]||(a[10]=[(0,s.eW)("发起讨论",-1)])]),_:1})]),O.value?((0,s.uX)(),(0,s.CE)("div",A,[(0,s.bF)(l,{rows:3,animated:""})])):((0,s.uX)(),(0,s.CE)("div",W,[(0,u.R1)(n).isLoggedIn?((0,s.uX)(),(0,s.CE)("div",K,[(0,s.bF)(c,{ref_key:"discussionInputRef",ref:ae,modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e),type:"textarea",placeholder:"写下你的问题或观点...",rows:3,maxlength:"1000","show-word-limit":""},null,8,["modelValue"]),(0,s.Lk)("div",R,[(0,s.bF)(o,{type:"primary",size:"small",loading:ee.value,onClick:fe},{default:(0,s.k6)(()=>[...a[12]||(a[12]=[(0,s.eW)(" 发布讨论 ",-1)])]),_:1},8,["loading"])])])):((0,s.uX)(),(0,s.CE)("div",V,[(0,s.bF)(o,{type:"text",onClick:ge},{default:(0,s.k6)(()=>[...a[13]||(a[13]=[(0,s.eW)("登录后参与讨论",-1)])]),_:1})])),0===J.value.length?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.bF)(i,{description:"暂时还没有讨论，快来参与吧"})])):((0,s.uX)(),(0,s.CE)("div",z,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(J.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"discussion-item"},[(0,s.bF)(v,{src:e.author?.avatarUrl,size:36},null,8,["src"]),(0,s.Lk)("div",Q,[(0,s.Lk)("div",U,[(0,s.Lk)("span",$,(0,t.v_)(e.author?.username||"匿名用户"),1),(0,s.Lk)("span",q,(0,t.v_)(ke(e.createdAt)),1)]),(0,s.Lk)("p",D,(0,t.v_)(e.content),1)])]))),128))]))]))])]),_:1}),(0,s.bF)(d,{label:"历史版本",name:"history"},{default:(0,s.k6)(()=>[(0,s.Lk)("section",H,[a[14]||(a[14]=(0,s.Lk)("div",{class:"section-header"},[(0,s.Lk)("h3",null,"历史版本")],-1)),0===B.value.length?((0,s.uX)(),(0,s.CE)("div",M,[(0,s.bF)(i,{description:"暂无历史记录"})])):((0,s.uX)(),(0,s.CE)("div",T,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(B.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"history-item"},[(0,s.Lk)("div",null,[(0,s.Lk)("p",Y,(0,t.v_)(e.editorName),1),(0,s.Lk)("p",N,(0,t.v_)(e.summary||"更新了词条内容"),1)]),(0,s.Lk)("span",j,(0,t.v_)(ke(e.createdAt)),1)]))),128))]))])]),_:1}),(0,s.bF)(d,{label:"申请编辑",name:"edit-request"},{default:(0,s.k6)(()=>[(0,s.Lk)("section",G,[a[17]||(a[17]=(0,s.Lk)("p",{class:"tip"}," 想要补充条目或纠正内容？提交申请后，维护团队会在 24 小时内审核并授权编辑权限。 ",-1)),(0,s.bF)(m,{model:se.value,"label-width":"80px",class:"edit-request-form"},{default:(0,s.k6)(()=>[(0,s.bF)(k,{label:"申请理由"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:se.value.reason,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value.reason=e),placeholder:"说明你希望修改的内容"},null,8,["modelValue"])]),_:1}),(0,s.bF)(k,{label:"详细描述"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{modelValue:se.value.detail,"onUpdate:modelValue":a[2]||(a[2]=e=>se.value.detail=e),type:"textarea",rows:4,maxlength:"500","show-word-limit":"",placeholder:"提供越多细节越容易获得通过，例如参考资料、修改思路等。"},null,8,["modelValue"])]),_:1}),(0,s.bF)(k,null,{default:(0,s.k6)(()=>[(0,s.bF)(o,{type:"primary",loading:te.value,onClick:he},{default:(0,s.k6)(()=>[...a[15]||(a[15]=[(0,s.eW)(" 提交申请 ",-1)])]),_:1},8,["loading"]),(0,u.R1)(n).isLoggedIn&&oe.value?((0,s.uX)(),(0,s.Wv)(o,{key:0,text:"",onClick:me},{default:(0,s.k6)(()=>[...a[16]||(a[16]=[(0,s.eW)(" 我已拥有权限，前往编辑 ",-1)])]),_:1})):(0,s.Q3)("",!0)]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])])])):((0,s.uX)(),(0,s.CE)("div",f,[(0,s.bF)(i,{description:"词条不存在或已被删除"})]))])}}},B=l(6262);const S=(0,B.A)(P,[["__scopeId","data-v-2091a3be"]]);var J=S}}]);
//# sourceMappingURL=614.54e03e75.js.map