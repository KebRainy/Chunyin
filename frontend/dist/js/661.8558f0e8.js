"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[661],{6901:function(e,a,l){l.d(a,{BG:function(){return n},Bk:function(){return o},FC:function(){return c},HK:function(){return v},K6:function(){return m},KJ:function(){return s},N$:function(){return p},lU:function(){return r},pM:function(){return i},v7:function(){return d},w9:function(){return u}});var t=l(7277);const r=e=>(0,t.A)({url:"/bars/register",method:"post",data:e}),n=e=>(0,t.A)({url:`/bars/${e}`,method:"get"}),u=e=>(0,t.A)({url:"/bars/nearby",method:"get",params:e}),o=e=>(0,t.A)({url:`/bars/city/${e}`,method:"get"}),i=e=>(0,t.A)({url:"/bars/search",method:"get",params:e}),s=()=>(0,t.A)({url:"/bars/applications/my",method:"get"}),d=e=>(0,t.A)({url:"/bars/reviews",method:"post",data:e}),c=e=>(0,t.A)({url:`/bars/${e}/reviews`,method:"get"}),v=e=>(0,t.A)({url:`/bars/reviews/${e}`,method:"delete"}),m=e=>(0,t.A)({url:"/bars/recommend",method:"get",params:e}),p=e=>{const a={};return e&&Array.isArray(e)&&e.length>0&&(a.alcoholIds=e),(0,t.A)({url:"/bars/my",method:"get",params:a})}},8027:function(e,a,l){l.d(a,{AJ:function(){return o},E1:function(){return r},IE:function(){return d},Kg:function(){return s},Qs:function(){return n},dR:function(){return u},h3:function(){return v},kz:function(){return c},qP:function(){return i}});l(8111),l(2489);var t=l(7277);const r=e=>(0,t.A)({url:"/activities",method:"post",data:e}),n=(e=1,a=10)=>(0,t.A)({url:"/activities/my-created",method:"get",params:{page:e,size:a}}),u=(e,a,l=1,r=10)=>(0,t.A)({url:"/activities/recommended",method:"get",params:{barId:e,beverageId:a,page:l,size:r}}),o=(e=1,a=10)=>(0,t.A)({url:"/activities/my-participated",method:"get",params:{page:e,size:a}}),i=e=>(0,t.A)({url:`/activities/${e}`,method:"get"}),s=e=>(0,t.A)({url:`/activities/${e}/join`,method:"post"}),d=e=>(0,t.A)({url:`/activities/${e}/cancel`,method:"post"}),c=(e,a)=>(0,t.A)({url:`/activities/${e}/review`,method:"post",data:a}),v=(e=1,a=10)=>(0,t.A)({url:"/activities/pending",method:"get",params:{page:e,size:a}})},8661:function(e,a,l){l.r(a),l.d(a,{default:function(){return X}});l(4114),l(8111),l(116);var t=l(641),r=l(33),n=l(953),u=l(5220),o=l(163),i=l(8548),s=l(8027),d=l(7277);const c=()=>(0,d.A)({url:"/alcohols",method:"get"});var v=l(6901);const m={class:"create-activity"},p={class:"page-header"},b={key:0,class:"selected-bar-section"},g={class:"bar-option"},h={class:"bar-option-header"},f={class:"bar-name"},k={class:"bar-option-info"},y={class:"bar-address"},I={key:0,class:"bar-distance"},F={key:1},_={class:"bar-select-section"},w={class:"bar-option"},A={class:"bar-option-header"},V={class:"bar-name"},x={class:"bar-option-info"},C={class:"bar-address"},L={key:0,class:"bar-beverages",style:{color:"#909399","font-size":"12px"}};var R={__name:"CreateActivity",setup(e){const a=(0,u.rd)(),l=(0,n.KR)(null),d=(0,n.KR)(!1),R=(0,n.KR)(!1),E=(0,n.KR)({activityTime:null,alcoholIds:[],barId:null,maxParticipants:2,remark:""}),K=(e,a,l)=>{a&&0!==a.length?a.length>2?l(new Error("最多只能选择2个酒类标签")):l():l(new Error("请至少选择一个酒类标签"))},X={activityTime:[{required:!0,message:"请选择活动时间",trigger:"change"}],alcoholIds:[{required:!0,validator:K,trigger:"change"}],maxParticipants:[{required:!0,message:"请输入参与人数上限",trigger:"blur"},{type:"number",min:2,max:50,message:"参与人数上限应在2-50之间",trigger:"blur"}]},$=(0,n.KR)([]),T=(0,n.KR)([]),W=(0,n.KR)(null),z=e=>e.getTime()<Date.now()-864e5,P=async()=>{try{const e=await c();200===e.code&&($.value=e.data||[])}catch(e){o.nk.error("加载酒类标签列表失败")}},U=async()=>{if(E.value.alcoholIds&&E.value.alcoholIds.length>2)return o.nk.warning("最多只能选择2个酒类标签"),void(E.value.alcoholIds=E.value.alcoholIds.slice(0,2));await Y()},Y=async()=>{R.value=!0;try{const e=E.value.alcoholIds&&E.value.alcoholIds.length>0?E.value.alcoholIds:null,a=await(0,v.N$)(e);if(200===a.code&&(T.value=a.data||[],E.value.barId)){const e=T.value.find(e=>e.id===E.value.barId);e&&(W.value={...e})}}catch(e){console.error("加载商家酒吧失败:",e);const a=e.response?.data?.message||e.message||"加载商家酒吧失败";o.nk.error(a)}finally{R.value=!1}},D=e=>{if(!e)return void(W.value=null);const a=T.value.find(a=>a.id===e);a&&(W.value={...a})},H=()=>{E.value.barId=null,W.value=null,Y()},M=async()=>{l.value&&await l.value.validate(async e=>{if(e)if(E.value.alcoholIds&&0!==E.value.alcoholIds.length){d.value=!0;try{const e=await(0,s.E1)({activityTime:E.value.activityTime,alcoholIds:E.value.alcoholIds,barId:E.value.barId||null,maxParticipants:E.value.maxParticipants,remark:E.value.remark||null});200===e.code&&(o.nk.success("活动创建成功，等待管理员审核"),a.push("/activities"))}catch(l){console.error("创建活动失败:",l);const e=l.response?.data?.message||l.message||"创建活动失败";o.nk.error(e)}finally{d.value=!1}}else o.nk.error("请至少选择一个酒类标签")})},q=()=>{l.value?.resetFields(),E.value={activityTime:null,alcoholIds:[],barId:null,maxParticipants:2,remark:""},T.value=[],W.value=null};return(0,t.sV)(()=>{P(),Y()}),(e,a)=>{const u=(0,t.g2)("el-button"),o=(0,t.g2)("el-date-picker"),s=(0,t.g2)("el-form-item"),c=(0,t.g2)("el-option"),v=(0,t.g2)("el-select"),K=(0,t.g2)("el-rate"),P=(0,t.g2)("el-icon"),Y=(0,t.g2)("el-card"),B=(0,t.g2)("el-empty"),Q=(0,t.g2)("el-radio"),N=(0,t.g2)("el-radio-group"),J=(0,t.g2)("el-input-number"),j=(0,t.g2)("el-input"),G=(0,t.g2)("el-form"),O=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",m,[(0,t.Lk)("div",p,[a[9]||(a[9]=(0,t.Lk)("h2",null,"发起活动",-1)),(0,t.bF)(u,{onClick:a[0]||(a[0]=a=>e.$router.back())},{default:(0,t.k6)(()=>[...a[8]||(a[8]=[(0,t.eW)("返回",-1)])]),_:1})]),(0,t.bF)(Y,null,{default:(0,t.k6)(()=>[(0,t.bF)(G,{ref_key:"formRef",ref:l,model:E.value,rules:X,"label-width":"120px"},{default:(0,t.k6)(()=>[(0,t.bF)(s,{label:"活动时间",prop:"activityTime"},{default:(0,t.k6)(()=>[(0,t.bF)(o,{modelValue:E.value.activityTime,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value.activityTime=e),type:"datetime",placeholder:"选择活动时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss","disabled-date":z,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,t.bF)(s,{label:"酒类标签",prop:"alcoholIds"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:E.value.alcoholIds,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value.alcoholIds=e),placeholder:"请选择酒类标签（最多2个）",filterable:"",multiple:"","max-collapse-tags":2,style:{width:"100%"},onChange:U},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.value,e=>((0,t.uX)(),(0,t.Wv)(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a[10]||(a[10]=(0,t.Lk)("div",{style:{color:"#909399","font-size":"12px","margin-top":"5px"}}," 最多可选择2个酒类标签 ",-1))]),_:1}),(0,t.bF)(s,{label:"酒吧选择",prop:"barId"},{default:(0,t.k6)(()=>[E.value.barId&&W.value?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.bF)(Y,{shadow:"hover",class:"selected-bar-card"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",g,[(0,t.Lk)("div",h,[(0,t.Lk)("span",f,(0,r.v_)(W.value.name),1),(0,t.bF)(K,{modelValue:W.value.avgRating,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value.avgRating=e),disabled:"","show-score":"",size:"small"},null,8,["modelValue"])]),(0,t.Lk)("div",k,[(0,t.Lk)("span",y,[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,n.R1)(i.LocationFilled))]),_:1}),(0,t.eW)(" "+(0,r.v_)(W.value.address),1)]),W.value.distance?((0,t.uX)(),(0,t.CE)("span",I," 距离: "+(0,r.v_)(W.value.distance.toFixed(2))+" 公里 ",1)):(0,t.Q3)("",!0)])])]),_:1}),(0,t.bF)(u,{type:"primary",style:{"margin-top":"10px"},onClick:H},{default:(0,t.k6)(()=>[...a[11]||(a[11]=[(0,t.eW)(" 重新选择酒吧 ",-1)])]),_:1})])):((0,t.uX)(),(0,t.CE)("div",F,[(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",_,[0!==T.value.length||R.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(B,{key:0,description:"您还没有酒吧，请先注册酒吧"})),(0,t.bF)(N,{modelValue:E.value.barId,"onUpdate:modelValue":a[4]||(a[4]=e=>E.value.barId=e),class:"bar-radio-group",onChange:D},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(T.value,e=>((0,t.uX)(),(0,t.Wv)(Q,{key:e.id,label:e.id,class:"bar-radio"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",w,[(0,t.Lk)("div",A,[(0,t.Lk)("span",V,(0,r.v_)(e.name),1),(0,t.bF)(K,{modelValue:e.avgRating,"onUpdate:modelValue":a=>e.avgRating=a,disabled:"","show-score":"",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),(0,t.Lk)("div",x,[(0,t.Lk)("span",C,[(0,t.bF)(P,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,n.R1)(i.LocationFilled))]),_:1}),(0,t.eW)(" "+(0,r.v_)(e.address),1)]),e.mainBeverages?((0,t.uX)(),(0,t.CE)("span",L,(0,r.v_)(e.mainBeverages),1)):(0,t.Q3)("",!0)])])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])),[[O,R.value]]),(0,t.bF)(u,{type:"text",style:{"margin-top":"10px"},onClick:a[5]||(a[5]=e=>{E.value.barId=null,W.value=null})},{default:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.eW)(" 不选择酒吧 ",-1)])]),_:1})]))]),_:1}),(0,t.bF)(s,{label:"参与人数上限",prop:"maxParticipants"},{default:(0,t.k6)(()=>[(0,t.bF)(J,{modelValue:E.value.maxParticipants,"onUpdate:modelValue":a[6]||(a[6]=e=>E.value.maxParticipants=e),min:2,max:50,placeholder:"请输入参与人数上限",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,t.bF)(s,{label:"备注",prop:"remark"},{default:(0,t.k6)(()=>[(0,t.bF)(j,{modelValue:E.value.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>E.value.remark=e),type:"textarea",rows:4,placeholder:"请输入活动备注（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(s,null,{default:(0,t.k6)(()=>[(0,t.bF)(u,{type:"primary",onClick:M,loading:d.value},{default:(0,t.k6)(()=>[...a[13]||(a[13]=[(0,t.eW)(" 提交审核 ",-1)])]),_:1},8,["loading"]),(0,t.bF)(u,{onClick:q},{default:(0,t.k6)(()=>[...a[14]||(a[14]=[(0,t.eW)("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},E=l(6262);const K=(0,E.A)(R,[["__scopeId","data-v-f129dde0"]]);var X=K}}]);
//# sourceMappingURL=661.8558f0e8.js.map