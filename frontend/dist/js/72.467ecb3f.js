"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[72],{3072:function(e,t,s){s.r(t),s.d(t,{default:function(){return G}});s(4114),s(8111),s(3579),s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);var a=s(641),l=s(953),n=s(33),o=s(5220),u=s(5696),i=s(6400),c=s(4402),r=s(9686),d=s(7277);const v=()=>(0,d.A)({url:"/daily-question/today",method:"get"}),p=(e,t)=>(0,d.A)({url:`/daily-question/${e}/answer`,method:"post",data:{optionIndex:t}});var k=s(163),m=s(7918),y=s(4353),g=s.n(y),h=(s(6033),s(5394)),f=s(6617);const E={class:"home-container"},C={class:"top-section"},L={class:"share-section"},w={key:1,class:"login-prompt equal-card"},b={class:"daily-question-section"},_={class:"question-header"},F={class:"question-date"},X={key:0,class:"question-content"},R={key:1,class:"question-content"},x={key:2,class:"question-content"},W={class:"options"},N=["onClick"],q={class:"option-text"},S={key:0,class:"option-stats"},K={class:"option-count"},O={key:0,class:"answer-result"},U={key:0,class:"correct"},D={key:1,class:"wrong"},$={key:1,class:"answer-explanation"},Q={class:"posts-container"},A={key:0,class:"loading"},I={key:1,class:"empty"},M={key:2,class:"masonry-grid"},T={key:3,class:"load-more"},z={key:4,class:"no-more"},V=4;var Y={__name:"Home",setup(e){g().locale("zh-cn");const t=(0,o.rd)(),s=(0,i.k)(),d=(0,l.KR)(null),y=(0,l.KR)([]),Y=(0,l.KR)(!1),P=(0,l.KR)(1),B=(0,l.KR)(12),G=(0,l.KR)(!0),j=(0,l.KR)([]),H=(0,l.KR)(null),J=(0,l.KR)(!1),Z=(0,l.KR)(!1),ee=(0,a.EW)(()=>g()().format("M月D日")),te=(0,a.EW)(()=>H.value?.answered||!1),se=(0,a.EW)(()=>H.value?.selectedOption??null),ae=async(e=0)=>{try{const e=await r.L.getRecommendedPosts(1,10),t=e.data?.items||[];j.value=t}catch(t){const s="ECONNREFUSED"===t.code||t.message?.includes("ECONNREFUSED")||t.message?.includes("Network Error");if(s&&e<3){const t=1e3*Math.pow(2,e);setTimeout(()=>{ae(e+1)},t)}else console.error("Failed to load recommended posts:",t)}},le=(e,t)=>{if(!t||0===t.length)return e;const s=[];let a=0;const l=new Set;for(let n=0;n<e.length;n++)if(s.push(e[n]),(n+1)%V===0&&a<t.length)while(a<t.length){const n=t[a],o=e.some(e=>e.id===n.id)||l.has(n.id);if(a++,!o){l.add(n.id),s.push({...n,isRecommended:!0});break}}return s},ne=async(e=0)=>{Y.value=!0;try{const e=await c.x.listPosts(P.value,B.value),t=e.data,s=t.items||[];1===P.value?y.value=le(s,j.value):y.value.push(...s),G.value=s.length>=B.value}catch(t){const s="ECONNREFUSED"===t.code||t.message?.includes("ECONNREFUSED")||t.message?.includes("Network Error");if(s&&e<3){const t=1e3*Math.pow(2,e);return void setTimeout(()=>{ne(e+1)},t)}console.error("Failed to load posts:",t),k.nk.error("加载失败")}finally{Y.value=!1}},oe=()=>{P.value++,ne()},ue=()=>{P.value=1,G.value=!0,ne()},ie=()=>{ue()},ce=async(e=0)=>{J.value=!0;try{const e=await v();H.value=e.data}catch(t){const s="ECONNREFUSED"===t.code||t.message?.includes("ECONNREFUSED")||t.message?.includes("Network Error");if(s&&e<3){const t=1e3*Math.pow(2,e);return void setTimeout(()=>{ce(e+1)},t)}H.value=null}finally{J.value=!1}},re=e=>{t.push(`/posts/${e}`)},de=()=>{t.push("/login")},ve=async e=>{if(H.value&&!H.value.answered)if(s.isLoggedIn){Z.value=!0;try{const t=await p(H.value.id,e);H.value=t.data,k.nk.success("已记录你的选择")}catch(a){k.nk.error(a.response?.data?.message||"提交失败")}finally{Z.value=!1}}else t.push("/login")},pe=e=>H.value&&H.value.answered?e===H.value.correctOption?"correct":e===H.value.selectedOption&&e!==H.value.correctOption?"wrong":"other":"clickable",ke=e=>e>1e4?(e/1e4).toFixed(1)+"万":e.toString(),me=e=>{if(!e)return;if(e.startsWith("http"))return void window.open(e,"_blank");const s=e.startsWith("/")?e:`/wiki/${e}`;t.push(s)},ye=()=>!!d.value?.hasUnsaved?.value,ge=e=>{if(!ye())return;const t="是否离开网站 你所做的更改可能未保存";return e.preventDefault(),e.returnValue=t,t};return(0,u.JZ)((e,t,s)=>{ye()?m.s.confirm("是否离开网站 你所做的更改可能未保存","离开确认",{confirmButtonText:"仍要离开",cancelButtonText:"继续编辑",type:"warning"}).then(()=>s()).catch(()=>s(!1)):s()}),(0,a.sV)(async()=>{window.addEventListener("beforeunload",ge),setTimeout(()=>{ae(),ne(),ce()},500)}),(0,a.xo)(()=>{window.removeEventListener("beforeunload",ge)}),(e,t)=>{const o=(0,a.g2)("el-card"),u=(0,a.g2)("el-button"),i=(0,a.g2)("el-skeleton"),c=(0,a.g2)("el-empty");return(0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("div",C,[(0,a.Lk)("div",L,[(0,l.R1)(s).isLoggedIn?((0,a.uX)(),(0,a.Wv)(o,{key:0,class:"share-editor-card equal-card"},{default:(0,a.k6)(()=>[t[1]||(t[1]=(0,a.Lk)("div",{class:"share-editor-header"},[(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"eyebrow"},"此刻发布"),(0,a.Lk)("h3",null,"分享你的灵感"),(0,a.Lk)("span",null,"支持图文、标签、地点，一次完成")])],-1)),(0,a.bF)(h.A,{ref_key:"composerRef",ref:d,mode:"inline",onSubmitted:ie},null,512)]),_:1})):((0,a.uX)(),(0,a.CE)("div",w,[t[3]||(t[3]=(0,a.Lk)("p",null,"登录后即可分享图文、参加活动",-1)),(0,a.bF)(u,{type:"primary",onClick:de},{default:(0,a.k6)(()=>[...t[2]||(t[2]=[(0,a.eW)("登录",-1)])]),_:1})]))]),(0,a.Lk)("div",b,[(0,a.bF)(o,{class:"question-card equal-card"},{header:(0,a.k6)(()=>[(0,a.Lk)("div",_,[t[4]||(t[4]=(0,a.Lk)("span",null,"每日一题",-1)),(0,a.Lk)("span",F,(0,n.v_)(ee.value),1)])]),default:(0,a.k6)(()=>[J.value?((0,a.uX)(),(0,a.CE)("div",X,[(0,a.bF)(i,{rows:4,animated:""})])):H.value?((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("h4",null,(0,n.v_)(H.value.question),1),(0,a.Lk)("div",W,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(H.value.options,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.index,class:(0,n.C4)(["option",pe(e.index),{disabled:Z.value}]),onClick:t=>ve(e.index)},[(0,a.Lk)("span",q,(0,n.v_)(e.label)+". "+(0,n.v_)(e.text),1),te.value?((0,a.uX)(),(0,a.CE)("div",S,[(0,a.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:e.percentage+"%"})},null,4),(0,a.Lk)("span",K,(0,n.v_)(ke(e.count)),1)])):(0,a.Q3)("",!0)],10,N))),128))]),te.value?((0,a.uX)(),(0,a.CE)("div",O,[se.value===H.value.correctOption?((0,a.uX)(),(0,a.CE)("span",U," ✓ 回答正确！ ")):((0,a.uX)(),(0,a.CE)("span",D," ✗ 回答错误，正确答案是："+(0,n.v_)(H.value.options[H.value.correctOption].text),1))])):(0,a.Q3)("",!0),te.value&&H.value.explanation?((0,a.uX)(),(0,a.CE)("div",$,[(0,a.Lk)("p",null,(0,n.v_)(H.value.explanation),1),H.value.wikiLink?((0,a.uX)(),(0,a.Wv)(u,{key:0,size:"small",type:"primary",link:"",onClick:t[0]||(t[0]=e=>me(H.value.wikiLink))},{default:(0,a.k6)(()=>[...t[5]||(t[5]=[(0,a.eW)(" 查看相关词条 ",-1)])]),_:1})):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",R,[(0,a.bF)(c,{description:"暂未发布今日题目"})]))]),_:1})])]),(0,a.Lk)("div",Q,[Y.value?((0,a.uX)(),(0,a.CE)("div",A,"加载中...")):0===y.value.length?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.bF)(c,{description:"暂无动态"})])):((0,a.uX)(),(0,a.CE)("div",M,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.value,e=>((0,a.uX)(),(0,a.Wv)(f.A,{key:e.id,post:e,onSelect:t=>re(e.id)},null,8,["post","onSelect"]))),128))])),!Y.value&&G.value?((0,a.uX)(),(0,a.CE)("div",T,[(0,a.bF)(u,{onClick:oe},{default:(0,a.k6)(()=>[...t[6]||(t[6]=[(0,a.eW)("加载更多",-1)])]),_:1})])):(0,a.Q3)("",!0),!G.value&&y.value.length>0?((0,a.uX)(),(0,a.CE)("div",z," 已加载全部内容 ")):(0,a.Q3)("",!0)])])}}},P=s(6262);const B=(0,P.A)(Y,[["__scopeId","data-v-615acb6f"]]);var G=B},6617:function(e,t,s){s.d(t,{A:function(){return S}});var a=s(641),l=s(33),n=s(953),o=s(4353),u=s.n(o),i=s(8660),c=s.n(i),r=s(8548);const d={key:0,class:"recommend-badge"},v={key:1,class:"card-media"},p=["src","alt"],k={class:"image-overlay"},m={class:"overlay-item"},y={class:"overlay-item"},g={key:0,class:"count"},h={key:2,class:"card-media no-image"},f={class:"no-image-text"},E={class:"image-overlay"},C={class:"overlay-item"},L={class:"overlay-item"},w={class:"card-body"},b={class:"content"},_={key:0,class:"tags"},F={class:"card-meta"},X={class:"author"},R={class:"name"},x={class:"time"};var W={__name:"PostCard",props:{post:{type:Object,required:!0},layout:{type:String,default:"masonry"}},emits:["select"],setup(e){u().extend(c());const t=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",s=e=>e?e.length>60?`${e.slice(0,60)}...`:e:"分享此刻的灵感",o=e=>{if(!e)return"";const t=u()(e),s=u()(),a=s.diff(t,"minute");if(a<60)return`${a||1}分钟前`;const l=s.diff(t,"hour");return l<24?`${l}小时前`:t.isSame(s,"year")?t.format("M月D日"):t.format("YYYY年M月D日")};return(u,i)=>{const c=(0,a.g2)("el-icon"),W=(0,a.g2)("el-tag"),N=(0,a.g2)("el-avatar");return(0,a.uX)(),(0,a.CE)("div",{class:(0,l.C4)(["post-card",e.layout,{"is-recommended":e.post.isRecommended}]),onClick:i[0]||(i[0]=t=>u.$emit("select",e.post))},[e.post.isRecommended?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.MagicStick))]),_:1}),i[1]||(i[1]=(0,a.Lk)("span",null,"猜你喜欢",-1))])):(0,a.Q3)("",!0),e.post.imageUrls?.length?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("img",{src:e.post.imageUrls[0],alt:e.post.content||`${e.post.author?.username||"用户"}的分享图片`},null,8,p),(0,a.Lk)("div",k,[(0,a.Lk)("span",m,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.View))]),_:1}),(0,a.eW)((0,l.v_)(e.post.viewCount||0),1)]),(0,a.Lk)("span",y,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.GobletFull))]),_:1}),(0,a.eW)((0,l.v_)(e.post.likeCount||0),1)])]),e.post.imageUrls.length>1?((0,a.uX)(),(0,a.CE)("span",g,"+"+(0,l.v_)(e.post.imageUrls.length-1),1)):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",h,[(0,a.Lk)("p",f,(0,l.v_)(s(e.post.content)),1),(0,a.Lk)("div",E,[(0,a.Lk)("span",C,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.View))]),_:1}),(0,a.eW)((0,l.v_)(e.post.viewCount||0),1)]),(0,a.Lk)("span",L,[(0,a.bF)(c,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,n.R1)(r.GobletFull))]),_:1}),(0,a.eW)((0,l.v_)(e.post.likeCount||0),1)])])])),(0,a.Lk)("div",w,[(0,a.Lk)("p",b,(0,l.v_)(t(e.post.content)),1),e.post.tags?.length?((0,a.uX)(),(0,a.CE)("div",_,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.post.tags.slice(0,2),e=>((0,a.uX)(),(0,a.Wv)(W,{key:e,size:"small",effect:"light"},{default:(0,a.k6)(()=>[(0,a.eW)(" # "+(0,l.v_)(e),1)]),_:2},1024))),128))])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",F,[(0,a.Lk)("div",X,[(0,a.bF)(N,{src:e.post.author?.avatarUrl,size:28,alt:`${e.post.author?.username||"用户"}的头像`},null,8,["src","alt"]),(0,a.Lk)("p",R,(0,l.v_)(e.post.author?.username),1)]),(0,a.Lk)("span",x,(0,l.v_)(o(e.post.createdAt)),1)])],2)}}},N=s(6262);const q=(0,N.A)(W,[["__scopeId","data-v-2be613fd"]]);var S=q}}]);
//# sourceMappingURL=72.467ecb3f.js.map