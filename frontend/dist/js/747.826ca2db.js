"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[747],{747:function(e,s,l){l.r(s),l.d(s,{default:function(){return H}});l(4114),l(8111),l(2489),l(116);var a=l(641),t=l(33),o=l(953),u=l(5220),n=l(6400),r=l(4402),i=l(2549),c=l(9686),d=l(6617),v=l(3751),k=l(163),m=l(8548);const p={key:0,class:"recommended-user-card"},f={class:"card-header"},g={class:"username"},y={class:"reason"},b={key:0,class:"bio"},h={class:"card-footer"},C={class:"user-info-dialog"},_={class:"dialog-header"},F={class:"dialog-user-info"},w={key:0,class:"bio"},E={key:1,class:"bio-placeholder"},L={class:"dialog-actions"},X={key:1,class:"blocked-message"};var R={__name:"RecommendedUserCard",props:{user:{type:Object,required:!0}},emits:["followed","blocked"],setup(e,{emit:s}){const l=e,r=s,c=(0,u.rd)(),d=(0,n.k)(),R=(0,o.KR)(!1),$=(0,o.KR)(!1),A=(0,o.KR)(!1),K=e=>e?e.length>30?e.slice(0,30)+"...":e:"",U=()=>{$.value=!0},W=()=>{c.push(`/users/${l.user.id}`),$.value=!1},I=async()=>{if(!d.isLoggedIn)return k.nk.warning("请先登录"),void c.push("/login");R.value=!0;try{l.user.following?(await(0,i.Qt)(l.user.id),l.user.following=!1,k.nk.success("已取消关注")):(await(0,i.pV)(l.user.id),l.user.following=!0,k.nk.success("关注成功")),r("followed",l.user.id)}catch(e){k.nk.error(e.response?.data?.message||"操作失败，请稍后再试")}finally{R.value=!1}},z=async()=>{if(d.isLoggedIn)try{await(0,i.Eo)(l.user.id),A.value=!0,k.nk.success("不会再推荐该用户"),r("blocked",l.user.id)}catch(e){k.nk.error(e.response?.data?.message||"操作失败，请稍后再试")}else k.nk.warning("请先登录")};return(s,l)=>{const u=(0,a.g2)("el-icon"),n=(0,a.g2)("el-avatar"),r=(0,a.g2)("el-button"),i=(0,a.g2)("el-dialog"),c=(0,a.g2)("el-text");return A.value?((0,a.uX)(),(0,a.CE)("div",X,[(0,a.bF)(c,{type:"info",size:"small"},{default:(0,a.k6)(()=>[...l[3]||(l[3]=[(0,a.eW)("不会再推荐该用户",-1)])]),_:1})])):((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("div",f,[(0,a.bF)(n,{src:e.user.avatarUrl,size:48,alt:`${e.user.username}的头像`,class:"user-avatar",onClick:(0,v.D$)(U,["stop"])},{default:(0,a.k6)(()=>[(0,a.bF)(u,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(m.User))]),_:1})]),_:1},8,["src","alt"]),(0,a.bF)(u,{class:"close-icon",onClick:(0,v.D$)(z,["stop"])},{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(m.Close))]),_:1})]),(0,a.Lk)("div",{class:"card-body",onClick:(0,v.D$)(U,["stop"])},[(0,a.Lk)("div",g,(0,t.v_)(e.user.username),1),(0,a.Lk)("div",y,(0,t.v_)(e.user.reason),1),e.user.bio?((0,a.uX)(),(0,a.CE)("div",b,(0,t.v_)(K(e.user.bio)),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",h,[(0,a.bF)(r,{type:"primary",size:"small",plain:e.user.following,loading:R.value,onClick:(0,v.D$)(I,["stop"]),class:"follow-btn"},{default:(0,a.k6)(()=>[(0,a.eW)((0,t.v_)(e.user.following?"已关注":"关注"),1)]),_:1},8,["plain","loading"])]),(0,a.bF)(i,{modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value=e),title:e.user.username,width:"500px",onClose:l[1]||(l[1]=e=>$.value=!1)},{default:(0,a.k6)(()=>[(0,a.Lk)("div",C,[(0,a.Lk)("div",_,[(0,a.bF)(n,{src:e.user.avatarUrl,size:80,alt:`${e.user.username}的头像`},{default:(0,a.k6)(()=>[(0,a.bF)(u,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(m.User))]),_:1})]),_:1},8,["src","alt"]),(0,a.Lk)("div",F,[(0,a.Lk)("h3",null,(0,t.v_)(e.user.username),1),e.user.bio?((0,a.uX)(),(0,a.CE)("p",w,(0,t.v_)(e.user.bio),1)):((0,a.uX)(),(0,a.CE)("p",E,"这位用户很低调，还没有简介"))])]),(0,a.Lk)("div",L,[(0,a.bF)(r,{type:"primary",plain:e.user.following,loading:R.value,onClick:I},{default:(0,a.k6)(()=>[(0,a.eW)((0,t.v_)(e.user.following?"已关注":"关注"),1)]),_:1},8,["plain","loading"]),(0,a.bF)(r,{onClick:W},{default:(0,a.k6)(()=>[...l[2]||(l[2]=[(0,a.eW)("查看主页",-1)])]),_:1})])])]),_:1},8,["modelValue","title"])]))}}},$=l(6262);const A=(0,$.A)(R,[["__scopeId","data-v-9c83bd40"]]);var K=A;const U={class:"feed-container"},W={class:"followees-section"},I={key:0,class:"followees-loading"},z={key:1,class:"followees-list"},D=["title","onClick"],Q={class:"followee-name"},V={class:"main-content"},S={class:"feed-posts"},x={key:0,class:"loading"},N={key:1,class:"empty"},O={key:2,class:"masonry-grid"},P={key:3,class:"load-more"},Y={key:4,class:"no-more"},q={class:"recommended-users-sidebar"},G={key:0,class:"loading-users"},M={key:1,class:"empty-users"},j={key:2,class:"users-list"};var T={__name:"Feed",setup(e){const s=(0,u.rd)(),l=(0,n.k)(),v=(0,o.KR)([]),k=(0,o.KR)(!0),m=(0,o.KR)(1),p=(0,o.KR)(12),f=(0,o.KR)(!0),g=(0,o.KR)([]),y=(0,o.KR)(!0),b=(0,o.KR)([]),h=(0,o.KR)(!0),C=async()=>{try{const e=await(0,i.hc)();g.value=e.data||[]}catch(e){console.error("Failed to load followees:",e)}finally{y.value=!1}},_=async()=>{k.value=!0;try{const e=await r.x.listFeed(m.value,p.value),s=e.data,l=s.items||[];1===m.value?v.value=l:v.value.push(...l),f.value=l.length>=p.value}catch(e){console.error("Failed to load feed:",e)}finally{k.value=!1}},F=()=>{m.value++,_()},w=e=>{s.push(`/posts/${e}`)},E=e=>{s.push(`/users/${e}`)},L=async(e=0)=>{if(l.isLoggedIn){h.value=!0;try{const e=await c.L.getRecommendedUsers(10);b.value=e.data||[]}catch(s){const l="ECONNREFUSED"===s.code||s.message?.includes("ECONNREFUSED")||s.message?.includes("Network Error")||s.message?.includes("Proxy error")||void 0===s.response;if(l&&e<3)return await new Promise(s=>setTimeout(s,1e3*(e+1))),L(e+1);l||console.error("Failed to load recommended users:",s)}finally{h.value=!1}}else h.value=!1},X=e=>{const s=b.value.find(s=>s.id===e);s&&(s.following=!0)},R=e=>{b.value=b.value.filter(s=>s.id!==e)};return(0,a.sV)(()=>{C(),_(),setTimeout(()=>{L()},500)}),(e,s)=>{const l=(0,a.g2)("el-avatar"),o=(0,a.g2)("el-empty"),u=(0,a.g2)("el-button"),n=(0,a.g2)("el-skeleton");return(0,a.uX)(),(0,a.CE)("div",U,[(0,a.Lk)("div",W,[y.value?((0,a.uX)(),(0,a.CE)("div",I,"加载关注列表...")):((0,a.uX)(),(0,a.CE)("div",z,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(g.value,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"followee-avatar",title:e.username,onClick:s=>E(e.id)},[(0,a.bF)(l,{src:e.avatarUrl,size:48,alt:`${e.username}的头像`},null,8,["src","alt"]),(0,a.Lk)("span",Q,(0,t.v_)(e.username),1)],8,D))),128))]))]),(0,a.Lk)("div",V,[(0,a.Lk)("div",S,[k.value&&0===v.value.length?((0,a.uX)(),(0,a.CE)("div",x,"加载中...")):0===v.value.length?((0,a.uX)(),(0,a.CE)("div",N,[(0,a.bF)(o,{description:"还没有关注的动态"})])):((0,a.uX)(),(0,a.CE)("div",O,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(v.value,e=>((0,a.uX)(),(0,a.Wv)(d.A,{key:e.id,post:e,onSelect:s=>w(e.id)},null,8,["post","onSelect"]))),128))])),!k.value&&f.value?((0,a.uX)(),(0,a.CE)("div",P,[(0,a.bF)(u,{onClick:F},{default:(0,a.k6)(()=>[...s[0]||(s[0]=[(0,a.eW)("加载更多",-1)])]),_:1})])):(0,a.Q3)("",!0),!f.value&&v.value.length>0?((0,a.uX)(),(0,a.CE)("div",Y," 已加载全部内容 ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",q,[s[1]||(s[1]=(0,a.Lk)("div",{class:"sidebar-header"},[(0,a.Lk)("h3",null,"你可能感兴趣的人")],-1)),h.value?((0,a.uX)(),(0,a.CE)("div",G,[(0,a.bF)(n,{rows:3,animated:""})])):0===b.value.length?((0,a.uX)(),(0,a.CE)("div",M,[(0,a.bF)(o,{description:"暂无推荐","image-size":80})])):((0,a.uX)(),(0,a.CE)("div",j,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(b.value,e=>((0,a.uX)(),(0,a.Wv)(K,{key:e.id,user:e,onFollowed:X,onBlocked:R},null,8,["user"]))),128))]))])])])}}};const B=(0,$.A)(T,[["__scopeId","data-v-6f824c45"]]);var H=B},2549:function(e,s,l){l.d(s,{Eo:function(){return k},Qt:function(){return r},ec:function(){return u},fG:function(){return v},hP:function(){return d},hc:function(){return i},l2:function(){return t},pV:function(){return n},qw:function(){return c},r7:function(){return o}});var a=l(7277);const t=e=>(0,a.A)({url:`/users/${e}`,method:"get"}),o=e=>(0,a.A)({url:"/users/profile",method:"put",data:e}),u=e=>(0,a.A)({url:"/users/password",method:"put",data:e}),n=e=>(0,a.A)({url:`/users/${e}/follow`,method:"post"}),r=e=>(0,a.A)({url:`/users/${e}/follow`,method:"delete"}),i=()=>(0,a.A)({url:"/users/followees",method:"get"}),c=e=>(0,a.A)({url:"/collections",method:"get",params:e}),d=e=>(0,a.A)({url:"/footprints",method:"get",params:e}),v=e=>(0,a.A)({url:"/footprints",method:"post",data:e}),k=e=>(0,a.A)({url:`/users/${e}/block-recommend`,method:"post"})},6617:function(e,s,l){l.d(s,{A:function(){return W}});var a=l(641),t=l(33),o=l(953),u=l(4353),n=l.n(u),r=l(8660),i=l.n(r),c=l(8548);const d={key:0,class:"recommend-badge"},v={key:1,class:"card-media"},k=["src","alt"],m={class:"image-overlay"},p={class:"overlay-item"},f={class:"overlay-item"},g={key:0,class:"count"},y={key:2,class:"card-media no-image"},b={class:"no-image-text"},h={class:"image-overlay"},C={class:"overlay-item"},_={class:"overlay-item"},F={class:"card-body"},w={class:"content"},E={key:0,class:"tags"},L={class:"card-meta"},X={class:"author"},R={class:"name"},$={class:"time"};var A={__name:"PostCard",props:{post:{type:Object,required:!0},layout:{type:String,default:"masonry"}},emits:["select"],setup(e){n().extend(i());const s=e=>e?e.length>29?`${e.slice(0,29)}...`:e:"",l=e=>e?e.length>60?`${e.slice(0,60)}...`:e:"分享此刻的灵感",u=e=>{if(!e)return"";const s=n()(e),l=n()(),a=l.diff(s,"minute");if(a<60)return`${a||1}分钟前`;const t=l.diff(s,"hour");return t<24?`${t}小时前`:s.isSame(l,"year")?s.format("M月D日"):s.format("YYYY年M月D日")};return(n,r)=>{const i=(0,a.g2)("el-icon"),A=(0,a.g2)("el-tag"),K=(0,a.g2)("el-avatar");return(0,a.uX)(),(0,a.CE)("div",{class:(0,t.C4)(["post-card",e.layout,{"is-recommended":e.post.isRecommended}]),onClick:r[0]||(r[0]=s=>n.$emit("select",e.post))},[e.post.isRecommended?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(c.MagicStick))]),_:1}),r[1]||(r[1]=(0,a.Lk)("span",null,"猜你喜欢",-1))])):(0,a.Q3)("",!0),e.post.imageUrls?.length?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("img",{src:e.post.imageUrls[0],alt:e.post.content||`${e.post.author?.username||"用户"}的分享图片`},null,8,k),(0,a.Lk)("div",m,[(0,a.Lk)("span",p,[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(c.View))]),_:1}),(0,a.eW)((0,t.v_)(e.post.viewCount||0),1)]),(0,a.Lk)("span",f,[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(c.GobletFull))]),_:1}),(0,a.eW)((0,t.v_)(e.post.likeCount||0),1)])]),e.post.imageUrls.length>1?((0,a.uX)(),(0,a.CE)("span",g,"+"+(0,t.v_)(e.post.imageUrls.length-1),1)):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("p",b,(0,t.v_)(l(e.post.content)),1),(0,a.Lk)("div",h,[(0,a.Lk)("span",C,[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(c.View))]),_:1}),(0,a.eW)((0,t.v_)(e.post.viewCount||0),1)]),(0,a.Lk)("span",_,[(0,a.bF)(i,null,{default:(0,a.k6)(()=>[(0,a.bF)((0,o.R1)(c.GobletFull))]),_:1}),(0,a.eW)((0,t.v_)(e.post.likeCount||0),1)])])])),(0,a.Lk)("div",F,[(0,a.Lk)("p",w,(0,t.v_)(s(e.post.content)),1),e.post.tags?.length?((0,a.uX)(),(0,a.CE)("div",E,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.post.tags.slice(0,2),e=>((0,a.uX)(),(0,a.Wv)(A,{key:e,size:"small",effect:"light"},{default:(0,a.k6)(()=>[(0,a.eW)(" # "+(0,t.v_)(e),1)]),_:2},1024))),128))])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",L,[(0,a.Lk)("div",X,[(0,a.bF)(K,{src:e.post.author?.avatarUrl,size:28,alt:`${e.post.author?.username||"用户"}的头像`},null,8,["src","alt"]),(0,a.Lk)("p",R,(0,t.v_)(e.post.author?.username),1)]),(0,a.Lk)("span",$,(0,t.v_)(u(e.post.createdAt)),1)])],2)}}},K=l(6262);const U=(0,K.A)(A,[["__scopeId","data-v-2be613fd"]]);var W=U}}]);
//# sourceMappingURL=747.826ca2db.js.map