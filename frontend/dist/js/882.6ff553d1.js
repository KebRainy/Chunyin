"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[882],{507:function(e,t,n){var r=n(9565);e.exports=function(e,t,n){var a,i,o=n?e:e.iterator,u=e.next;while(!(a=r(u,o)).done)if(i=t(a.value),void 0!==i)return i}},1698:function(e,t,n){var r=n(6518),a=n(4204),i=n(9835),o=n(4916),u=!o("union")||!i("union");r({target:"Set",proto:!0,real:!0,forced:u},{union:a})},2021:function(e,t,n){var r=n(9504),a=Set.prototype;e.exports={Set:Set,add:r(a.add),has:r(a.has),remove:r(a["delete"]),proto:a}},2475:function(e,t,n){var r=n(6518),a=n(8527),i=n(4916),o=!i("isSupersetOf",function(e){return!e});r({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:a})},3440:function(e,t,n){var r=n(7080),a=n(2021),i=n(9286),o=n(5170),u=n(3789),s=n(8469),c=n(507),l=a.has,f=a.remove;e.exports=function(e){var t=r(this),n=u(e),a=i(t);return o(t)<=n.size?s(t,function(e){n.includes(e)&&f(a,e)}):c(n.getIterator(),function(e){l(a,e)&&f(a,e)}),a}},3650:function(e,t,n){var r=n(7080),a=n(2021),i=n(9286),o=n(3789),u=n(507),s=a.add,c=a.has,l=a.remove;e.exports=function(e){var t=r(this),n=o(e).getIterator(),a=i(t);return u(n,function(e){c(t,e)?l(a,e):s(a,e)}),a}},3789:function(e,t,n){var r=n(9306),a=n(8551),i=n(9565),o=n(1291),u=n(1767),s="Invalid size",c=RangeError,l=TypeError,f=Math.max,d=function(e,t){this.set=e,this.size=f(t,0),this.has=r(e.has),this.keys=r(e.keys)};d.prototype={getIterator:function(){return u(a(i(this.keys,this.set)))},includes:function(e){return i(this.has,this.set,e)}},e.exports=function(e){a(e);var t=+e.size;if(t!==t)throw new l(s);var n=o(t);if(n<0)throw new c(s);return new d(e,n)}},3838:function(e,t,n){var r=n(7080),a=n(5170),i=n(8469),o=n(3789);e.exports=function(e){var t=r(this),n=o(e);return!(a(t)>n.size)&&!1!==i(t,function(e){if(!n.includes(e))return!1},!0)}},3853:function(e,t,n){var r=n(6518),a=n(4449),i=n(4916),o=!i("isDisjointFrom",function(e){return!e});r({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:a})},3882:function(e,t,n){n.r(t),n.d(t,{default:function(){return C}});n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var r=n(641),a=n(33),i=n(953),o=n(5220),u=n(8930),s=n(7277);const c=e=>(0,s.A)({url:`/files/${e}`,method:"delete"});var l=n(163),f=n(3263),d=n(9418);const v={class:"editor-page"},p={class:"header"},h={class:"eyebrow"},m={class:"header-actions"},k={class:"editor-grid"},g={class:"editor-panel"},y={class:"toolbar"},w={key:0,class:"uploaded-images"},x={class:"images-list"},b=["src","alt"],S={class:"preview-panel"},z=["innerHTML"];var _={__name:"WikiEditor",setup(e){const t=(0,o.lq)(),n=(0,o.rd)(),s=(0,i.KR)(!1),_=(0,i.KR)(!1),L=(0,i.KR)([]),F=(0,i.Kh)({title:"",summary:"",content:""});let C=null;const E=new f.A({html:!0,linkify:!0,breaks:!0}),I=(0,r.EW)(()=>F.content?d.A.sanitize(E.render(F.content)):'<p class="empty">开始输入内容，实时预览会显示在这里</p>'),V=(0,r.EW)(()=>!!t.params.id),W=e=>{const t=e.type.startsWith("image/"),n=e.size/1024/1024<5;return t||l.nk.error("只能上传图片"),n||l.nk.error("图片需小于 5MB"),t&&n&&(_.value=!0),t&&n},$=e=>{if(_.value=!1,200===e.code&&e.data?.url){const t=e.data.url,n=`![图片说明](${t})`;F.content=F.content?`${F.content}\n\n${n}`:n,l.nk.success("图片已插入")}else l.nk.error("上传失败")},O=()=>{_.value=!1,l.nk.error("上传失败，请稍后再试")},T=async e=>{const t=e.url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`!\\[[^\\]]*\\]\\(${t}\\)`,"g");if(F.content=(F.content||"").replace(n,"").replace(/\n{3,}/g,"\n\n").trim(),e.uuid)try{await c(e.uuid),l.nk.success("图片已删除")}catch(r){l.nk.error(r.response?.data?.message||"删除失败")}else l.nk.success("图片引用已移除")},A=()=>{if(!F.content)return void(L.value=[]);const e=/!\[[^\]]*]\((.*?)\)/g,t=new Set,n=[];let r;while(null!==(r=e.exec(F.content))){const e=r[1]?.trim();if(!e||t.has(e))continue;t.add(e);const a=e.match(/\/(?:api\/)?files\/([a-zA-Z0-9-]+)/);n.push({uid:a?a[1]:`${e}-${n.length}`,url:e,uuid:a?a[1]:null})}L.value=n},D=async()=>{if(!V.value)return;const e=await(0,u.ET)(t.params.id);Object.assign(F,{title:e.data.title,summary:e.data.summary,content:e.data.content})},K=async()=>{if(F.title.trim()&&F.content.trim()){s.value=!0;try{V.value?(await(0,u.xl)(t.params.id,F),l.nk.success("已提交修改，等待审核")):(await(0,u.MC)(F),l.nk.success("已提交，等待审核")),n.push("/wiki")}catch(e){console.error("提交失败:",e),l.nk.error(e.response?.data?.message||"提交失败，请稍后再试")}finally{s.value=!1}}else l.nk.warning("标题和正文不能为空")},M=()=>{n.push("/wiki")};return(0,r.sV)(()=>{D()}),(0,r.wB)(()=>F.content,()=>{C&&clearTimeout(C),C=setTimeout(()=>{A()},200)},{immediate:!0}),(0,r.xo)(()=>{C&&clearTimeout(C)}),(e,t)=>{const n=(0,r.g2)("el-button"),i=(0,r.g2)("el-input"),o=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-upload"),c=(0,r.g2)("el-form"),l=(0,r.g2)("el-card");return(0,r.uX)(),(0,r.CE)("div",v,[(0,r.bF)(l,null,{header:(0,r.k6)(()=>[(0,r.Lk)("div",p,[(0,r.Lk)("div",null,[(0,r.Lk)("p",h,(0,a.v_)(V.value?"编辑条目":"新建条目"),1),(0,r.Lk)("h2",null,(0,a.v_)(F.title||"未命名词条"),1)]),(0,r.Lk)("div",m,[(0,r.bF)(n,{onClick:M},{default:(0,r.k6)(()=>[...t[3]||(t[3]=[(0,r.eW)("返回列表",-1)])]),_:1}),(0,r.bF)(n,{type:"primary",loading:s.value,onClick:K},{default:(0,r.k6)(()=>[(0,r.eW)((0,a.v_)(V.value?"提交更新":"发布词条"),1)]),_:1},8,["loading"])])])]),default:(0,r.k6)(()=>[(0,r.bF)(c,{model:F,"label-width":"80px",class:"editor-form"},{default:(0,r.k6)(()=>[(0,r.bF)(o,{label:"标题"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{modelValue:F.title,"onUpdate:modelValue":t[0]||(t[0]=e=>F.title=e),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),(0,r.bF)(o,{label:"摘要"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{modelValue:F.summary,"onUpdate:modelValue":t[1]||(t[1]=e=>F.summary=e),type:"textarea",rows:2,maxlength:"200","show-word-limit":"",placeholder:"简要概述条目"},null,8,["modelValue"])]),_:1}),(0,r.bF)(o,{label:"正文"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",k,[(0,r.Lk)("div",g,[(0,r.Lk)("div",y,[(0,r.bF)(u,{class:"upload-btn",action:"/api/files/upload?category=WIKI","show-file-list":!1,"before-upload":W,"on-success":$,"on-error":O},{default:(0,r.k6)(()=>[(0,r.bF)(n,{text:"",loading:_.value},{default:(0,r.k6)(()=>[(0,r.eW)((0,a.v_)(_.value?"上传中...":"插入图片"),1)]),_:1},8,["loading"])]),_:1})]),(0,r.bF)(i,{modelValue:F.content,"onUpdate:modelValue":t[2]||(t[2]=e=>F.content=e),type:"textarea",rows:18,class:"markdown-input",placeholder:"支持 Markdown 语法，使用 # ## ### 定义标题，使用 ![](url) 插入图片"},null,8,["modelValue"]),L.value.length?((0,r.uX)(),(0,r.CE)("div",w,[t[5]||(t[5]=(0,r.Lk)("p",null,"已上传图片",-1)),(0,r.Lk)("div",x,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.uid,class:"image-thumb"},[(0,r.Lk)("img",{src:e.url,alt:e.url},null,8,b),(0,r.bF)(n,{text:"",type:"danger",size:"small",onClick:t=>T(e)},{default:(0,r.k6)(()=>[...t[4]||(t[4]=[(0,r.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])]))),128))])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",S,[t[6]||(t[6]=(0,r.Lk)("div",{class:"preview-header"},[(0,r.Lk)("span",null,"实时预览")],-1)),(0,r.Lk)("div",{class:"preview-content",innerHTML:I.value},null,8,z)])])]),_:1})]),_:1},8,["model"])]),_:1})])}}},L=n(6262);const F=(0,L.A)(_,[["__scopeId","data-v-18e62f9c"]]);var C=F},4204:function(e,t,n){var r=n(7080),a=n(2021).add,i=n(9286),o=n(3789),u=n(507);e.exports=function(e){var t=r(this),n=o(e).getIterator(),s=i(t);return u(n,function(e){a(s,e)}),s}},4449:function(e,t,n){var r=n(7080),a=n(2021).has,i=n(5170),o=n(3789),u=n(8469),s=n(507),c=n(9539);e.exports=function(e){var t=r(this),n=o(e);if(i(t)<=n.size)return!1!==u(t,function(e){if(n.includes(e))return!1},!0);var l=n.getIterator();return!1!==s(l,function(e){if(a(t,e))return c(l,"normal",!1)})}},4916:function(e,t,n){var r=n(7751),a=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},i=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var n=r("Set");try{(new n)[e](a(0));try{return(new n)[e](a(-1)),!1}catch(u){if(!t)return!0;try{return(new n)[e](i(-1/0)),!1}catch(s){var o=new n([1,2]);return t(o[e](i(1/0)))}}}catch(s){return!1}}},5024:function(e,t,n){var r=n(6518),a=n(3650),i=n(9835),o=n(4916),u=!o("symmetricDifference")||!i("symmetricDifference");r({target:"Set",proto:!0,real:!0,forced:u},{symmetricDifference:a})},5170:function(e,t,n){var r=n(6706),a=n(2021);e.exports=r(a.proto,"size","get")||function(e){return e.size}},5876:function(e,t,n){var r=n(6518),a=n(3838),i=n(4916),o=!i("isSubsetOf",function(e){return e});r({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:a})},6706:function(e,t,n){var r=n(9504),a=n(9306);e.exports=function(e,t,n){try{return r(a(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(i){}}},7080:function(e,t,n){var r=n(2021).has;e.exports=function(e){return r(e),e}},7642:function(e,t,n){var r=n(6518),a=n(3440),i=n(9039),o=n(4916),u=!o("difference",function(e){return 0===e.size}),s=u||i(function(){var e={size:1,has:function(){return!0},keys:function(){var e=0;return{next:function(){var n=e++>1;return t.has(1)&&t.clear(),{done:n,value:2}}}}},t=new Set([1,2,3,4]);return 3!==t.difference(e).size});r({target:"Set",proto:!0,real:!0,forced:s},{difference:a})},8004:function(e,t,n){var r=n(6518),a=n(9039),i=n(8750),o=n(4916),u=!o("intersection",function(e){return 2===e.size&&e.has(1)&&e.has(2)})||a(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))});r({target:"Set",proto:!0,real:!0,forced:u},{intersection:i})},8469:function(e,t,n){var r=n(9504),a=n(507),i=n(2021),o=i.Set,u=i.proto,s=r(u.forEach),c=r(u.keys),l=c(new o).next;e.exports=function(e,t,n){return n?a({iterator:c(e),next:l},t):s(e,t)}},8527:function(e,t,n){var r=n(7080),a=n(2021).has,i=n(5170),o=n(3789),u=n(507),s=n(9539);e.exports=function(e){var t=r(this),n=o(e);if(i(t)<n.size)return!1;var c=n.getIterator();return!1!==u(c,function(e){if(!a(t,e))return s(c,"normal",!1)})}},8750:function(e,t,n){var r=n(7080),a=n(2021),i=n(5170),o=n(3789),u=n(8469),s=n(507),c=a.Set,l=a.add,f=a.has;e.exports=function(e){var t=r(this),n=o(e),a=new c;return i(t)>n.size?s(n.getIterator(),function(e){f(t,e)&&l(a,e)}):u(t,function(e){n.includes(e)&&l(a,e)}),a}},9286:function(e,t,n){var r=n(2021),a=n(8469),i=r.Set,o=r.add;e.exports=function(e){var t=new i;return a(e,function(e){o(t,e)}),t}},9835:function(e){e.exports=function(e){try{var t=new Set,n={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return t.clear(),t.add(4),function(){return{done:!0}}}})}},r=t[e](n);return 1===r.size&&4===r.values().next().value}catch(a){return!1}}}}]);
//# sourceMappingURL=882.6ff553d1.js.map