"use strict";(self["webpackChunkChunyin"]=self["webpackChunkChunyin"]||[]).push([[889],{1889:function(e,l,a){a.r(l),a.d(l,{default:function(){return F}});var t=a(641),r=a(3751),u=a(953),o=a(6400),s=a(163),d=a(7918),n=a(2549);const i={class:"settings-page"},c={class:"settings-card"},m={class:"avatar-section"},f={class:"form-grid"},k={class:"form-actions"},p={class:"settings-card"},v={class:"setting-item"},b={class:"setting-item"},w={class:"setting-item danger"};var h={__name:"Settings",setup(e){const l=(0,o.k)(),a=(0,u.KR)(l.userInfo?.avatarUrl),h=(0,u.KR)(!1),g=(0,u.KR)({username:l.userInfo?.username||"",bio:l.userInfo?.bio||"",gender:l.userInfo?.gender||"SECRET",email:l.userInfo?.email||"",birthday:l.userInfo?.birthday?new Date(l.userInfo.birthday):null,avatarImageId:null}),y=(0,u.KR)({oldPassword:"",newPassword:"",confirmPassword:""}),F=e=>{if(!e)return null;const l=new Date(e);return Number.isNaN(l.getTime())?null:l.toISOString().slice(0,10)},V=e=>{const l=e.type.startsWith("image/"),a=e.size/1024/1024<5;return l?!!a||(s.nk.error("头像大小不能超过 5MB"),!1):(s.nk.error("只能上传图片文件"),!1)},_=e=>{200===e.code&&e.data?.id?(a.value=e.data.url,g.value.avatarImageId=e.data.id,s.nk.success("头像上传成功")):s.nk.error("上传失败，请重试")},L=async()=>{try{await(0,n.r7)({username:g.value.username,bio:g.value.bio,gender:g.value.gender,email:g.value.email,birthday:F(g.value.birthday),avatarImageId:g.value.avatarImageId}),await l.fetchUserInfo(),s.nk.success("设置已保存")}catch(e){s.nk.error("保存失败")}},I=()=>{g.value={username:l.userInfo?.username||"",bio:l.userInfo?.bio||"",gender:l.userInfo?.gender||"SECRET",email:l.userInfo?.email||"",birthday:l.userInfo?.birthday?new Date(l.userInfo.birthday):null,avatarImageId:null}},P=()=>{h.value=!0},A=async()=>{if(y.value.newPassword===y.value.confirmPassword)if(y.value.newPassword.length<6)s.nk.error("密码长度不能少于6位");else try{await(0,n.ec)({oldPassword:y.value.oldPassword,newPassword:y.value.newPassword}),s.nk.success("密码修改成功"),h.value=!1,y.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(e){s.nk.error("密码修改失败")}else s.nk.error("两次输入的密码不一致")},C=()=>{s.nk.info("数据导出功能开发中...")},x=()=>{d.s.confirm("删除账户后，所有数据将被永久删除，且无法恢复。是否继续？","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{s.nk.success("账户已删除")}catch(e){s.nk.error("删除失败")}}).catch(()=>{})};return(e,l)=>{const u=(0,t.g2)("el-avatar"),o=(0,t.g2)("el-button"),s=(0,t.g2)("el-upload"),d=(0,t.g2)("el-form-item"),n=(0,t.g2)("el-input"),F=(0,t.g2)("el-radio"),W=(0,t.g2)("el-radio-group"),E=(0,t.g2)("el-date-picker"),U=(0,t.g2)("el-form"),R=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.Lk)("div",c,[l[16]||(l[16]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"eyebrow"},"Profile"),(0,t.Lk)("h2",null,"个人资料")])],-1)),(0,t.bF)(U,{model:g.value,"label-width":"100px",class:"settings-form",onSubmit:(0,r.D$)(L,["prevent"])},{default:(0,t.k6)(()=>[(0,t.bF)(d,{label:"头像"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",m,[(0,t.bF)(u,{src:a.value,size:96,alt:`${g.value.username||"用户"}的头像预览`},null,8,["src","alt"]),(0,t.bF)(s,{class:"avatar-upload",action:"/api/files/upload?category=AVATAR","show-file-list":!1,"on-success":_,"before-upload":V,accept:"image/*"},{default:(0,t.k6)(()=>[(0,t.bF)(o,null,{default:(0,t.k6)(()=>[...l[10]||(l[10]=[(0,t.eW)("更改头像",-1)])]),_:1})]),_:1})])]),_:1}),(0,t.Lk)("div",f,[(0,t.bF)(d,{label:"用户名"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:g.value.username,"onUpdate:modelValue":l[0]||(l[0]=e=>g.value.username=e),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),(0,t.bF)(d,{label:"邮箱"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:g.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value.email=e),type:"email",placeholder:"输入邮箱"},null,8,["modelValue"])]),_:1}),(0,t.bF)(d,{label:"性别"},{default:(0,t.k6)(()=>[(0,t.bF)(W,{modelValue:g.value.gender,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value.gender=e),style:{display:"flex","flex-direction":"column"}},{default:(0,t.k6)(()=>[(0,t.bF)(F,{value:"MALE"},{default:(0,t.k6)(()=>[...l[11]||(l[11]=[(0,t.eW)("男",-1)])]),_:1}),(0,t.bF)(F,{value:"FEMALE"},{default:(0,t.k6)(()=>[...l[12]||(l[12]=[(0,t.eW)("女",-1)])]),_:1}),(0,t.bF)(F,{value:"SECRET"},{default:(0,t.k6)(()=>[...l[13]||(l[13]=[(0,t.eW)("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(d,{label:"生日"},{default:(0,t.k6)(()=>[(0,t.bF)(E,{modelValue:g.value.birthday,"onUpdate:modelValue":l[3]||(l[3]=e=>g.value.birthday=e),type:"date",placeholder:"选择生日"},null,8,["modelValue"])]),_:1})]),(0,t.bF)(d,{label:"个性签名"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:g.value.bio,"onUpdate:modelValue":l[4]||(l[4]=e=>g.value.bio=e),type:"textarea",placeholder:"输入个性签名",rows:"3",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.Lk)("div",k,[(0,t.bF)(o,{onClick:I},{default:(0,t.k6)(()=>[...l[14]||(l[14]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(o,{type:"primary",onClick:L},{default:(0,t.k6)(()=>[...l[15]||(l[15]=[(0,t.eW)("保存设置",-1)])]),_:1})])]),_:1},8,["model"])]),(0,t.Lk)("div",p,[l[23]||(l[23]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"eyebrow"},"Security"),(0,t.Lk)("h3",null,"账户安全")])],-1)),(0,t.Lk)("div",v,[l[18]||(l[18]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"item-title"},"修改密码"),(0,t.Lk)("p",{class:"item-desc"},"为保障账户安全，建议定期更新密码")],-1)),(0,t.bF)(o,{text:"",type:"primary",onClick:P},{default:(0,t.k6)(()=>[...l[17]||(l[17]=[(0,t.eW)("修改",-1)])]),_:1})]),(0,t.Lk)("div",b,[l[20]||(l[20]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"item-title"},"导出我的数据"),(0,t.Lk)("p",{class:"item-desc"},"下载近 30 天的所有内容记录")],-1)),(0,t.bF)(o,{text:"",onClick:C},{default:(0,t.k6)(()=>[...l[19]||(l[19]=[(0,t.eW)("导出",-1)])]),_:1})]),(0,t.Lk)("div",w,[l[22]||(l[22]=(0,t.Lk)("div",null,[(0,t.Lk)("p",{class:"item-title"},"删除账户"),(0,t.Lk)("p",{class:"item-desc"},"删除后将无法恢复所有数据")],-1)),(0,t.bF)(o,{text:"",type:"danger",onClick:x},{default:(0,t.k6)(()=>[...l[21]||(l[21]=[(0,t.eW)("删除",-1)])]),_:1})])]),(0,t.bF)(R,{title:"修改密码",modelValue:h.value,"onUpdate:modelValue":l[9]||(l[9]=e=>h.value=e),width:"400px"},{footer:(0,t.k6)(()=>[(0,t.bF)(o,{onClick:l[8]||(l[8]=e=>h.value=!1)},{default:(0,t.k6)(()=>[...l[24]||(l[24]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(o,{type:"primary",onClick:A},{default:(0,t.k6)(()=>[...l[25]||(l[25]=[(0,t.eW)("确定",-1)])]),_:1})]),default:(0,t.k6)(()=>[(0,t.bF)(U,{model:y.value,"label-width":"80px"},{default:(0,t.k6)(()=>[(0,t.bF)(d,{label:"原密码"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:y.value.oldPassword,"onUpdate:modelValue":l[5]||(l[5]=e=>y.value.oldPassword=e),type:"password",placeholder:"输入原密码"},null,8,["modelValue"])]),_:1}),(0,t.bF)(d,{label:"新密码"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:y.value.newPassword,"onUpdate:modelValue":l[6]||(l[6]=e=>y.value.newPassword=e),type:"password",placeholder:"输入新密码"},null,8,["modelValue"])]),_:1}),(0,t.bF)(d,{label:"确认密码"},{default:(0,t.k6)(()=>[(0,t.bF)(n,{modelValue:y.value.confirmPassword,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value.confirmPassword=e),type:"password",placeholder:"确认新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},g=a(6262);const y=(0,g.A)(h,[["__scopeId","data-v-56aff8b5"]]);var F=y},2549:function(e,l,a){a.d(l,{Eo:function(){return f},Qt:function(){return d},ec:function(){return o},fG:function(){return m},hP:function(){return c},hc:function(){return n},l2:function(){return r},pV:function(){return s},qw:function(){return i},r7:function(){return u}});var t=a(7277);const r=e=>(0,t.A)({url:`/users/${e}`,method:"get"}),u=e=>(0,t.A)({url:"/users/profile",method:"put",data:e}),o=e=>(0,t.A)({url:"/users/password",method:"put",data:e}),s=e=>(0,t.A)({url:`/users/${e}/follow`,method:"post"}),d=e=>(0,t.A)({url:`/users/${e}/follow`,method:"delete"}),n=()=>(0,t.A)({url:"/users/followees",method:"get"}),i=e=>(0,t.A)({url:"/collections",method:"get",params:e}),c=e=>(0,t.A)({url:"/footprints",method:"get",params:e}),m=e=>(0,t.A)({url:"/footprints",method:"post",data:e}),f=e=>(0,t.A)({url:`/users/${e}/block-recommend`,method:"post"})}}]);
//# sourceMappingURL=889.03e8acfa.js.map